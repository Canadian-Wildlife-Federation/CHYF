package net.refractions.chyf.skeleontizer.points;

import java.util.ArrayList;
import java.util.List;

import org.junit.Assert;
import org.junit.Test;
import org.locationtech.jts.geom.Coordinate;
import org.locationtech.jts.geom.LineString;
import org.locationtech.jts.geom.Polygon;
import org.locationtech.jts.geom.prep.PreparedPolygon;
import org.locationtech.jts.io.WKTReader;

import net.refractions.chyf.ChyfProperties;
import net.refractions.chyf.ChyfProperties.Property;
import net.refractions.chyf.datasource.ChyfGeoPackageDataSource.FlowDirection;
import net.refractions.chyf.skeletonizer.points.SkeletonPoint;
import net.refractions.chyf.skeletonizer.points.SkeletonPoint.Type;
import net.refractions.chyf.skeletonizer.voronoi.SkeletonGenerator;
import net.refractions.chyf.skeletonizer.voronoi.SkeletonResult;

/**
 * Test cases for skeletonizer.  This does not test the output to 
 * ensure it is valid, it just runs tests and ensure a result is returned.
 * 
 * @author Emily
 *
 */
public class VoronoiTest {

	private WKTReader reader = new WKTReader();
	
	private SkeletonGenerator createGenerator(double densify, double simplify, double minsize) {
		ChyfProperties prop = new ChyfProperties();
		prop.setProperty(Property.SKEL_DENSIFY_FACTOR, densify);
		prop.setProperty(Property.SKEL_SIMPLIFY_FACTOR, simplify);
		prop.setProperty(Property.SKEL_MINSIZE, minsize);
		prop.setProperty(Property.SKEL_ACUTE_ANGLE_RAD, 0.523599);
		SkeletonGenerator gen = new SkeletonGenerator(prop);
		return gen;
	}
	
	@Test
	public void testNs() throws Exception{

		String waterbody = "Polygon((-63.65647649999999658 44.5014409999999998 0, -63.65811469999999872 44.50242709999999846 0, -63.6596964000000014 44.50337929999999886 0, -63.65971820000000037 44.50392850000000067 0, -63.66020209999999935 44.50464519999999879 0, -63.65957269999999824 44.50657259999999837 0, -63.65913119999999736 44.50791929999999752 0, -63.65871659999999821 44.50821069999999935 0, -63.65845960000000048 44.50788169999999866 0, -63.6582808 44.5078029000000015 0, -63.65789259999999672 44.50839489999999898 0, -63.6576110999999969 44.50839690000000104 0, -63.65730400000000344 44.50848919999999964 0, -63.65698309999999793 44.50837599999999838 0, -63.65671269999999993 44.50797159999999764 0, -63.65709989999999863 44.50780989999999804 0, -63.65724550000000193 44.50748529999999903 0, -63.65795789999999954 44.50746850000000165 0, -63.65793550000000067 44.50706929999999772 0, -63.65778720000000135 44.50678200000000118 0, -63.65746730000000042 44.50677929999999805 0, -63.65732650000000348 44.50644470000000297 0, -63.65727929999999901 44.5057054999999977 0, -63.65711960000000147 44.50556399999999968 0, -63.65689650000000199 44.50548830000000322 0, -63.65677339999999873 44.5052607000000009 0, -63.6561647999999991 44.50489670000000331 0, -63.65577960000000246 44.50473860000000315 0, -63.65529599999999988 44.50469300000000317 0, -63.65469650000000001 44.50424230000000136 0, -63.65444080000000326 44.50415399999999977 0, -63.65413470000000018 44.50435689999999767 0, -63.653593800000003 44.50449950000000143 0, -63.65331050000000346 44.5044107000000011 0, -63.65286340000000109 44.50414870000000178 0, -63.65261869999999789 44.50365409999999855 0, -63.65245579999999848 44.50359149999999886 0, -63.65229970000000037 44.50363159999999851 0, -63.65226590000000328 44.5039190999999974 0, -63.65187350000000066 44.50393849999999674 0, -63.6514205000000004 44.5036843000000033 0, -63.65066960000000051 44.50356599999999929 0, -63.65044610000000347 44.50322969999999856 0, -63.65015439999999813 44.5030775000000034 0, -63.64991789999999838 44.50238559999999666 0, -63.64960479999999876 44.501814600000003 0, -63.64953419999999795 44.50151699999999977 0, -63.64928220000000181 44.501069600000001 0, -63.6485422000000014 44.50041459999999915 0, -63.64793819999999869 44.50021240000000233 0, -63.64779300000000006 44.5 0, -63.64773249999999649 44.49998310000000146 0, -63.64772870000000182 44.49967110000000048 0, -63.64760420000000352 44.49961330000000004 0, -63.64729950000000258 44.49964630000000199 0, -63.64722619999999864 44.4998185000000035 0, -63.64711259999999982 44.49976480000000123 0, -63.64687450000000268 44.49965319999999736 0, -63.6467747000000017 44.49939450000000107 0, -63.64630830000000117 44.49906500000000165 0, -63.64557640000000305 44.49875360000000057 0, -63.64541289999999663 44.49884089999999759 0, -63.64509549999999649 44.49877899999999897 0, -63.64486910000000108 44.4986518999999987 0, -63.64472630000000208 44.49863700000000222 0, -63.64453470000000124 44.49833300000000236 0, -63.64459300000000042 44.49825529999999674 0, -63.64489189999999752 44.49822999999999951 0, -63.64556670000000338 44.49831910000000335 0, -63.64585389999999876 44.49830939999999657 0, -63.64592530000000181 44.49804639999999978 0, -63.64583950000000101 44.49758270000000238 0, -63.64611409999999836 44.49747789999999981 0, -63.64642140000000126 44.49751590000000334 0, -63.64690439999999683 44.49784189999999739 0, -63.64719250000000272 44.49781240000000082 0, -63.6473173999999986 44.49759000000000242 0, -63.64719029999999833 44.49746100000000126 0, -63.6468954999999994 44.49738769999999732 0, -63.64663699999999835 44.49709800000000115 0, -63.64666340000000133 44.49685780000000079 0, -63.64682690000000065 44.49677040000000261 0, -63.64734039999999737 44.49675750000000107 0, -63.64774080000000112 44.49708170000000251 0, -63.64803100000000313 44.49740359999999839 0, -63.64808409999999839 44.49772449999999679 0, -63.64854660000000308 44.49828289999999953 0, -63.64883569999999935 44.49836390000000108 0, -63.64895489999999967 44.49827959999999649 0, -63.64893800000000113 44.4981529000000009 0, -63.6486914999999982 44.49797800000000336 0, -63.64859109999999731 44.49786929999999785 0, -63.64858490000000302 44.49761649999999946 0, -63.64873839999999916 44.49750530000000026 0, -63.64855099999999766 44.4972329000000002 0, -63.64774349999999714 44.49661199999999894 0, -63.64760960000000267 44.49638019999999727 0, -63.64763270000000261 44.49621880000000118 0, -63.64783969999999869 44.49614820000000037 0, -63.64812450000000155 44.49619760000000213 0, -63.64870059999999796 44.49680970000000002 0, -63.64901119999999679 44.49676879999999812 0, -63.64920159999999782 44.49683199999999772 0, -63.64927420000000069 44.49680980000000119 0, -63.64931229999999829 44.49655400000000327 0, -63.64956670000000116 44.4964014999999975 0, -63.64962909999999852 44.49622509999999664 0, -63.64997900000000186 44.4962996000000004 0, -63.65020710000000292 44.49638720000000092 0, -63.65026139999999799 44.49640809999999647 0, -63.65139810000000153 44.4966647999999978 0, -63.65226859999999931 44.49695930000000033 0, -63.65264109999999675 44.49702239999999875 0, -63.65276939999999684 44.49739220000000017 0, -63.65250670000000355 44.49761170000000021 0, -63.65296769999999782 44.49820960000000269 0, -63.65395079999999695 44.49844720000000109 0, -63.65463729999999742 44.49906159999999744 0, -63.65455409999999858 44.49920989999999676 0, -63.65470549999999861 44.49941830000000209 0, -63.65455130000000139 44.4995492999999982 0, -63.65461400000000225 44.49963350000000162 0, -63.65519549999999782 44.49984700000000259 0, -63.65520089999999698 44.49957870000000071 0, -63.655796500000001 44.49971740000000153 0, -63.65595299999999668 44.5 0, -63.65592800000000295 44.5 0, -63.65590579999999932 44.50014999999999787 0, -63.65553549999999916 44.500438299999999 0, -63.65553309999999954 44.50049750000000159 0, -63.65598789999999951 44.50084259999999858 0, -63.65614620000000201 44.50115379999999732 0, -63.65647649999999658 44.5014409999999998 0),(-63.65477289999999755 44.50345039999999841 0, -63.6545810000000003 44.50301600000000235 0, -63.65412340000000313 44.50246959999999774 0, -63.65403789999999873 44.50226649999999751 0, -63.65360720000000327 44.50187059999999661 0, -63.65339540000000085 44.50151879999999949 0, -63.65298419999999879 44.50132070000000084 0, -63.65297199999999833 44.5009453999999991 0, -63.65261770000000041 44.50083930000000265 0, -63.65216219999999936 44.50051400000000257 0, -63.65184800000000109 44.5 0, -63.65125220000000184 44.49956329999999838 0, -63.65084209999999842 44.49947579999999903 0, -63.65053360000000282 44.49919690000000116 0, -63.65040549999999797 44.49895740000000188 0, -63.65023250000000132 44.49887079999999884 0, -63.65000640000000232 44.49900430000000284 0, -63.64996860000000112 44.4993904000000029 0, -63.65004059999999697 44.49951819999999714 0, -63.65047359999999799 44.49985490000000254 0, -63.65056500000000028 44.5 0, -63.65059769999999872 44.50019309999999706 0, -63.65055360000000206 44.50086720000000184 0, -63.65174129999999764 44.50163419999999803 0, -63.65208210000000122 44.50166500000000269 0, -63.65235539999999759 44.50186020000000298 0, -63.65238020000000319 44.50220029999999838 0, -63.65288509999999889 44.50253450000000299 0, -63.65294719999999984 44.50276879999999835 0, -63.65342979999999784 44.50324470000000332 0, -63.65360559999999879 44.50353259999999977 0, -63.65408800000000156 44.50387820000000261 0, -63.65462910000000107 44.50386579999999981 0, -63.65476670000000325 44.50373840000000314 0, -63.65477289999999755 44.50345039999999841 0))";
		
		List<SkeletonPoint> riverPoints = new ArrayList<>();
		
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.65395079999999695, 44.49844720000000109), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.65811469999999872, 44.50242709999999846), Type.FLOWPATH, FlowDirection.IN, null));  
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.65004059999999697, 44.49951819999999714), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.6514205000000004, 44.5036843000000033), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.65811469999999872, 44.50242709999999846), Type.WATER, FlowDirection.UNKNOWN, null));  
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.64583950000000101, 44.49758270000000238), Type.FLOWPATH, FlowDirection.OUT, null));  
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.65957269999999824, 44.50657259999999837), Type.FLOWPATH, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.6582808, 44.5078029000000015), 		Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.65957269999999824, 44.50657259999999837), Type.WATER, FlowDirection.UNKNOWN, null));  
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.64895489999999967, 44.49827959999999649), Type.BANK, FlowDirection.IN, null));  
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.6576110999999969, 44.50839690000000104), Type.FLOWPATH, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-63.65020710000000292, 44.49638720000000092), Type.FLOWPATH, FlowDirection.IN, null));
		
		Polygon polygon = (Polygon)reader.read(waterbody);
		SkeletonGenerator g = createGenerator(0.00001,0.00001,0.00001);
		SkeletonResult items = g.generateSkeleton(polygon,  riverPoints);
		
		System.out.println(polygon.toText());
		riverPoints.forEach(p->System.out.println("POINT(" + p.getCoordinate().x + " " + p.getCoordinate().y+")"));
		
//		Assert.assertEquals("Errors existing in skeleton results", 0, items.getErrors().size());
//		Assert.assertNotEquals("No skeletons generated", 0, items.getSkeletons().size());
		
		items.getSkeletons().forEach(ls->System.out.println(ls.toText()));
		items.getErrors().forEach(e->System.out.println(e));
		
	}
	
	
	@Test
	public void testValid() throws Exception{
		String p = "POLYGON((0 0, 0 5, 5 5, 5 0, 0 0))";
			
		Polygon polygon = (Polygon)reader.read(p);
		PreparedPolygon pp = new PreparedPolygon(polygon);
		
		LineString ls = (LineString) reader.read("LINESTRING(1 1, 2 2)");
		Assert.assertTrue("ls intersection not ok", pp.covers(ls));
		
		ls = (LineString) reader.read("LINESTRING(0 0, 2 2)");
		Assert.assertTrue("ls intersection not ok", pp.covers(ls));
		
		ls = (LineString) reader.read("LINESTRING(-1 -1, 2 2)");
		Assert.assertTrue("ls intersection not ok", !pp.covers(ls));
		
		ls = (LineString) reader.read("LINESTRING(-1 -1, 0 0)");
		Assert.assertTrue("ls intersection not ok", !pp.covers(ls));
		
		ls = (LineString) reader.read("LINESTRING(15 15, 20 20)");
		Assert.assertTrue("ls intersection not ok", !pp.covers(ls));
		
		
		p = "POLYGON (( -73.2700858 45.4554992, -73.2696859 45.4555921, -73.2696315 45.4556048, -73.2684482 45.4558798, -73.2674751 45.4561059, -73.2676032 45.4560251, -73.2677056 45.4559983, -73.2678852 45.4558277, -73.2679882 45.4556839, -73.2680908 45.4555942, -73.2681038 45.4555492, -73.2679892 45.455414, -73.2680023 45.45536, -73.2680408 45.4553151, -73.2681822 45.4551355, -73.2682336 45.4550815, -73.2682724 45.4549737, -73.2682471 45.4548836, -73.268286 45.4547757, -73.2684018 45.454605, -73.2683636 45.4545599, -73.2682737 45.4546497, -73.2678881 45.4551529, -73.2676571 45.4553413, -73.2672856 45.4555476, -73.2669653 45.4556819, -73.2667984 45.4558255, -73.2667728 45.4558704, -73.2667341 45.4559154, -73.2666953 45.4560232, -73.2667207 45.4560683, -73.2665147 45.4559953, -73.2663122 45.4559235, -73.2665811 45.455825, -73.2667094 45.4557443, -73.266863 45.4556816, -73.2670554 45.455556, -73.2671192 45.4555562, -73.2673113 45.4555026, -73.2673753 45.4554667, -73.2676701 45.4552963, -73.2678755 45.4551078, -73.2680813 45.4548112, -73.2681459 45.4546404, -73.2681345 45.4542895, -73.2680089 45.4537493, -73.2678578 45.4531911, -73.2678709 45.4531101, -73.2678335 45.4528671, -73.2678341 45.4527052, -73.2677835 45.452579, -73.267771 45.452516, -73.2677587 45.45239, -73.2677333 45.452345, -73.2677341 45.452174, -73.2677091 45.45203, -73.2678378 45.4518233, -73.2679017 45.4518234, -73.2679147 45.4517874, -73.2678008 45.4514813, -73.2675335 45.4511837, -73.2673296 45.4510484, -73.2667167 45.4508581, -73.2660657 45.4506049, -73.2658999 45.4505236, -73.2657977 45.4504963, -73.2654277 45.4503156, -73.2648916 45.4500986, -73.2640235 45.4497908, -73.2636538 45.449538, -73.2633097 45.4492944, -73.2632462 45.4491773, -73.2632469 45.4490513, -73.2631319 45.4490061, -73.262966 45.4489517, -73.2628385 45.4488525, -73.2627362 45.4488523, -73.2626469 45.4488341, -73.2623408 45.4486625, -73.2618436 45.4483375, -73.2616649 45.4482471, -73.2612441 45.4479943, -73.2607466 45.4477233, -73.260479 45.4475428, -73.2603388 45.4474525, -73.2601349 45.4472901, -73.2600966 45.447263, -73.2600584 45.447227, -73.2600332 45.4471549, -73.2599823 45.4470918, -73.2597656 45.4469384, -73.2597147 45.4469023, -73.260199 45.4464777, -73.2606834 45.446053, -73.2612363 45.4455842, -73.2617675 45.4451339, -73.2618441 45.445179, -73.2620095 45.4453413, -73.2620344 45.4455214, -73.2620978 45.4456115, -73.2622507 45.4457648, -73.2623783 45.4458191, -73.2625058 45.4458913, -73.2626589 45.4459456, -73.2629904 45.4461622, -73.2634241 45.4463791, -73.2635136 45.4463973, -73.2635518 45.4464064, -73.2636541 45.4464336, -73.2637562 45.4464608, -73.2640113 45.4465963, -73.2646114 45.4467865, -73.264918 45.4468231, -73.2651094 45.4469135, -73.2653263 45.44704, -73.2655555 45.4472293, -73.2656447 45.4473105, -73.2656314 45.4474365, -73.2656698 45.4474456, -73.2657211 45.4473827, -73.2659246 45.4476261, -73.2658987 45.447716, -73.2659494 45.447815, -73.2660894 45.4479503, -73.2661532 45.4479954, -73.266485 45.4481581, -73.266753 45.4482667, -73.2669445 45.4483121, -73.2670721 45.4483663, -73.267187 45.4484205, -73.2674807 45.4484931, -73.2675446 45.4485112, -73.2678766 45.4485839, -73.2680044 45.4486112, -73.2681704 45.4486475, -73.2683238 45.4486658, -73.2685283 45.4486842, -73.2687326 45.4487206, -73.2689754 45.4487481, -73.2692309 45.4487936, -73.2693588 45.4487939, -73.2700103 45.4489302, -73.2703167 45.4490118, -73.270483 45.4489941, -73.2706235 45.4490034, -73.2707766 45.4491027, -73.2709171 45.4491209, -73.2710834 45.4491033, -73.2714541 45.449131, -73.2716587 45.4491225, -73.2721442 45.4491684, -73.2722719 45.4491956, -73.2724125 45.4492049, -73.2728594 45.4493497, -73.2729998 45.449422, -73.2731148 45.4494402, -73.2733323 45.4493957, -73.2735241 45.4493871, -73.2735625 45.4493782, -73.2737416 45.4493515, -73.2739973 45.4493341, -73.2742402 45.4493255, -73.2744831 45.449326, -73.2747516 45.4493175, -73.2749306 45.4493358, -73.2751478 45.4493543, -73.2753012 45.4493726, -73.2753779 45.4493727, -73.275544 45.4494001, -73.275774 45.4494365, -73.2759399 45.4494728, -73.276055 45.4494821, -73.2761569 45.4495722, -73.2762846 45.4496085, -73.2764757 45.4497798, -73.2766035 45.4497981, -73.2767953 45.4497895, -73.2768593 45.4497716, -73.2772683 45.4497994, -73.2773323 45.4497636, -73.2769494 45.4508292, -73.2767814 45.4512967, -73.2764124 45.4523234, -73.2762853 45.452677, -73.2761961 45.4525868, -73.2761708 45.4525328, -73.276133 45.4523888, -73.2760948 45.4523526, -73.276031 45.4523256, -73.2757371 45.452271, -73.2756988 45.4522619, -73.2753794 45.4522163, -73.2752132 45.452225, -73.2750853 45.4522337, -73.2749573 45.4522605, -73.2749316 45.4522874, -73.2749186 45.4523504, -73.2750584 45.4525756, -73.2751221 45.4526117, -73.2753266 45.4526122, -73.2754543 45.4526843, -73.2756074 45.4527387, -73.2756842 45.4527388, -73.2757863 45.452766, -73.2758886 45.4527752, -73.2760676 45.4527485, -73.2762339 45.4527579, -73.2762979 45.452722, -73.2759202 45.4531151, -73.2757436 45.453299, -73.2752452 45.4538177, -73.2752583 45.4537098, -73.2753098 45.4536559, -73.2753227 45.453611, -73.275272 45.4534849, -73.2751955 45.4534577, -73.2751572 45.4534397, -73.275106 45.4534306, -73.2750675 45.4534754, -73.2750416 45.4535654, -73.2748621 45.453691, -73.2748235 45.453736, -73.2748362 45.4537809, -73.2748743 45.453826, -73.2749382 45.4538442, -73.2751683 45.4538626, -73.2743069 45.4540453, -73.273346 45.4542492, -73.2720588 45.4545223, -73.2716591 45.4547398, -73.2713668 45.4548989, -73.2713799 45.454809, -73.271342 45.4547099, -73.271291 45.4546648, -73.2711633 45.4546195, -73.2710995 45.4546104, -73.2710101 45.4546012, -73.2708822 45.4546009, -73.270805 45.4546998, -73.2708302 45.4547898, -73.2708171 45.4548798, -73.2708554 45.4549158, -73.270983 45.4549701, -73.2711108 45.4549883, -73.2713028 45.4549347, -73.2708521 45.4551438, -73.2707256 45.4552025, -73.2700858 45.4554992 ), ( -73.2625829 45.4474245, -73.2625505 45.4474302, -73.2624993 45.4474301, -73.262461 45.4474119, -73.2623717 45.4473848, -73.2622316 45.4472585, -73.2621552 45.4471863, -73.2621436 45.4471731, -73.2620915 45.4471142, -73.2619642 45.447006, -73.2618877 45.4469428, -73.2618113 45.4468977, -73.2617345 45.4468885, -73.2617214 45.4468911, -73.261645 45.4469063, -73.261632 45.4469423, -73.2616574 45.4470053, -73.2617338 45.4470595, -73.2617721 45.4470866, -73.2618231 45.4471317, -73.2618994 45.4472038, -73.2619886 45.447285, -73.2620523 45.4473391, -73.2621032 45.4473662, -73.2621924 45.4474563, -73.2622818 45.4474746, -73.2623839 45.4475288, -73.2624729 45.4476189, -73.2625111 45.4476731, -73.2625621 45.4477091, -73.2626387 45.4477093, -73.2626774 45.4476553, -73.2627287 45.4476015, -73.2626395 45.4475293, -73.2626269 45.4474843, -73.2626073 45.4474354, -73.2626016 45.4474212, -73.2625829 45.4474245 ), ( -73.2630349 45.447764, -73.2630478 45.4477281, -73.2630097 45.4476831, -73.2629202 45.4476468, -73.2628436 45.4476377, -73.2627797 45.4476466, -73.2627156 45.4476915, -73.262677 45.4477453, -73.2626512 45.4477992, -73.262651 45.4478533, -73.2626892 45.4478893, -73.2627787 45.4478715, -73.2628171 45.4478536, -73.2628429 45.4478176, -73.2629069 45.4477818, -73.262971 45.447764, -73.2630349 45.447764 ), ( -73.2631874 45.4479803, -73.2631619 45.4479534, -73.2630471 45.4478721, -73.2629833 45.4478629, -73.2629321 45.4478718, -73.2628937 45.4478897, -73.2628552 45.4479167, -73.2628551 45.4479527, -73.2628932 45.4479887, -73.2629699 45.4480159, -73.2630336 45.4480521, -73.2630591 45.44807, -73.2631104 45.4480522, -73.263136 45.4480163, -73.2631874 45.4479803 ), ( -73.2641184 45.4485042, -73.2641186 45.4484683, -73.2641061 45.4483782, -73.2640425 45.4483331, -73.2638506 45.4483237, -73.2637484 45.4483504, -73.2637099 45.4483684, -73.2636716 45.4483413, -73.2636078 45.4483232, -73.2634927 45.4483409, -73.2634159 45.4483677, -73.2634797 45.4483859, -73.2635307 45.448413, -73.2635945 45.4484402, -73.2636329 45.4484402, -73.2637094 45.4484674, -73.2638627 45.4484947, -73.2639904 45.4485399, -73.2640544 45.4485401, -73.2641184 45.4485042 ), ( -73.2643423 45.4487705, -73.2643219 45.4487836, -73.2642702 45.4488735, -73.264321 45.4489635, -73.2644486 45.4490538, -73.2647164 45.4491893, -73.264844 45.4492616, -73.2649587 45.4493248, -73.265048 45.4493789, -73.2651372 45.4494331, -73.2654436 45.4495598, -73.2659289 45.4497047, -73.2662862 45.4498404, -73.2667332 45.4499313, -73.2672186 45.4500763, -73.2673717 45.4501396, -73.2677548 45.4502484, -73.2682141 45.4504743, -73.2682651 45.4505014, -73.2685583 45.450727, -73.2687362 45.4509703, -73.2687869 45.4510783, -73.2687994 45.4511683, -73.2685941 45.4513479, -73.2685678 45.4515278, -73.2685928 45.4516449, -73.2685796 45.4517528, -73.2686047 45.4518699, -73.2686557 45.4519149, -73.2687962 45.4519422, -73.2689625 45.4519065, -73.2690127 45.4521496, -73.26905 45.4524016, -73.2690623 45.4525277, -73.2692275 45.452771, -73.2694052 45.4530862, -73.2694816 45.4531404, -73.2697876 45.453384, -73.2699278 45.4534742, -73.270017 45.4535374, -73.2701065 45.4535645, -73.2701958 45.4535918, -73.2703105 45.453709, -73.270425 45.4538262, -73.2705117 45.4539322, -73.270565 45.4539974, -73.2707563 45.4541148, -73.2708198 45.4541959, -73.2708067 45.4542859, -73.2709602 45.4542502, -73.2710878 45.4543494, -73.2713688 45.454395, -73.271522 45.4544493, -73.2716114 45.4544674, -73.2717008 45.4545127, -73.2718029 45.4545579, -73.2720588 45.4545223, -73.2721486 45.4544145, -73.2721496 45.4541896, -73.2721882 45.4541447, -73.2722141 45.4540457, -73.2722271 45.4539828, -73.2720877 45.4536855, -73.2720883 45.4535506, -73.2719231 45.4532803, -73.2719106 45.4532173, -73.2718607 45.4529292, -73.2716702 45.4526048, -73.27153 45.4524696, -73.2714412 45.4522894, -73.271365 45.4521993, -73.2712373 45.4521271, -73.2712505 45.4520371, -73.2713018 45.4519923, -73.2713656 45.4520374, -73.2714296 45.4520105, -73.2714557 45.4518756, -73.2714431 45.4518305, -73.2713668 45.4517314, -73.2713286 45.4516774, -73.271265 45.4516322, -73.2711373 45.451569, -73.2709077 45.4514425, -73.2701925 45.4512431, -73.2698989 45.4511615, -73.2697967 45.4511434, -73.2696689 45.4511251, -73.2693882 45.4509985, -73.2693372 45.4509625, -73.2692735 45.4508903, -73.2692481 45.4508543, -73.2691207 45.450755, -73.2687767 45.4504754, -73.268241 45.4501413, -73.2680753 45.450033, -73.2679986 45.4500149, -73.2678327 45.4499425, -73.2674497 45.4498158, -73.2666323 45.4496342, -73.2665428 45.449598, -73.2663514 45.4495436, -73.2662239 45.4494714, -73.266224 45.4494354, -73.2661858 45.4493903, -73.2659431 45.4493448, -73.2657768 45.4493535, -73.2654832 45.4492449, -73.2647176 45.4488834, -73.2646668 45.4488383, -73.264616 45.4487482, -73.2645523 45.4487031, -73.2644757 45.4486849, -73.2643423 45.4487705 ), ( -73.2755138 45.4505609, -73.2754885 45.4504708, -73.2754377 45.4504257, -73.2753099 45.4504074, -73.2752458 45.4504253, -73.2751817 45.4504702, -73.275156 45.4505151, -73.2752069 45.4505603, -73.2753346 45.4506145, -73.2754624 45.4506057, -73.2755138 45.4505609 ), ( -73.2750366 45.4515947, -73.275024 45.4515497, -73.2748837 45.4514684, -73.2747305 45.4514231, -73.2746411 45.451414, -73.2742963 45.4512873, -73.2742324 45.4512962, -73.2741813 45.4512781, -73.2740411 45.4511698, -73.2740285 45.4511248, -73.2740926 45.45108, -73.2741056 45.4510349, -73.2738505 45.4508635, -73.2736461 45.4508451, -73.273518 45.4508808, -73.2734543 45.4508447, -73.2734546 45.4507547, -73.2733652 45.4507456, -73.273263 45.4507273, -73.273199 45.4507542, -73.2731604 45.4507992, -73.2730325 45.4507989, -73.2730069 45.4508439, -73.2730192 45.4509338, -73.2730831 45.45097, -73.273313 45.4510064, -73.2734025 45.4510066, -73.2736708 45.4510612, -73.273696 45.4511511, -73.2736575 45.4511961, -73.273504 45.4511957, -73.2733632 45.4512224, -73.2731462 45.4511591, -73.2730825 45.451123, -73.272993 45.4510957, -73.2729163 45.4511136, -73.2728522 45.4511585, -73.272839 45.4512755, -73.2728898 45.4513205, -73.2730432 45.4513388, -73.273222 45.4514112, -73.2734519 45.4514566, -73.2737328 45.4515472, -73.2738987 45.4515925, -73.2739879 45.4516826, -73.2741154 45.4517639, -73.2743199 45.4518003, -73.2744089 45.4518994, -73.2744855 45.4519536, -73.2745492 45.4519897, -73.2746771 45.4519719, -73.2748307 45.4519182, -73.274895 45.4518284, -73.2748445 45.4516843, -73.2749085 45.4516485, -73.2749854 45.4516306, -73.2750366 45.4515947 ), ( -73.2682631 45.4509963, -73.2681611 45.4509151, -73.2680845 45.4509059, -73.2680328 45.4510228, -73.2680962 45.4511489, -73.2681221 45.451059, -73.2681864 45.4510141, -73.2682631 45.4509963 ), ( -73.2748288 45.4524132, -73.274829 45.4523682, -73.2747783 45.4522691, -73.2747529 45.4522331, -73.2745996 45.4521788, -73.274523 45.4521696, -73.2744335 45.4521515, -73.2743697 45.4521333, -73.2743314 45.4521063, -73.2742422 45.4520611, -73.2741655 45.4520429, -73.2741016 45.4520428, -73.273897 45.4520514, -73.2738328 45.4520873, -73.2738453 45.4521772, -73.2739471 45.4523214, -73.2740235 45.4523846, -73.2742787 45.4524931, -73.2743427 45.4524842, -73.2746623 45.4525028, -73.2747904 45.4524581, -73.2748288 45.4524132 ), ( -73.2688454 45.4524283, -73.2688713 45.4523383, -73.2689102 45.4522034, -73.2688724 45.4520773, -73.2687315 45.452113, -73.2686288 45.4522298, -73.2686924 45.45232, -73.2688454 45.4524283 ), ( -73.2704214 45.454726, -73.2704215 45.454672, -73.2703968 45.454492, -73.2702059 45.4542487, -73.2701295 45.4541855, -73.2700785 45.4541494, -73.2699642 45.4539602, -73.2699132 45.4539152, -73.2697732 45.4537799, -73.2696202 45.4536716, -73.2693777 45.4535361, -73.2692122 45.4533918, -73.2691612 45.4533467, -73.2690342 45.4531485, -73.2689832 45.4531124, -73.268869 45.4528962, -73.2687422 45.452653, -73.2687042 45.4525629, -73.268551 45.4524996, -73.2684742 45.4524995, -73.2683716 45.4526072, -73.2683586 45.4526522, -73.2683685 45.4533541, -73.2683671 45.4536871, -73.2683279 45.4539119, -73.268417 45.4539931, -73.2684291 45.4541551, -73.2685312 45.4542093, -73.2685436 45.4542993, -73.2686327 45.4543805, -73.2686324 45.4544705, -73.2686961 45.4545156, -73.2687475 45.4544797, -73.2687858 45.4544888, -73.2688623 45.4545339, -73.2689 45.454714, -73.2690275 45.4547952, -73.269168 45.4548224, -73.2693594 45.4548949, -73.2693976 45.4549399, -73.2694096 45.4551469, -73.269435 45.455192, -73.269499 45.4551561, -73.2696279 45.4549134, -73.2696536 45.4548685, -73.2697178 45.4548326, -73.2698456 45.4548148, -73.2703186 45.4548428, -73.270357 45.4548339, -73.2704214 45.454726 ), ( -73.2749679 45.4528274, -73.2749681 45.4527374, -73.2748919 45.4526473, -73.2747641 45.4526111, -73.2746363 45.4526198, -73.2745086 45.4525745, -73.2744318 45.4525834, -73.2743549 45.4526282, -73.2743548 45.4526732, -73.2744436 45.4528083, -73.274584 45.4528716, -73.2748395 45.4529261, -73.2749036 45.4529172, -73.2749679 45.4528274 ), ( -73.2754915 45.4529634, -73.2755046 45.4528735, -73.2754538 45.4527833, -73.2754284 45.4527473, -73.2753646 45.4527022, -73.2752879 45.4527021, -73.275224 45.4527199, -73.2751599 45.4527647, -73.2751341 45.4528097, -73.2751338 45.4528997, -73.2751719 45.4529448, -73.2753636 45.4529721, -73.2754915 45.4529634 ), ( -73.2742363 45.4535189, -73.2742367 45.4534108, -73.274237 45.4533569, -73.2742756 45.453267, -73.2742503 45.4532129, -73.2741993 45.4531678, -73.2740589 45.4531046, -73.2739184 45.4530952, -73.2738543 45.4531221, -73.2737137 45.4530949, -73.2736371 45.4530947, -73.2735731 45.4531216, -73.2735345 45.4531665, -73.2735598 45.4532565, -73.2736233 45.4533466, -73.2738144 45.453491, -73.2738783 45.4535181, -73.2740062 45.4535183, -73.274108 45.4536086, -73.2741721 45.4535997, -73.274185 45.4535547, -73.2742363 45.4535189 ), ( -73.2749791 45.4531873, -73.2748899 45.4531242, -73.274775 45.4530969, -73.2747109 45.4531058, -73.2746469 45.4531417, -73.274838 45.453313, -73.274902 45.4533222, -73.2749791 45.4531873 ), ( -73.2689117 45.4549659, -73.2688737 45.4548759, -73.2688227 45.4548307, -73.2687588 45.4548486, -73.2686822 45.4548035, -73.2686564 45.4548485, -73.2685922 45.4549473, -73.2685917 45.4550373, -73.2687836 45.4550197, -73.2689117 45.4549659 ), ( -73.2699467 45.455121, -73.2699856 45.4549951, -73.2699987 45.4549321, -73.2698837 45.4548689, -73.2696919 45.4548956, -73.2696534 45.4549404, -73.2696528 45.4550934, -73.2696267 45.4551924, -73.2696647 45.4552824, -73.2697924 45.4553187, -73.2698566 45.4552828, -73.2699467 45.455121 ), ( -73.2700858 45.4554992, -73.2702398 45.4553646, -73.2703039 45.4553287, -73.2703169 45.4552658, -73.2702414 45.4549686, -73.2701774 45.4549775, -73.2701259 45.4550764, -73.2701128 45.4551664, -73.2700224 45.4553551, -73.2700221 45.4554361, -73.2700858 45.4554992 ), ( -73.2692034 45.4555424, -73.2691398 45.4554523, -73.2689741 45.455335, -73.2690382 45.4552902, -73.2690384 45.4552451, -73.2690259 45.4551731, -73.2689112 45.4550829, -73.2687833 45.4551006, -73.268668 45.4551544, -73.2686295 45.4552083, -73.2686289 45.4553253, -73.2685645 45.4554331, -73.2685643 45.4554782, -73.2686281 45.4555233, -73.2689349 45.4555329, -73.2691393 45.4555872, -73.2692034 45.4555424 ))";
		
		polygon = (Polygon)reader.read(p);
			
		ls = (LineString) reader.read("LINESTRING ( -73.27467134453376 45.450004376757235, -73.2760805026509 45.451044810738345 )");
		pp = new PreparedPolygon(polygon);
		Assert.assertTrue("ls intersection not ok", !pp.covers(ls));
		
	}
	
	@Test
	public void testAcuteAngleInOutPoint() throws Exception{
		String waterbody = "POLYGON((-1526812.22158890590071678 352395.2339754244312644, -1526811.13283905969001353 352386.30144150368869305, -1526813.13370359200052917 352369.08067984692752361, -1526811.15000719181261957 352359.8294948460534215, -1526808.12701155687682331 352353.56245808862149715, -1526808.37525442452169955 352340.91432151477783918, -1526817.81940454244613647 352314.60490500740706921, -1526822.84370626136660576 352303.65248291008174419, -1526829.42253285134211183 352294.42430101614445448, -1526835.78295200760476291 352279.75581436324864626, -1526839.76299572526477277 352268.43303462024778128, -1526839.96155435848049819 352262.13523518200963736, -1526841.03698459942825139 352244.41887327842414379, -1526841.97710343752987683 352244.37535026017576456, -1526845.26574446656741202 352244.22211241628974676, -1526848.55481930542737246 352244.07021639868617058, -1526854.49261295888572931 352245.17272307816892862, -1526862.58440852584317327 352249.04958341084420681, -1526872.22938442137092352 352254.65112957917153835, -1526877.60811103344894946 352260.75057194661349058, -1526884.43653118703514338 352277.08258234709501266, -1526887.52683328348211944 352288.73734569363296032, -1526886.65083688404411077 352300.15634640865027905, -1526882.2542460763361305 352312.33794910926371813, -1526877.61596150510013103 352322.25467243138700724, -1526871.69713274692185223 352332.88978666998445988, -1526865.55990088451653719 352338.08460479695349932, -1526858.96752943890169263 352338.92875466123223305, -1526846.04636140423826873 352336.35382859408855438, -1526840.76635951199568808 352336.65824349690228701, -1526833.31765293446369469 352342.39325275085866451, -1526829.12052771053276956 352348.27750468719750643, -1526821.66573106241412461 352368.92462167982012033, -1526814.62656753323972225 352388.71466288343071938, -1526813.57419578218832612 352391.56669344566762447, -1526812.52182417386211455 352394.41872362606227398, -1526812.22158890590071678 352395.2339754244312644))";
		
		List<SkeletonPoint> riverPoints = new ArrayList<>();
		
		riverPoints.add(new SkeletonPoint(new Coordinate(-1526841.03698459942825139, 352244.41887327842414379), Type.FLOWPATH, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1526812.22158890590071678, 352395.2339754244312644), Type.FLOWPATH, FlowDirection.OUT, null));
		
		riverPoints.add(new SkeletonPoint(new Coordinate(-1526817.81940454244613647, 352314.60490500740706921) , Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1526877.61596150510013103, 352322.25467243138700724), Type.BANK, FlowDirection.OUT, null));
		
		
		Polygon polygon = (Polygon)reader.read(waterbody);
		SkeletonGenerator g = createGenerator(1.0,1.0,1.0);
		SkeletonResult items = g.generateSkeleton(polygon,  riverPoints);
		Assert.assertEquals("Errors existing in skeleton results", 0, items.getErrors().size());
		Assert.assertNotEquals("No skeletons generated", 0, items.getSkeletons().size());
		
		items.getSkeletons().forEach(ls->System.out.println(ls.toText()));
		items.getErrors().forEach(e->System.out.println(e));
	}

	@Test
	public void testAcuteAngleInOutPoint2() throws Exception{
		String waterbody = "Polygon ((-1537403.75902673741802573 344242.60971927642822266, -1537375.4625513709615916 344238.72228364925831556, -1537368.44561860314570367 344240.4125078022480011, -1537358.77495976071804762 344237.96974848583340645, -1537351.82099147979170084 344236.66321728937327862, -1537344.56683982466347516 344236.08842296432703733, -1537337.54990967595949769 344237.77865081373602152, -1537328.74274340178817511 344238.83115141838788986, -1537318.89069871790707111 344239.50948404334485531, -1537313.18749862560071051 344240.66251455526798964, -1537306.58963475516065955 344241.49579373560845852, -1537293.51340781594626606 344242.1992533365264535, -1537288.19971193862147629 344242.31660978682339191, -1537278.798335688887164 344238.96384156309068203, -1537261.21609164262190461 344237.89158633071929216, -1537269.12902046553790569 344236.52066701278090477, -1537279.01268340577371418 344232.66593773942440748, -1537288.47906204801984131 344229.6690682340413332, -1537295.94667472993023694 344223.94549266155809164, -1537299.47308711218647659 344219.83574782591313124, -1537313.50694669946096838 344216.4552786024287343, -1537320.76271170726977289 344213.67583829816430807, -1537327.77964412095025182 344211.9856046736240387, -1537337.90143188810907304 344210.39635320473462343, -1537344.91836652369238436 344208.70612084399908781, -1537350.85790639044716954 344209.81765914056450129, -1537361.81228653714060783 344211.54537886288017035, -1537368.79716071649454534 344213.03020135965198278, -1537378.46693786745890975 344215.47250783815979958, -1537383.71856379136443138 344218.35237303376197815, -1537388.49324724031612277 344220.05596731789410114, -1537393.32330285850912333 344227.14656281284987926, -1537400.45036190981045365 344237.06822503544390202, -1537403.75902673741802573 344242.60971927642822266),(-1537377.46758434781804681 344233.06344356946647167, -1537372.24802303500473499 344227.00852970499545336, -1537366.10378175787627697 344220.45602587424218655, -1537361.74682055716402829 344217.89591602515429258, -1537356.07701783557422459 344215.87346031609922647, -1537349.68592027528211474 344218.79258187115192413, -1537340.25247822399251163 344218.61485025379806757, -1537313.29170622047968209 344222.75273546110838652, -1537304.72221642103977501 344226.06937473081052303, -1537301.6727477905806154 344231.35538709815591574, -1537300.68261212180368602 344237.20832573436200619, -1537306.2335320666898042 344239.3559899153187871, -1537319.15997987170703709 344238.5994578218087554, -1537326.17690807208418846 344236.90922816470265388, -1537333.19383723870851099 344235.21899897232651711, -1537340.20987974875606596 344233.52831625379621983, -1537355.07678608689457178 344233.46393664367496967, -1537361.28649253328330815 344233.66590442229062319, -1537368.30342569458298385 344231.9756783889606595, -1537377.46758434781804681 344233.06344356946647167))";
		
		List<SkeletonPoint> riverPoints = new ArrayList<>();
		
		riverPoints.add(new SkeletonPoint(new Coordinate(-1537403.75902673741802573, 344242.60971927642822266), Type.FLOWPATH, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1537261.21609164262190461, 344237.89158633071929216), Type.FLOWPATH, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1537301.6727477905806154, 344231.35538709815591574), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1537337.90143188810907304, 344210.39635320473462343), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1537328.74274340178817511, 344238.83115141838788986), Type.BANK, FlowDirection.IN, null));
		
		Polygon polygon = (Polygon)reader.read(waterbody);
		SkeletonGenerator g = createGenerator(1.0,1.0,1.0);
		SkeletonResult items = g.generateSkeleton(polygon,  riverPoints);
		
		Assert.assertEquals("Errors existing in skeleton results", 0, items.getErrors().size());
		Assert.assertNotEquals("No skeletons generated", 0, items.getSkeletons().size());
		items.getSkeletons().forEach(ls->System.out.println(ls.toText()));
		items.getErrors().forEach(e->System.out.println(e));
	}
	
	@Test
	public void testAcuteAngleInOutPoint3() throws Exception{
		String waterbody = "POLYGON((-1509342.2307447325438261 258065.92669656779617071, -1509346.48362683341838419 258068.5585533594712615, -1509359.87986031221225858 258078.6830245666205883, -1509366.16912020370364189 258085.19580867886543274, -1509370.97466812282800674 258092.20335362199693918, -1509375.3680171468295157 258101.07832234632223845, -1509380.2019735281355679 258108.26330061070621014, -1509383.82488688104785979 258115.86978369858115911, -1509387.04408420971594751 258124.508602992631495, -1509393.75557854189537466 258141.71432711556553841, -1509406.11738202930428088 258163.20436497498303652, -1509409.12130428152158856 258169.59266364481300116, -1509412.46216715197078884 258178.10701813269406557, -1509416.73337183357216418 258187.10731253679841757, -1509419.45479570934548974 258194.40438151825219393, -1509423.35973699274472892 258201.10296610742807388, -1509426.51419391925446689 258207.54334944020956755, -1509430.63439938635565341 258216.49243839923292398, -1509437.82510859449394047 258223.31461088266223669, -1509443.68264804733917117 258230.6836280906572938, -1509451.77348615671508014 258237.81563865579664707, -1509457.29362877178937197 258243.05949458573013544, -1509463.15116309374570847 258250.4285113625228405, -1509467.48778535379096866 258256.27084741368889809, -1509472.97951343725435436 258261.33726899046450853, -1509486.09317396394908428 258272.37051426246762276, -1509492.0450013920199126 258276.75812893640249968, -1509495.73377396515570581 258281.20575051475316286, -1509496.85140157304704189 258283.76610744837671518, -1509491.15121050667949021 258299.72352030035108328, -1509489.4330876162275672 258307.67244600597769022, -1509489.01972083910368383 258314.89709451422095299, -1509490.35172108956612647 258319.70749291498214006, -1509495.3086557169444859 258326.76755234505981207, -1509503.46625057444907725 258330.74118251819163561, -1509513.21064232103526592 258333.08266403991729021, -1509521.64938850607722998 258336.14796654134988785, -1509531.20692963991314173 258336.41638753563165665, -1509538.37840163614600897 258336.86970202531665564, -1509547.65390071854926646 258338.04600327089428902, -1509556.15942994807846844 258337.95293590426445007, -1509563.95122328656725585 258339.62398710381239653, -1509571.67740760534070432 258339.09617726411670446, -1509580.4649822695646435 258338.09523618314415216, -1509588.68846980738453567 258338.91005128994584084, -1509596.0104832595679909 258339.41546505130827427, -1509611.95986675843596458 258345.06017412059009075, -1509616.64395376085303724 258346.83669932000339031, -1509628.8391325285192579 258351.19172656070441008, -1509635.81320024933665991 258355.76385607663542032, -1509641.67069693491794169 258363.13288447353988886, -1509648.94481173460371792 258378.52323610335588455, -1509653.75072659482248127 258385.53211237769573927, -1509660.03991170949302614 258392.04489962011575699, -1509664.22685037297196686 258397.83560330886393785, -1509663.59685694938525558 258402.81018123403191566, -1509672.73980690562166274 258415.66050225775688887, -1509676.79523509461432695 258422.41116988193243742, -1509679.5166053082793951 258429.7082150150090456, -1509682.11673546675592661 258437.13105464540421963, -1509684.4064091476611793 258445.2843326386064291, -1509690.99516653525643051 258462.61619637254625559, -1509695.05058798263780773 258469.36685638781636953, -1509700.90760736959055066 258476.73676314856857061, -1509706.33338443213142455 258484.96201200596988201, -1509710.66995828039944172 258490.80434362031519413, -1509715.84164156462065876 258500.11578782647848129, -1509719.91504111653193831 258518.59248362015932798, -1509720.40176308201625943 258526.12693168502300978, -1509719.86711939563974738 258533.47732962667942047, -1509721.00167520041577518 258542.40648142527788877, -1509721.48974055331200361 258549.94048420805484056, -1509718.72046295506879687 258557.5282957348972559, -1509718.3066045930609107 258564.75378027185797691, -1509718.79467015690170228 258572.28777579311281443, -1509719.77957647247239947 258581.16527554020285606, -1509719.58142212918028235 258590.640343077480793, -1509722.38710105791687965 258606.5058890450745821, -1509723.52299826475791633 258615.43457686435431242, -1509728.1316105721052736 258631.91891892440617085, -1509734.78577681118622422 258646.09277453552931547, -1509738.12743583950214088 258654.60749297589063644, -1509741.77865927666425705 258662.39132287818938494, -1509747.63699017348699272 258669.76075741741806269, -1509752.80864525586366653 258679.07215270958840847, -1509756.43145482800900936 258686.67854614648967981, -1509759.1536858503241092 258693.97598607186228037, -1509762.65525445924140513 258701.70817075110971928, -1509766.02531381254084408 258710.40030901040881872, -1509767.4134919960051775 258718.2441088380292058, -1509769.73243485111743212 258726.57519847061485052, -1509770.2200353464577347 258734.11004147119820118, -1509771.3559195848647505 258743.03869028389453888, -1509771.43934577493928373 258751.60672978777438402, -1509771.64624390657991171 258760.048988351598382, -1509770.01150965830311179 258776.56580175645649433, -1509771.40057450975291431 258784.41003539878875017, -1509773.71951306168921292 258792.74110458604991436, -1509774.85539503674954176 258801.66973276901990175, -1509774.93882041680626571 258810.2377515621483326, -1509776.32788331992924213 258818.08197539672255516, -1509773.55861213314346969 258825.66969368979334831, -1509771.34316283860243857 258832.2758497316390276, -1509773.01427076454274356 258839.21220845077186823, -1509774.21560736419633031 258844.98293981421738863, -1509771.03292807773686945 258859.79515429027378559, -1509764.90278504835441709 258876.6092926487326622, -1509763.18463043496012688 258884.55803321674466133, -1509757.7682307343930006 258899.60807868279516697, -1509755.14950562734156847 258907.24785844329744577, -1509752.7835267607588321 258913.80189632344990969, -1509751.31855642190203071 258920.66622963454574347, -1509748.54929694416932762 258928.25390959158539772, -1509747.98655289015732706 258930.06917917635291815, -1509739.5188653354998678 258953.61471380572766066, -1509736.90014722291380167 258961.25447301939129829, -1509732.58160504419356585 258967.13804459385573864, -1509728.66723475116305053 258971.98842413444072008, -1509719.69308725674636662 258976.27289088815450668, -1509716.49245265824720263 258979.35920317564159632, -1509713.87374076689593494 258986.99895170796662569, -1509708.45737376133911312 259002.0489184595644474, -1509706.99286848050542176 259008.9123293524608016, -1509704.56188854621723294 259018.62553301546722651, -1509704.36506435391493142 259028.10222198162227869, -1509704.59949433361180127 259036.72135032154619694, -1509705.21891173021867871 259037.93860393855720758, -1509706.91843093372881413 259045.05232842545956373, -1509708.93659766460768878 259047.92157775443047285, -1509716.59675920847803354 259050.55262238904833794, -1509722.52049138094298542 259054.76411367114633322, -1509728.72492146515287459 259058.06819535885006189, -1509736.88237040652893484 259062.04183467663824558, -1509740.8526454996317625 259065.5824254285544157, -1509748.04361551883630455 259072.40585560631006956, -1509752.59626034297980368 259080.49897735752165318, -1509755.60005551297217607 259086.88935533445328474, -1509758.32226109132170677 259094.18668733816593885, -1509759.09279192169196904 259100.81402195710688829, -1509760.91399230062961578 259107.80105300340801477, -1509765.13797611254267395 259131.68829238135367632, -1509765.90850525069981813 259138.31561765633523464, -1509770.17998679005540907 259147.31702328287065029, -1509771.85108254011720419 259154.2532970979809761, -1509774.57328139687888324 259161.55061344057321548, -1509776.89219886739738286 259169.88156294450163841, -1509780.94708796008490026 259176.63296844810247421, -1509785.81880676350556314 259180.48296024091541767, -1509793.76053365180268884 259182.20706638135015965, -1509802.88487099530175328 259183.33228329662233591, -1509812.10264039505273104 259181.47574867680668831, -1509820.79471686319448054 259178.09919816628098488, -1509827.75036594620905817 259176.30308101512491703, -1509837.58755216747522354 259175.66379985399544239, -1509847.67881048051640391 259173.94059268571436405, -1509856.24876660574227571 259170.68938092887401581, -1509864.25552392634563148 259169.25431228242814541, -1509871.21117881289683282 259167.4581978740170598, -1509880.4014406690839678 259165.42469398770481348, -1509888.004028279799968 259165.02280928380787373, -1509905.78295577061362565 259166.1076603764668107, -1509913.29299556207843125 259168.68799231853336096, -1509921.38449814938940108 259175.82039740961045027, -1509922.28550054156221449 259176.13069841265678406, -1509928.23672413174062967 259180.5191873786970973, -1509945.23687685141339898 259186.52729339245706797, -1509951.44173635472543538 259189.83051155973225832, -1509958.4816739724483341 259196.6027653506025672, -1509963.43799404427409172 259203.66360531188547611, -1509967.06161727197468281 259211.27034755330532789, -1509968.76063521206378937 259218.38495041709393263, -1509971.76484798733144999 259224.77443643286824226, -1509972.81595011078752577 259225.13548531290143728, -1509960.40636051003821194 259223.88567850645631552, -1509955.50624693860299885 259219.85823696572333574, -1509949.24518694193102419 259213.52162631694227457, -1509948.74790534772910178 259212.1790366331115365, -1509945.05881155165843666 259207.73013695143163204, -1509931.81368413427844644 259203.01219893246889114, -1509925.89043723861686885 259198.79979506321251392, -1509917.73301922343671322 259194.82612469140440226, -1509910.19546493724919856 259192.06881676986813545, -1509902.40427290368825197 259190.39678324293345213, -1509894.18138853693380952 259189.58095654845237732, -1509886.5779153595212847 259189.98238349705934525, -1509877.66970330220647156 259191.10803754255175591, -1509869.38179317093454301 259193.45139818359166384, -1509860.19199306797236204 259195.48400565143674612, -1509850.0727646395098418 259197.03112301137298346, -1509841.16455774055793881 259198.15678104665130377, -1509830.30424737557768822 259198.61109549179673195, -1509820.89875754667446017 259198.3941692840307951, -1509803.20447834115475416 259200.52015752717852592, -1509795.60101376543752849 259200.92159492615610361, -1509786.47668055351823568 259199.79637787025421858, -1509776.58328767633065581 259197.40227567218244076, -1509770.44344451860524714 259190.93990636803209782, -1509761.30070211831480265 259178.08763389103114605, -1509757.93067891872487962 259169.39564570225775242, -1509756.54073479073122144 259161.55107985809445381, -1509752.88955637626349926 259153.76738547626882792, -1509750.16646429873071611 259146.46961646340787411, -1509748.49536501779220998 259139.53334333095699549, -1509748.00776539347134531 259131.99862896464765072, -1509746.30825593904592097 259124.88492307905107737, -1509742.96574569819495082 259116.36989597883075476, -1509741.76441283011808991 259110.59922930225729942, -1509742.2990531213581562 259103.2490127133205533, -1509739.29525744379498065 259096.85864037275314331, -1509734.33844274934381247 259089.79871022794395685, -1509727.51414694846607745 259085.27826893422752619, -1509720.97100288118235767 259079.84952743630856276, -1509715.01975418231450021 259075.4610632536932826, -1509713.49933307059109211 259073.93351417221128941, -1509706.67503370717167854 259069.41307525523006916, -1509700.10436568292789161 259063.8073600884526968, -1509695.91660659294575453 259058.01632009074091911, -1509689.6279777258168906 259051.50275727920234203, -1509687.33655850356444716 259043.34875963628292084, -1509685.51579874637536705 259036.36082908976823092, -1509685.43101204070262611 259027.79334077797830105, -1509686.6795273891184479 259024.03569818660616875, -1509687.64584809308871627 259015.82924742996692657, -1509689.36398222181014717 259007.88056030590087175, -1509690.67794778081588447 259000.96505871415138245, -1509692.82822688249871135 258992.15926124528050423, -1509692.74344155727885664 258983.59175610449165106, -1509693.99150459514930844 258979.83499735035002232, -1509695.79383908305317163 258975.09579402394592762, -1509704.54264834988862276 258950.64198494888842106, -1509709.42392932693473995 258942.9431407144293189, -1509713.09464172506704926 258935.6648732628673315, -1509715.45972297736443579 258929.11039030272513628, -1509718.07932825176976621 258921.47107473853975534, -1509725.17592313489876688 258901.80716744717210531, -1509727.11020662961527705 258896.10934439580887556, -1509729.54119916446506977 258886.39608415216207504, -1509733.27737310458905995 258875.95992162451148033, -1509734.52620488731190562 258866.84466477483510971, -1509734.3567975265905261 258855.06624883040785789, -1509737.22037570085376501 258844.49720419850200415, -1509744.28901907312683761 258824.65713684540241957, -1509751.90289378771558404 258791.27497292216867208, -1509751.26506267208606005 258778.3304506866261363, -1509750.77700507082045078 258770.79651550482958555, -1509750.69357477384619415 258762.22848546132445335, -1509749.83884255192242563 258752.39153147302567959, -1509747.52078710333444178 258744.06090711988508701, -1509745.56851600529626012 258738.03284181840717793, -1509744.02890752535313368 258730.13650541193783283, -1509742.39617881737649441 258719.86435575503855944, -1509739.05452564102597535 258711.34965690039098263, -1509734.31411110609769821 258701.18294149078428745, -1509731.56435673520900309 258693.70852901972830296, -1509732.96342424186877906 258690.00291788764297962, -1509730.51354833436198533 258687.98985958658158779, -1509724.87181056477129459 258682.87046862300485373, -1509718.30062997504137456 258677.26558634359389544, -1509713.49475604901090264 258670.25676452741026878, -1509711.88923390279524028 258665.51920509990304708, -1509711.73988992418162525 258660.10993622802197933, -1509712.55657550785690546 258651.85171408858150244, -1509712.96997768944129348 258644.62714905105531216, -1509713.53348282352089882 258637.45332771353423595, -1509711.83483789511956275 258630.33994368277490139, -1509712.03210080228745937 258620.8644392741844058, -1509710.49337181565351784 258612.96852493472397327, -1509705.94067063368856907 258604.87528195232152939, -1509702.93727045669220388 258598.48614743631333113, -1509702.44965678500011563 258590.951270024292171, -1509701.4642928943503648 258582.07466816529631615, -1509702.56302313297055662 258572.90855049341917038, -1509702.9768786896020174 258565.68306999281048775, -1509701.70992334163747728 258557.71343623008579016, -1509700.57402023416943848 258548.78473079111427069, -1509700.36845097248442471 258540.34196833893656731, -1509698.95139123010449111 258532.32158092316240072, -1509696.633314851205796 258523.99089454486966133, -1509693.29163844836875796 258515.47614283207803965, -1509692.86024619755335152 258510.97471256926655769, -1509690.42003903724253178 258502.76936206687241793, -1509686.51515868050046265 258496.07080207485705614, -1509681.55915703112259507 258489.01119901798665524, -1509678.05755859683267772 258481.27896945457905531, -1509674.68835516436956823 258472.58722811285406351, -1509670.37975067016668618 258466.92098670639097691, -1509666.10907290270552039 258457.91983807180076838, -1509663.38724816357716918 258450.6236944580450654, -1509663.85643478785641491 258446.4312045881524682, -1509663.36970214638859034 258438.89673825539648533, -1509660.3653954432811588 258432.50711831171065569, -1509654.50791060877963901 258425.13810182269662619, -1509649.8897337457165122 258420.20274975150823593, -1509642.6440365114249289 258404.98985449876636267, -1509640.32548895501531661 258396.66002839058637619, -1509637.60322128958068788 258389.36252644378691912, -1509631.09877833863720298 258380.5992452185600996, -1509624.67764766607433558 258375.04508374538272619, -1509616.11678070155903697 258372.10510429088026285, -1509608.57862596586346626 258369.34873288404196501, -1509602.3736381339840591 258366.04552661255002022, -1509594.86300317384302616 258363.46613772585988045, -1509585.92578291799873114 258364.41543507948517799, -1509575.83391112531535327 258366.1397496834397316, -1509568.22985984547995031 258366.54221269674599171, -1509558.41957960603758693 258367.35954542458057404, -1509551.37872630986385047 258365.94580459594726563, -1509535.40137524949386716 258360.12502969987690449, -1509526.55757351382635534 258358.09248991031199694, -1509508.44033579621464014 258349.52687653340399265, -1509499.78544064960442483 258344.21062613278627396, -1509493.42945300787687302 258340.85623657703399658, -1509484.37038547056727111 258336.5732085220515728, -1509477.82754389615729451 258331.14575786329805851, -1509470.35526984580792487 258325.23058173153549433, -1509464.71390022430568933 258320.11253226082772017, -1509459.47580934618599713 258313.96080853324383497, -1509452.9707102682441473 258299.83940248657017946, -1509450.39867624058388174 258297.9516880763694644, -1509446.06205649604089558 258292.10936248395591974, -1509443.74346816423349082 258283.7795317592099309, -1509440.12057796795852482 258276.17308362945914268, -1509437.39916238514706492 258268.87603353336453438, -1509432.84592861263081431 258260.78364064916968346, -1509428.53771442361176014 258255.11874532792717218, -1509425.53425495279952884 258248.72957139369100332, -1509417.57384115899913013 258235.2803315157070756, -1509412.33573510777205229 258229.1286005824804306, -1509399.62576453387737274 258217.06303891073912382, -1509396.90433915867470205 258209.76597905345261097, -1509392.78278326382860541 258200.81733272038400173, -1509391.2439840470906347 258192.92133207339793444, -1509388.6442298146430403 258185.49981481395661831, -1509385.92280079307965934 258178.20274812169373035, -1509382.2998930518515408 258170.59628148563206196, -1509378.39448952674865723 258163.89858860149979591, -1509377.59725266555324197 258157.09451603796333075, -1509374.47119728778488934 258150.83156339172273874, -1509360.22219572705216706 258125.51314204186201096, -1509355.95231880247592926 258116.51240146718919277, -1509353.01426590722985566 258106.96524588763713837, -1509350.69610544317401946 258098.63447910267859697, -1509346.45329184387810528 258089.81160516571253538, -1509340.36210235883481801 258073.82360371295362711, -1509340.21270960965193808 258068.41423048079013824, -1509342.2307447325438261 258065.92669656779617071))";
		
		List<SkeletonPoint> riverPoints = new ArrayList<>();
		riverPoints.add(new SkeletonPoint(new Coordinate(-1509750.77700507082045078, 258770.79651550482958555)	,Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1509741.77865927666425705, 258662.39132287818938494)	,Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1509378.39448952674865723, 258163.89858860149979591)	,Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1509428.53771442361176014, 258255.11874532792717218)	,Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1509342.2307447325438261, 258065.92669656779617071)	,Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1509972.81595011078752577, 259225.13548531290143728)	,Type.BANK, FlowDirection.OUT, null));
		
		Polygon polygon = (Polygon)reader.read(waterbody);
		SkeletonGenerator g = createGenerator(1.0,0.2,1.0);
		SkeletonResult items = g.generateSkeleton(polygon,  riverPoints);
		
		Assert.assertEquals("Errors existing in skeleton results", 0, items.getErrors().size());
		Assert.assertNotEquals("No skeletons generated", 0, items.getSkeletons().size());
		items.getSkeletons().forEach(ls->System.out.println(ls.toText()));
		items.getErrors().forEach(e->System.out.println(e));
	}
	
	
	@Test
	public void testAcuteAngle() throws Exception{
		String waterbody = "POLYGON (( -1541073.460576151 369504.35093982704, -1541062.8821271036 369505.59772521793, -1541053.4347350441 369506.7112032287, -1541047.2615091305 369500.7980470685, -1541046.4222708934 369499.9946488952, -1541039.8885377217 369494.45793635026, -1541035.5579631303 369488.70621535555, -1541025.226533358 369476.4331555376, -1541031.7815857572 369478.7910329532, -1541019.5873579148 369471.217614511, -1541010.63740688 369463.80520033464, -1541000.1145140408 369457.83940814994, -1541004.1441711234 369448.16958494164, -1541007.7757270539 369439.4550707536, -1541017.7885714853 369444.063775057, -1541027.3964756273 369452.88769474067, -1541034.6533179684 369461.8722166838, -1541048.1990729456 369474.12637802865, -1541057.5421691993 369483.8616266819, -1541067.3631069225 369494.77626387775, -1541073.460576151 369504.35093982704 ))";
		
		List<SkeletonPoint> riverPoints = new ArrayList<>();
		riverPoints.add(new SkeletonPoint(new Coordinate(-1541062.8821271036, 369505.59772521793), Type.FLOWPATH, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1541004.1441711234, 369448.16958494164), Type.FLOWPATH, FlowDirection.OUT, null));
		
		riverPoints.add(new SkeletonPoint(new Coordinate(-1541025.226533358, 369476.4331555376), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate( -1541034.6533179684, 369461.8722166838), Type.BANK, FlowDirection.IN, null));
		
	    
		Polygon polygon = (Polygon)reader.read(waterbody);
		SkeletonGenerator g = createGenerator(1.0,1.0,1.0);
		SkeletonResult items = g.generateSkeleton(polygon,  riverPoints);
		Assert.assertEquals("Errors existing in skeleton results", 0, items.getErrors().size());
		Assert.assertNotEquals("No skeletons generated", 0, items.getSkeletons().size());
		items.getSkeletons().forEach(ls->System.out.println(ls.toText()));
		items.getErrors().forEach(e->System.out.println(e));
	}
	
	@Test
	public void testBcPolygon() throws Exception{

		String waterbody = "POLYGON ((-1545869.3286950625 285787.3150288332, -1545842.5547687113 285790.43232987076, -1545828.0780448446 285792.6970818341, -1545824.805323903 285792.54698213097, -1545813.7331697675 285794.00126487017, -1545785.6513173506 285804.0434057964, -1545757.933980052 285816.3986972226, -1545730.2834382458 285830.9587039994, -1545718.7732759481 285839.47816924565, -1545705.597766155 285846.4011648316, -1545694.568778884 285832.92844594177, -1545688.7380764356 285813.9079967281, -1545684.6758833053 285795.3447368769, -1545680.425172445 285774.7009903472, -1545677.137700746 285751.2074191626, -1545675.264558867 285735.770065384, -1545674.475509464 285717.35818713903, -1545676.5286858745 285699.95254566893, -1545680.341795071 285686.5263345493, -1545688.2777076268 285667.00461657066, -1545698.3296402982 285659.9840969434, -1545704.6209252037 285645.2522942554, -1545706.2732122107 285628.8796749944, -1545705.0172892972 285614.6678875806, -1545700.3581332772 285601.26614997257, -1545685.633487506 285576.91672196984, -1545668.5519638497 285553.7472638218, -1545650.8539886074 285534.72623209376, -1545639.732027134 285524.2427257253, -1545628.9187994502 285513.0295335073, -1545620.0227392507 285502.32707905583, -1545599.6033375724 285482.17509976774, -1545588.510039008 285471.87029543426, -1545576.9858043375 285462.4203199437, -1545566.2292097071 285454.25044803973, -1545554.3031756599 285445.8331123432, -1545541.1715615862 285437.82954955474, -1545508.4998799074 285419.7240032712, -1545492.1228743643 285411.7472875947, -1545462.0150771067 285400.9287174791, -1545447.2370247177 285397.71649496164, -1545430.197131177 285398.0686133448, -1545414.2425883114 285400.81938636955, -1545383.3148978131 285404.4847794138, -1545357.8672593983 285407.0684823124, -1545340.1814717047 285406.01627938077, -1545322.9261571798 285404.11014438886, -1545296.0636686422 285398.63847552333, -1545280.3888047002 285395.1081550224, -1545265.2098641354 285392.92908017896, -1545248.5708917954 285392.24816322327, -1545232.4655375474 285389.5740334736, -1545219.0156913628 285385.82431096956, -1545190.7037487845 285375.6422428796, -1545175.308015998 285371.20535319205, -1545162.1390981802 285366.54771508556, -1545147.6419815295 285362.42765493505, -1545132.6489359539 285356.95636139065, -1545118.2164080506 285349.66964250803, -1545105.2329228823 285341.72064856533, -1545092.810862782 285331.9544447018, -1545066.7304626412 285309.9720842065, -1545038.9564272715 285280.84228809644, -1545031.2388555747 285269.55060753133, -1545020.188296274 285244.32094774675, -1545010.6526732899 285220.635515837, -1545000.3785202778 285195.8477821313, -1544989.3274712032 285170.61896500643, -1544982.29868094 285145.80432169046, -1544977.1745743295 285103.5315246666, -1544974.7852833604 285074.98522066977, -1544973.248610049 285061.68257230055, -1544972.6313701198 285060.45692106057, -1544970.944704269 285047.1011628024, -1544970.9889090462 285032.17561010923, -1544973.9054375184 285018.4322805917, -1544982.0769345397 285007.5557612255, -1544990.717917862 284997.8518053917, -1544998.273527619 284985.7491826145, -1545002.985068733 284972.64167204313, -1545003.459773879 284956.8598746946, -1545002.455825645 284941.5634486871, -1545002.3132896195 284924.55597305205, -1545001.3748118596 284906.0932596959, -1545003.3931856214 284892.032140838, -1545003.652861642 284879.364804212, -1544999.6566406663 284857.637528236, -1545014.312690415 284855.6009833487, -1545026.2824663597 284852.3515089527, -1545029.6227718336 284851.44512555934, -1545043.6333343755 284848.00556769036, -1545051.4074240786 284843.7375588808, -1545054.325114427 284859.3407753147, -1545057.676704382 284879.66550839506, -1545055.8078691503 284893.7784014577, -1545052.9195570056 284907.69917491917, -1545052.595279612 284923.53322773986, -1545051.2223831234 284938.99734940566, -1545050.2517249351 284953.427913473, -1545050.284543558 284983.15578022413, -1545049.8098210755 284998.9375704173, -1545050.1673705184 285012.8305073567, -1545049.2258560467 285027.43883507326, -1545049.1811688687 285042.36529838573, -1545049.726810663 285058.33961514384, -1545053.846038902 285085.3157356009, -1545048.5450527065 285097.3757756632, -1545043.8343980857 285110.48366910405, -1545044.5070148418 285158.5694821663, -1545044.778734569 285163.8697623564, -1545047.5789972057 285179.8014771445, -1545052.1742484064 285196.3690361241, -1545054.7581617334 285210.04198729154, -1545058.8574755471 285225.25828724913, -1545071.573412114 285252.08444354776, -1545088.2539911445 285276.2832503747, -1545099.4983149467 285286.63925532904, -1545112.2004305907 285295.4970817249, -1545134.3310621062 285307.68861223944, -1545147.8663276678 285314.6580849858, -1545161.6802906606 285320.7196085602, -1545191.0780848602 285333.2994109811, -1545232.4381314863 285348.2638393594, -1545252.903376555 285353.4875648059, -1545276.0613339162 285359.6635297444, -1545298.2556733678 285363.31661106367, -1545322.7852691854 285354.0291456748, -1545339.0207480723 285350.37039899733, -1545366.3939628731 285342.08873052895, -1545382.62991107 285338.4290986676, -1545397.7961087797 285322.64030492026, -1545383.9166520578 285319.744932916, -1545369.5686148736 285315.6774536399, -1545344.9983863116 285306.8187937606, -1545332.4462419357 285303.3854102446, -1545308.9232731652 285294.89713420067, -1545296.3715601503 285291.46510636806, -1545272.295958059 285278.5845144084, -1545258.6301968587 285272.57514635567, -1545254.1221006147 285269.9733469067, -1545245.095811982 285265.6060863165, -1545229.9805387955 285260.2598989494, -1545215.2033382207 285257.0482139345, -1545182.9535488763 285249.6712703053, -1545155.904667942 285242.11922039, -1545141.191169057 285235.7404206423, -1545126.543148406 285226.1953950748, -1545115.299267423 285215.8384735929, -1545097.1045804273 285195.4694692837, -1545096.4873453784 285194.2438201187, -1545101.4060206325 285189.60339622945, -1545105.901233516 285174.2372491155, -1545109.966869874 285159.72549240105, -1545123.943277567 285121.1851298772, -1545128.0089256344 285106.6733356016, -1545132.440454005 285094.47428421956, -1545135.8242791318 285081.90352111496, -1545141.2176868222 285066.8550037034, -1545145.994317466 285050.57992756274, -1545151.1081423801 285036.438897362, -1545159.5619722449 285024.6540024951, -1545174.721171442 285015.07321403176, -1545201.973275677 285001.5431229202, -1545225.887601888 284991.0283720698, -1545238.8504286988 284987.2194309924, -1545253.477334308 284985.00516974647, -1545268.3860697446 284981.8834156608, -1545283.3793080682 284981.9810379641, -1545297.5770711415 284980.6225408958, -1545330.7314911808 284971.3632502556, -1545348.5480409202 284966.0792267937, -1545365.0368165695 284961.33413769864, -1545391.5421492266 284952.9127409486, -1545408.9291133767 284948.48537168186, -1545425.781997148 284946.0521577364, -1545439.4470506008 284946.6874012882, -1545452.681605211 284948.1788424421, -1545468.020355622 284949.5755612217, -1545484.2485235624 284952.12591661885, -1545508.4548762166 284958.67278882023, -1545539.8058380657 284965.7339708796, -1545568.8007967847 284973.97566018626, -1545581.633556125 284976.4997973526, -1545608.6826084896 284984.0543145519, -1545621.879442425 284988.8903362416, -1545633.0388368305 284996.02810697816, -1545643.6641314714 285005.1600319538, -1545663.933325294 285025.2578485077, -1545680.3315407054 285044.9940956924, -1545695.868299928 285066.4413759541, -1545707.964042849 285092.0432726331, -1545716.317993932 285116.32161407266, -1545718.8163590063 285126.7749393452, -1545719.4541830532 285139.7608853169, -1545718.6328327837 285154.24544986617, -1545717.2596932014 285169.70955104847, -1545713.6601704455 285185.39349194337, -1545696.371457648 285221.7550894348, -1545688.4714091786 285237.93181147706, -1545681.7760418225 285253.69652719796, -1545669.7248097206 285281.1651767297, -1545663.2167391528 285293.63712635636, -1545657.7664764186 285305.64444416575, -1545649.0329269327 285318.3366796486, -1545638.6340081126 285329.4324220978, -1545627.8988190657 285338.3945616884, -1545617.0326822563 285348.3177396413, -1545596.236665562 285370.5100919949, -1545592.860682276 285376.8707326697, -1545602.0086780565 285381.1138162473, -1545614.0930405548 285388.74703805335, -1545626.0190849844 285397.1644038325, -1545637.3924524677 285406.5608514026, -1545647.9539013568 285418.8598227706, -1545657.7472478389 285429.87957873195, -1545668.990537227 285440.2375233192, -1545679.4666146769 285449.3167088367, -1545702.4494245732 285476.7566073183, -1545713.4777294633 285484.85537405685, -1545724.0184268618 285490.7678868519, -1545736.0376564949 285501.5686998246, -1545747.561860904 285511.0187207712, -1545760.8814934841 285521.10373493936, -1545775.247927418 285531.5600169236, -1545796.3495419244 285549.7724117292, -1545800.2416007107 285556.5218076026, -1545803.9950298013 285575.81496250536, -1545818.0037112534 285572.3771364521, -1545827.8491768807 285556.8887650361, -1545834.6926414839 285546.5500981277, -1545844.445225473 285534.0510288393, -1545853.9460062522 285522.6376916412, -1545871.4033937121 285503.46256593335, -1545880.4732519991 285492.90403807256, -1545888.645842961 285482.02823315654, -1545907.6183261357 285459.0236798087, -1545916.7537454453 285445.2988901166, -1545924.5892066818 285432.2890037587, -1545933.1640810322 285420.37963263504, -1545940.9990979736 285407.3706200663, -1545946.9466899396 285396.7141623758, -1545952.2757292592 285384.8324694177, -1545956.9875595646 285371.72510289494, -1545960.493371886 285359.03014910873, -1545964.9902545104 285343.6635630373, -1545966.6440000103 285327.2902412107, -1545966.5672686058 285312.4880073564, -1545963.7691358244 285296.5547907464, -1545956.5473689283 285281.2390500121, -1545956.658373087 285263.1453866605, -1545956.3666836156 285246.0839041509, -1545955.111718103 285231.87229527533, -1545954.4748551208 285218.8868058361, -1545955.1456760496 285193.6034577396, -1545956.0893043608 285178.9937301222, -1545956.7797748812 285165.4701885786, -1545958.2188570478 285152.21260568034, -1545959.5728950484 285124.9876902001, -1545967.40931935 285111.97804689594, -1545980.0065516492 285100.4849786274, -1545991.088406801 285087.4484963631, -1545994.9043455084 285074.0232337825, -1545994.547557258 285060.12924553733, -1545993.9107031317 285047.1436571572, -1545991.0474498153 285034.3779083723, -1545983.545580308 285019.9704273408, -1545974.3145590723 285007.1336328015, -1545964.8016900306 284995.2043369729, -1545954.3910783685 284982.9586584158, -1545929.5492055125 284963.4232574878, -1545899.572642395 284946.26864678785, -1545866.7524406393 284928.10822746996, -1545831.3035592488 284911.2012433503, -1545815.6935867202 284904.5031356076, -1545799.8026605626 284898.71299119666, -1545787.811395462 284893.4631289318, -1545775.4468433242 284886.73819257785, -1545747.4801753045 284872.47880073264, -1545732.9170091264 284866.15198652167, -1545718.700221076 284861.12246007565, -1545703.922422663 284857.90931034274, -1545689.9768201113 284858.1810829919, -1545674.4511850814 284860.0762162404, -1545659.2056123456 284861.06294001546, -1545632.980271162 284863.2021221826, -1545619.4656180388 284862.6190580595, -1545606.0810316736 284861.07448024396, -1545573.3357926614 284857.7180501688, -1545559.456175078 284854.82266466133, -1545545.323408441 284853.01348937955, -1545528.3187639818 284850.0211556321, -1545510.6982329646 284845.8027160615, -1545496.7804472395 284846.2527866522, -1545483.452098076 284847.75028721057, -1545468.8892885826 284846.7964414181, -1545455.0092178218 284843.90197783336, -1545440.9424154737 284838.92564603314, -1545427.4923891728 284835.17588342354, -1545412.8447131342 284825.62977866083, -1545403.0511083833 284819.9836819852, -1545397.701030774 284820.10617426876, -1545370.4557998835 284822.0542637203, -1545359.4075239867 284796.8240340147, -1545345.4505398956 284773.75564087834, -1545340.7260602629 284768.8950137859, -1545333.0278875942 284763.99011224136, -1545307.5587081562 284754.81464253366, -1545293.8091692827 284745.5862842286, -1545282.7802155085 284732.11686685774, -1545273.3118913325 284705.26323336083, -1545259.635779834 284681.28685840406, -1545243.4527488723 284658.4396702582, -1545235.052374406 284649.0883417679, -1545221.947377025 284641.26480699424, -1545207.5708623708 284637.0200464949, -1545201.4826792323 284636.0416053636, -1545187.170760372 284628.63008440007, -1545172.5512209635 284619.2636312712, -1545140.82212416 284591.9265005784, -1545129.0175254808 284583.3871350996, -1545106.1184057042 284564.5446730787, -1545096.8857246418 284551.7106755832, -1545081.8808076892 284528.2727824291, -1545074.3126448316 284517.0348135121, -1545056.1180772274 284496.6667717695, -1545045.2849979927 284473.6970228758, -1545040.5418824598 284457.0781678846, -1545029.5583652274 284428.68235735316, -1545025.3957007257 284416.63419763185, -1545019.0513014891 284389.87908856664, -1545015.6363922136 284372.7225727122, -1545011.3232952477 284355.24833864905, -1545003.183830165 284327.8595584212, -1544989.76847224 284291.2171947872, -1544982.097128447 284265.00139757805, -1544978.4012594847 284248.75278854836, -1544973.4054132323 284233.2191541288, -1544964.6295947863 284198.2187609989, -1544961.5801096624 284183.3736182647, -1544953.291476736 284155.93204123154, -1544944.5259273343 284138.898871894, -1544941.1109693206 284121.7422123384, -1544939.2397077463 284106.3063000422, -1544930.2028505716 284078.6000527004, -1544923.4305149652 284052.7022385355, -1544920.1000703054 284038.7650100896, -1544917.3115432432 284016.6254805792, -1544926.3845262602 284006.0665695332, -1544944.119523659 283992.18994681817, -1544950.368781993 283987.01158644166, -1544951.6779602454 283980.0880737798, -1544948.028916785 283948.91443942767, -1544945.8776016976 283934.38686482515, -1544943.9789677383 283918.77392853703, -1544942.7258442568 283904.56404421944, -1544942.2448595287 283883.2683609063, -1544941.7810184294 283862.7622948168, -1544936.9824067957 283837.7296871012, -1544937.5438416458 283830.5406348277, -1544941.8940326476 283815.1218335591, -1544952.127156744 283786.84090131335, -1544959.938316061 283773.6535410499, -1544971.3882556225 283762.9267675709, -1544992.7444206497 283750.498141231, -1545001.4064883157 283747.18037713785, -1545007.6553342794 283747.3745765202, -1545015.9059511896 283751.2990022646, -1545038.6737142662 283776.4719198374, -1545056.5863348877 283797.74656959623, -1545071.9357299076 283817.1083347183, -1545080.765894973 283830.9748743428, -1545092.3636942634 283860.5943231033, -1545094.5154208876 283875.1210853942, -1545096.1994322636 283888.47612988856, -1545096.4321153255 283902.4934990313, -1545095.5420865482 283915.7064501494, -1545095.4596425937 283916.9237991115, -1545095.4122742421 283931.8495986778, -1545099.2285494893 283947.9723809296, -1545104.2517540928 283963.68312616367, -1545116.0653956258 283995.5621976163, -1545138.0755250612 284032.05285688397, -1545148.2993504764 284042.21530625876, -1545154.884469953 284044.5432341853, -1545171.591241712 284042.05611999705, -1545186.3702065055 284045.26725822873, -1545208.0714854759 284052.94048050325, -1545220.717759176 284053.382517254, -1545227.433856104 284049.37767408974, -1545233.036765143 284042.7958234241, -1545242.316499878 284011.15573032945, -1545247.975624117 283983.44042756874, -1545254.8983968229 283958.35431760177, -1545256.1534068678 283949.69299110305, -1545679.3373573455 284039.2435679771, -1545761.8113257196 284056.6968465356, -1545867.2012374306 284078.99963519257, -1546267.468222138 284163.7055334849, -1546268.277600043 284168.37666149624, -1546271.006125317 284187.4761575889, -1546271.9773889699 284202.5950636305, -1546275.0537885593 284217.61969313957, -1546290.5875109332 284239.0674013691, -1546295.029669237 284244.8366714623, -1546298.7888483433 284257.92059435137, -1546300.0410672824 284272.13147557527, -1546300.8910071347 284287.37593827303, -1546300.842759929 284302.3026572941, -1546303.7590326515 284318.11051225755, -1546307.4526324864 284334.3608034309, -1546312.4462379469 284349.89612480626, -1546317.1871219012 284366.51678627264, -1546316.9888751209 284381.39035231527, -1546313.1242468043 284404.3696947815, -1546309.0361342516 284412.4935181346, -1546282.696094527 284432.72430541366, -1546262.3890367288 284450.89195997454, -1546245.2057282196 284469.15701560304, -1546240.1543232973 284480.1308021685, -1546237.665609063 284493.01841247175, -1546239.8438160776 284507.7251310218, -1546245.1183863166 284522.3523545917, -1546265.657571375 284542.3810043391, -1546271.5775948828 284558.4112886386, -1546274.9906541845 284575.57074124645, -1546275.812802465 284590.6367570674, -1546273.969981348 284604.9287237795, -1546269.6009328521 284613.9604393514, -1546249.2948577332 284632.1283596903, -1546241.0546449856 284646.1701018326, -1546234.488321845 284655.5994661283, -1546233.0293815674 284662.47110832855, -1546233.383864291 284676.36535537895, -1546232.8415123723 284689.9414252648, -1546226.3503403047 284719.54548964836, -1546225.8075361475 284733.12242442276, -1546227.9775148102 284759.4108435642, -1546230.9789176632 284783.81213937793, -1546234.6733901263 284800.0625734199, -1546231.2876841135 284818.00566448737, -1546248.2165114088 284830.37700462993, -1546242.819510081 284845.42534987815, -1546237.5540966634 284854.1401344361, -1546229.3148199366 284868.1821744321, -1546224.4788639792 284881.4141123621, -1546224.1514595873 284897.2493163217, -1546228.4640257042 284914.72582567576, -1546232.5603027001 284929.9435110064, -1546237.3024710673 284946.56558541115, -1546241.2496392175 284961.73060259596, -1546244.4768725014 284976.80834484193, -1546245.7304088303 284991.02060193475, -1546249.490422763 285004.1046013562, -1546251.0253723005 285017.4079965688, -1546247.639402622 285029.97802266385, -1546242.9265451187 285043.08517468255, -1546234.6404000598 285072.0551087726, -1546233.4624334716 285078.01866943017, -1546237.278621616 285094.1446703514, -1546236.6163075778 285107.84566174634, -1546236.9716732062 285121.7401091261, -1546241.2646414426 285127.4565629605, -1546241.0688158176 285136.95813278947, -1546235.0555353533 285150.7810324142, -1546229.295425033 285163.517723931, -1546225.0782128097 285172.6032082159, -1546225.9299363228 285187.848002729, -1546231.4968939074 285219.5368972225, -1546233.3958826493 285235.1520493077, -1546235.5484695043 285249.6823432958, -1546239.0283927456 285263.6746141892, -1546244.032365993 285267.62780396454, -1546259.5570438222 285265.7347176522, -1546267.067024615 285268.56057378184, -1546271.8469157228 285281.83792683575, -1546270.2859724732 285295.22197333816, -1546264.4611918957 285311.1253043199, -1546257.8868977972 285326.7644328559, -1546250.612321514 285337.9580636285, -1546244.3841263866 285349.5216186987, -1546229.703412871 285378.24225829076, -1546224.3082646728 285393.29112502, -1546224.4789927732 285410.47727436386, -1546229.1937497472 285426.9221461443, -1546237.125537954 285440.4742252147, -1546244.1313454409 285453.53255796526, -1546252.7467825864 285465.1445063036, -1546272.4536153018 285487.0628163768, -1546280.3858151983 285500.6162284333, -1546291.367836451 285529.01706427615, -1546298.73969538 285549.7609182643, -1546318.7271680164 285565.3984906385, -1546339.4627992054 285581.30069653224, -1546351.6669920105 285588.8112094244, -1546364.1812777638 285595.59160124883, -1546377.4998981634 285605.67861388065, -1546389.6398287988 285616.3571714265, -1546398.721957457 285629.1425597621, -1546404.427721906 285642.9157567816, -1546406.9456050126 285659.75726688094, -1546407.5749225633 285684.3267307766, -1546407.5301911691 285699.25442317873, -1546405.409075525 285714.4550170414, -1546402.7083674532 285730.45687703136, -1546397.1842541615 285751.84020806756, -1546395.8113114703 285767.3053937126, -1546394.9906255002 285781.79015921615, -1546394.1901532977 285813.40860428195, -1546398.3089127336 285840.3881269293, -1546403.7554238918 285866.83098055795, -1546409.7342763913 285891.2788146185, -1546413.430798421 285907.53086804785, -1546416.3513618014 285923.34004019666, -1546425.1090440198 285951.96257373784, -1546419.9957363107 285966.1035970915, -1546415.9097292728 285968.85412502196, -1546394.4403179516 285981.40226294566, -1546389.456852031 285989.2090921905, -1546386.0740340054 286001.77905276045, -1546381.642624906 286013.9790534908, -1546378.1107122155 286026.49634607136, -1546373.8292961102 286038.74943933915, -1546372.3712661492 286045.6211222019, -1546352.0810199594 286057.57902621664, -1546339.9531058017 286064.8713290943, -1546324.9174251147 286074.3235094063, -1546296.4912232521 286088.43933788966, -1546267.3912444205 286098.2862487957, -1546252.4211653287 286104.57225378416, -1546248.120070419 286110.4371655639, -1546246.8120523046 286117.36192423105, -1546244.2430143342 286127.0302590439, -1546242.1879986397 286139.0634897761, -1546235.7479265532 286153.74145631585, -1546231.5325868805 286162.8274159748, -1546227.0241733484 286160.2241948815, -1546217.5763087512 286145.12637763564, -1546201.3925073894 286122.2720278334, -1546184.8729017973 286097.2832275992, -1546178.548164933 286082.28376710974, -1546171.4550688278 286060.6324365977, -1546168.5263768116 286051.03330991976, -1546163.723401915 286025.995079848, -1546160.0268030795 286009.7431750735, -1546155.030247488 285994.2061444307, -1546145.8414514675 285966.44085506815, -1546139.5166831533 285951.4413378546, -1546130.620825973 285940.7366261063, -1546119.2472290664 285931.3387872819, -1546106.8268316165 285921.5696773147, -1546093.7232211118 285913.7419959102, -1546060.9047278727 285895.57766608056, -1546047.7728575587 285887.57264530566, -1546035.0714883876 285878.7114701178, -1546023.4832159514 285872.42718329746, -1546012.9426280241 285866.51462445315, -1546001.9153611558 285858.4140498955, -1545991.6552840185 285851.5922307186, -1545966.2515991416 285833.87169130985, -1545955.0089131217 285823.512857466, -1545945.495790617 285811.58251541015, -1545935.7021491963 285800.56143895816, -1545926.68446369 285789.98322561104, -1545913.6378888444 285785.19798909314, -1545898.6471075667 285785.09780916665, -1545884.4504301779 285786.4541742187, -1545869.3286950625 285787.3150288332))";
		List<SkeletonPoint> riverPoints = new ArrayList<>();
		
		riverPoints.add(new SkeletonPoint(new Coordinate(-1546226.3503403047, 284719.54548964836), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1546389.456852031, 285989.2090921905), Type.BANK, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1545718.7732759481, 285839.47816924565) , Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1545219.0156913628, 285385.82431096956), Type.BANK, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1545960.493371886, 285359.03014910873) , Type.BANK, FlowDirection.UNKNOWN, null));
		
		riverPoints.add(new SkeletonPoint(new Coordinate(-1545026.2824663597, 284852.3515089527), Type.WATER, FlowDirection.UNKNOWN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1545676.5286858745, 285699.95254566893), Type.WATER, FlowDirection.UNKNOWN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1545761.8113257196, 284056.6968465356), Type.WATER, FlowDirection.UNKNOWN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1545869.3286950625, 285787.3150288332) , Type.WATER, FlowDirection.UNKNOWN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1546267.067024615, 285268.56057378184) , Type.WATER, FlowDirection.UNKNOWN, null));
				
		Polygon polygon = (Polygon)reader.read(waterbody);
		
		SkeletonGenerator g = createGenerator(1,0.25,1);
		
		SkeletonResult items = g.generateSkeleton(polygon,  riverPoints);

		Assert.assertEquals("Errors existing in skeleton results", 0, items.getErrors().size());
		Assert.assertNotEquals("No skeletons generated", 0, items.getSkeletons().size());
		items.getSkeletons().forEach(ls->System.out.println(ls.toText()));
		items.getErrors().forEach(e->System.out.println(e));
	}
	

	@Test
	public void testSingleInSingleOut() throws Exception {
		List<SkeletonPoint> riverPoints = new ArrayList<>();

		String waterbody = "POLYGON (( -73.2700858 45.4554992,-73.2696859 45.4555921,-73.2696315 45.4556048,-73.2684482 45.4558798,-73.2674751 45.4561059,-73.2676032 45.4560251,-73.2677056 45.4559983,-73.2678852 45.4558277,-73.2679882 45.4556839,-73.2680908 45.4555942,-73.2681038 45.4555492,-73.2679892 45.455414,-73.2680023 45.45536,-73.2680408 45.4553151,-73.2681822 45.4551355,-73.2682336 45.4550815,-73.2682724 45.4549737,-73.2682471 45.4548836,-73.268286 45.4547757,-73.2684018 45.454605,-73.2683636 45.4545599,-73.2682737 45.4546497,-73.2678881 45.4551529,-73.2676571 45.4553413,-73.2672856 45.4555476,-73.2669653 45.4556819,-73.2667984 45.4558255,-73.2667728 45.4558704,-73.2667341 45.4559154,-73.2666953 45.4560232,-73.2667207 45.4560683,-73.2665147 45.4559953,-73.2663122 45.4559235,-73.2665811 45.455825,-73.2667094 45.4557443,-73.266863 45.4556816,-73.2670554 45.455556,-73.2671192 45.4555562,-73.2673113 45.4555026,-73.2673753 45.4554667,-73.2676701 45.4552963,-73.2678755 45.4551078,-73.2680813 45.4548112,-73.2681459 45.4546404,-73.2681345 45.4542895,-73.2680089 45.4537493,-73.2678578 45.4531911,-73.2678709 45.4531101,-73.2678335 45.4528671,-73.2678341 45.4527052,-73.2677835 45.452579,-73.267771 45.452516,-73.2677587 45.45239,-73.2677333 45.452345,-73.2677341 45.452174,-73.2677091 45.45203,-73.2678378 45.4518233,-73.2679017 45.4518234,-73.2679147 45.4517874,-73.2678008 45.4514813,-73.2675335 45.4511837,-73.2673296 45.4510484,-73.2667167 45.4508581,-73.2660657 45.4506049,-73.2658999 45.4505236,-73.2657977 45.4504963,-73.2654277 45.4503156,-73.2648916 45.4500986,-73.2640235 45.4497908,-73.2636538 45.449538,-73.2633097 45.4492944,-73.2632462 45.4491773,-73.2632469 45.4490513,-73.2631319 45.4490061,-73.262966 45.4489517,-73.2628385 45.4488525,-73.2627362 45.4488523,-73.2626469 45.4488341,-73.2623408 45.4486625,-73.2618436 45.4483375,-73.2616649 45.4482471,-73.2612441 45.4479943,-73.2607466 45.4477233,-73.260479 45.4475428,-73.2603388 45.4474525,-73.2601349 45.4472901,-73.2600966 45.447263,-73.2600584 45.447227,-73.2600332 45.4471549,-73.2599823 45.4470918,-73.2597656 45.4469384,-73.2597147 45.4469023,-73.260199 45.4464777,-73.2606834 45.446053,-73.2612363 45.4455842,-73.2617675 45.4451339,-73.2618441 45.445179,-73.2620095 45.4453413,-73.2620344 45.4455214,-73.2620978 45.4456115,-73.2622507 45.4457648,-73.2623783 45.4458191,-73.2625058 45.4458913,-73.2626589 45.4459456,-73.2629904 45.4461622,-73.2634241 45.4463791,-73.2635136 45.4463973,-73.2635518 45.4464064,-73.2636541 45.4464336,-73.2637562 45.4464608,-73.2640113 45.4465963,-73.2646114 45.4467865,-73.264918 45.4468231,-73.2651094 45.4469135,-73.2653263 45.44704,-73.2655555 45.4472293,-73.2656447 45.4473105,-73.2656314 45.4474365,-73.2656698 45.4474456,-73.2657211 45.4473827,-73.2659246 45.4476261,-73.2658987 45.447716,-73.2659494 45.447815,-73.2660894 45.4479503,-73.2661532 45.4479954,-73.266485 45.4481581,-73.266753 45.4482667,-73.2669445 45.4483121,-73.2670721 45.4483663,-73.267187 45.4484205,-73.2674807 45.4484931,-73.2675446 45.4485112,-73.2678766 45.4485839,-73.2680044 45.4486112,-73.2681704 45.4486475,-73.2683238 45.4486658,-73.2685283 45.4486842,-73.2687326 45.4487206,-73.2689754 45.4487481,-73.2692309 45.4487936,-73.2693588 45.4487939,-73.2700103 45.4489302,-73.2703167 45.4490118,-73.270483 45.4489941,-73.2706235 45.4490034,-73.2707766 45.4491027,-73.2709171 45.4491209,-73.2710834 45.4491033,-73.2714541 45.449131,-73.2716587 45.4491225,-73.2721442 45.4491684,-73.2722719 45.4491956,-73.2724125 45.4492049,-73.2728594 45.4493497,-73.2729998 45.449422,-73.2731148 45.4494402,-73.2733323 45.4493957,-73.2735241 45.4493871,-73.2735625 45.4493782,-73.2737416 45.4493515,-73.2739973 45.4493341,-73.2742402 45.4493255,-73.2744831 45.449326,-73.2747516 45.4493175,-73.2749306 45.4493358,-73.2751478 45.4493543,-73.2753012 45.4493726,-73.2753779 45.4493727,-73.275544 45.4494001,-73.275774 45.4494365,-73.2759399 45.4494728,-73.276055 45.4494821,-73.2761569 45.4495722,-73.2762846 45.4496085,-73.2764757 45.4497798,-73.2766035 45.4497981,-73.2767953 45.4497895,-73.2768593 45.4497716,-73.2772683 45.4497994,-73.2773323 45.4497636,-73.2769494 45.4508292,-73.2767814 45.4512967,-73.2764124 45.4523234,-73.2762853 45.452677,-73.2761961 45.4525868,-73.2761708 45.4525328,-73.276133 45.4523888,-73.2760948 45.4523526,-73.276031 45.4523256,-73.2757371 45.452271,-73.2756988 45.4522619,-73.2753794 45.4522163,-73.2752132 45.452225,-73.2750853 45.4522337,-73.2749573 45.4522605,-73.2749316 45.4522874,-73.2749186 45.4523504,-73.2750584 45.4525756,-73.2751221 45.4526117,-73.2753266 45.4526122,-73.2754543 45.4526843,-73.2756074 45.4527387,-73.2756842 45.4527388,-73.2757863 45.452766,-73.2758886 45.4527752,-73.2760676 45.4527485,-73.2762339 45.4527579,-73.2762979 45.452722,-73.2759202 45.4531151,-73.2757436 45.453299,-73.2752452 45.4538177,-73.2752583 45.4537098,-73.2753098 45.4536559,-73.2753227 45.453611,-73.275272 45.4534849,-73.2751955 45.4534577,-73.2751572 45.4534397,-73.275106 45.4534306,-73.2750675 45.4534754,-73.2750416 45.4535654,-73.2748621 45.453691,-73.2748235 45.453736,-73.2748362 45.4537809,-73.2748743 45.453826,-73.2749382 45.4538442,-73.2751683 45.4538626,-73.2743069 45.4540453,-73.273346 45.4542492,-73.2720588 45.4545223,-73.2716591 45.4547398,-73.2713668 45.4548989,-73.2713799 45.454809,-73.271342 45.4547099,-73.271291 45.4546648,-73.2711633 45.4546195,-73.2710995 45.4546104,-73.2710101 45.4546012,-73.2708822 45.4546009,-73.270805 45.4546998,-73.2708302 45.4547898,-73.2708171 45.4548798,-73.2708554 45.4549158,-73.270983 45.4549701,-73.2711108 45.4549883,-73.2713028 45.4549347,-73.2708521 45.4551438,-73.2707256 45.4552025,-73.2700858 45.4554992 ),( -73.2625829 45.4474245,-73.2625505 45.4474302,-73.2624993 45.4474301,-73.262461 45.4474119,-73.2623717 45.4473848,-73.2622316 45.4472585,-73.2621552 45.4471863,-73.2621436 45.4471731,-73.2620915 45.4471142,-73.2619642 45.447006,-73.2618877 45.4469428,-73.2618113 45.4468977,-73.2617345 45.4468885,-73.2617214 45.4468911,-73.261645 45.4469063,-73.261632 45.4469423,-73.2616574 45.4470053,-73.2617338 45.4470595,-73.2617721 45.4470866,-73.2618231 45.4471317,-73.2618994 45.4472038,-73.2619886 45.447285,-73.2620523 45.4473391,-73.2621032 45.4473662,-73.2621924 45.4474563,-73.2622818 45.4474746,-73.2623839 45.4475288,-73.2624729 45.4476189,-73.2625111 45.4476731,-73.2625621 45.4477091,-73.2626387 45.4477093,-73.2626774 45.4476553,-73.2627287 45.4476015,-73.2626395 45.4475293,-73.2626269 45.4474843,-73.2626073 45.4474354,-73.2626016 45.4474212,-73.2625829 45.4474245 ),( -73.2630349 45.447764,-73.2630478 45.4477281,-73.2630097 45.4476831,-73.2629202 45.4476468,-73.2628436 45.4476377,-73.2627797 45.4476466,-73.2627156 45.4476915,-73.262677 45.4477453,-73.2626512 45.4477992,-73.262651 45.4478533,-73.2626892 45.4478893,-73.2627787 45.4478715,-73.2628171 45.4478536,-73.2628429 45.4478176,-73.2629069 45.4477818,-73.262971 45.447764,-73.2630349 45.447764 ),( -73.2631874 45.4479803,-73.2631619 45.4479534,-73.2630471 45.4478721,-73.2629833 45.4478629,-73.2629321 45.4478718,-73.2628937 45.4478897,-73.2628552 45.4479167,-73.2628551 45.4479527,-73.2628932 45.4479887,-73.2629699 45.4480159,-73.2630336 45.4480521,-73.2630591 45.44807,-73.2631104 45.4480522,-73.263136 45.4480163,-73.2631874 45.4479803 ),( -73.2641184 45.4485042,-73.2641186 45.4484683,-73.2641061 45.4483782,-73.2640425 45.4483331,-73.2638506 45.4483237,-73.2637484 45.4483504,-73.2637099 45.4483684,-73.2636716 45.4483413,-73.2636078 45.4483232,-73.2634927 45.4483409,-73.2634159 45.4483677,-73.2634797 45.4483859,-73.2635307 45.448413,-73.2635945 45.4484402,-73.2636329 45.4484402,-73.2637094 45.4484674,-73.2638627 45.4484947,-73.2639904 45.4485399,-73.2640544 45.4485401,-73.2641184 45.4485042 ),( -73.2643423 45.4487705,-73.2643219 45.4487836,-73.2642702 45.4488735,-73.264321 45.4489635,-73.2644486 45.4490538,-73.2647164 45.4491893,-73.264844 45.4492616,-73.2649587 45.4493248,-73.265048 45.4493789,-73.2651372 45.4494331,-73.2654436 45.4495598,-73.2659289 45.4497047,-73.2662862 45.4498404,-73.2667332 45.4499313,-73.2672186 45.4500763,-73.2673717 45.4501396,-73.2677548 45.4502484,-73.2682141 45.4504743,-73.2682651 45.4505014,-73.2685583 45.450727,-73.2687362 45.4509703,-73.2687869 45.4510783,-73.2687994 45.4511683,-73.2685941 45.4513479,-73.2685678 45.4515278,-73.2685928 45.4516449,-73.2685796 45.4517528,-73.2686047 45.4518699,-73.2686557 45.4519149,-73.2687962 45.4519422,-73.2689625 45.4519065,-73.2690127 45.4521496,-73.26905 45.4524016,-73.2690623 45.4525277,-73.2692275 45.452771,-73.2694052 45.4530862,-73.2694816 45.4531404,-73.2697876 45.453384,-73.2699278 45.4534742,-73.270017 45.4535374,-73.2701065 45.4535645,-73.2701958 45.4535918,-73.2703105 45.453709,-73.270425 45.4538262,-73.2705117 45.4539322,-73.270565 45.4539974,-73.2707563 45.4541148,-73.2708198 45.4541959,-73.2708067 45.4542859,-73.2709602 45.4542502,-73.2710878 45.4543494,-73.2713688 45.454395,-73.271522 45.4544493,-73.2716114 45.4544674,-73.2717008 45.4545127,-73.2718029 45.4545579,-73.2720588 45.4545223,-73.2721486 45.4544145,-73.2721496 45.4541896,-73.2721882 45.4541447,-73.2722141 45.4540457,-73.2722271 45.4539828,-73.2720877 45.4536855,-73.2720883 45.4535506,-73.2719231 45.4532803,-73.2719106 45.4532173,-73.2718607 45.4529292,-73.2716702 45.4526048,-73.27153 45.4524696,-73.2714412 45.4522894,-73.271365 45.4521993,-73.2712373 45.4521271,-73.2712505 45.4520371,-73.2713018 45.4519923,-73.2713656 45.4520374,-73.2714296 45.4520105,-73.2714557 45.4518756,-73.2714431 45.4518305,-73.2713668 45.4517314,-73.2713286 45.4516774,-73.271265 45.4516322,-73.2711373 45.451569,-73.2709077 45.4514425,-73.2701925 45.4512431,-73.2698989 45.4511615,-73.2697967 45.4511434,-73.2696689 45.4511251,-73.2693882 45.4509985,-73.2693372 45.4509625,-73.2692735 45.4508903,-73.2692481 45.4508543,-73.2691207 45.450755,-73.2687767 45.4504754,-73.268241 45.4501413,-73.2680753 45.450033,-73.2679986 45.4500149,-73.2678327 45.4499425,-73.2674497 45.4498158,-73.2666323 45.4496342,-73.2665428 45.449598,-73.2663514 45.4495436,-73.2662239 45.4494714,-73.266224 45.4494354,-73.2661858 45.4493903,-73.2659431 45.4493448,-73.2657768 45.4493535,-73.2654832 45.4492449,-73.2647176 45.4488834,-73.2646668 45.4488383,-73.264616 45.4487482,-73.2645523 45.4487031,-73.2644757 45.4486849,-73.2643423 45.4487705 ),( -73.2755138 45.4505609,-73.2754885 45.4504708,-73.2754377 45.4504257,-73.2753099 45.4504074,-73.2752458 45.4504253,-73.2751817 45.4504702,-73.275156 45.4505151,-73.2752069 45.4505603,-73.2753346 45.4506145,-73.2754624 45.4506057,-73.2755138 45.4505609 ),( -73.2750366 45.4515947,-73.275024 45.4515497,-73.2748837 45.4514684,-73.2747305 45.4514231,-73.2746411 45.451414,-73.2742963 45.4512873,-73.2742324 45.4512962,-73.2741813 45.4512781,-73.2740411 45.4511698,-73.2740285 45.4511248,-73.2740926 45.45108,-73.2741056 45.4510349,-73.2738505 45.4508635,-73.2736461 45.4508451,-73.273518 45.4508808,-73.2734543 45.4508447,-73.2734546 45.4507547,-73.2733652 45.4507456,-73.273263 45.4507273,-73.273199 45.4507542,-73.2731604 45.4507992,-73.2730325 45.4507989,-73.2730069 45.4508439,-73.2730192 45.4509338,-73.2730831 45.45097,-73.273313 45.4510064,-73.2734025 45.4510066,-73.2736708 45.4510612,-73.273696 45.4511511,-73.2736575 45.4511961,-73.273504 45.4511957,-73.2733632 45.4512224,-73.2731462 45.4511591,-73.2730825 45.451123,-73.272993 45.4510957,-73.2729163 45.4511136,-73.2728522 45.4511585,-73.272839 45.4512755,-73.2728898 45.4513205,-73.2730432 45.4513388,-73.273222 45.4514112,-73.2734519 45.4514566,-73.2737328 45.4515472,-73.2738987 45.4515925,-73.2739879 45.4516826,-73.2741154 45.4517639,-73.2743199 45.4518003,-73.2744089 45.4518994,-73.2744855 45.4519536,-73.2745492 45.4519897,-73.2746771 45.4519719,-73.2748307 45.4519182,-73.274895 45.4518284,-73.2748445 45.4516843,-73.2749085 45.4516485,-73.2749854 45.4516306,-73.2750366 45.4515947 ),( -73.2682631 45.4509963,-73.2681611 45.4509151,-73.2680845 45.4509059,-73.2680328 45.4510228,-73.2680962 45.4511489,-73.2681221 45.451059,-73.2681864 45.4510141,-73.2682631 45.4509963 ),( -73.2748288 45.4524132,-73.274829 45.4523682,-73.2747783 45.4522691,-73.2747529 45.4522331,-73.2745996 45.4521788,-73.274523 45.4521696,-73.2744335 45.4521515,-73.2743697 45.4521333,-73.2743314 45.4521063,-73.2742422 45.4520611,-73.2741655 45.4520429,-73.2741016 45.4520428,-73.273897 45.4520514,-73.2738328 45.4520873,-73.2738453 45.4521772,-73.2739471 45.4523214,-73.2740235 45.4523846,-73.2742787 45.4524931,-73.2743427 45.4524842,-73.2746623 45.4525028,-73.2747904 45.4524581,-73.2748288 45.4524132 ),( -73.2688454 45.4524283,-73.2688713 45.4523383,-73.2689102 45.4522034,-73.2688724 45.4520773,-73.2687315 45.452113,-73.2686288 45.4522298,-73.2686924 45.45232,-73.2688454 45.4524283 ),( -73.2704214 45.454726,-73.2704215 45.454672,-73.2703968 45.454492,-73.2702059 45.4542487,-73.2701295 45.4541855,-73.2700785 45.4541494,-73.2699642 45.4539602,-73.2699132 45.4539152,-73.2697732 45.4537799,-73.2696202 45.4536716,-73.2693777 45.4535361,-73.2692122 45.4533918,-73.2691612 45.4533467,-73.2690342 45.4531485,-73.2689832 45.4531124,-73.268869 45.4528962,-73.2687422 45.452653,-73.2687042 45.4525629,-73.268551 45.4524996,-73.2684742 45.4524995,-73.2683716 45.4526072,-73.2683586 45.4526522,-73.2683685 45.4533541,-73.2683671 45.4536871,-73.2683279 45.4539119,-73.268417 45.4539931,-73.2684291 45.4541551,-73.2685312 45.4542093,-73.2685436 45.4542993,-73.2686327 45.4543805,-73.2686324 45.4544705,-73.2686961 45.4545156,-73.2687475 45.4544797,-73.2687858 45.4544888,-73.2688623 45.4545339,-73.2689 45.454714,-73.2690275 45.4547952,-73.269168 45.4548224,-73.2693594 45.4548949,-73.2693976 45.4549399,-73.2694096 45.4551469,-73.269435 45.455192,-73.269499 45.4551561,-73.2696279 45.4549134,-73.2696536 45.4548685,-73.2697178 45.4548326,-73.2698456 45.4548148,-73.2703186 45.4548428,-73.270357 45.4548339,-73.2704214 45.454726 ),( -73.2749679 45.4528274,-73.2749681 45.4527374,-73.2748919 45.4526473,-73.2747641 45.4526111,-73.2746363 45.4526198,-73.2745086 45.4525745,-73.2744318 45.4525834,-73.2743549 45.4526282,-73.2743548 45.4526732,-73.2744436 45.4528083,-73.274584 45.4528716,-73.2748395 45.4529261,-73.2749036 45.4529172,-73.2749679 45.4528274 ),( -73.2754915 45.4529634,-73.2755046 45.4528735,-73.2754538 45.4527833,-73.2754284 45.4527473,-73.2753646 45.4527022,-73.2752879 45.4527021,-73.275224 45.4527199,-73.2751599 45.4527647,-73.2751341 45.4528097,-73.2751338 45.4528997,-73.2751719 45.4529448,-73.2753636 45.4529721,-73.2754915 45.4529634 ),( -73.2742363 45.4535189,-73.2742367 45.4534108,-73.274237 45.4533569,-73.2742756 45.453267,-73.2742503 45.4532129,-73.2741993 45.4531678,-73.2740589 45.4531046,-73.2739184 45.4530952,-73.2738543 45.4531221,-73.2737137 45.4530949,-73.2736371 45.4530947,-73.2735731 45.4531216,-73.2735345 45.4531665,-73.2735598 45.4532565,-73.2736233 45.4533466,-73.2738144 45.453491,-73.2738783 45.4535181,-73.2740062 45.4535183,-73.274108 45.4536086,-73.2741721 45.4535997,-73.274185 45.4535547,-73.2742363 45.4535189 ),( -73.2749791 45.4531873,-73.2748899 45.4531242,-73.274775 45.4530969,-73.2747109 45.4531058,-73.2746469 45.4531417,-73.274838 45.453313,-73.274902 45.4533222,-73.2749791 45.4531873 ),( -73.2689117 45.4549659,-73.2688737 45.4548759,-73.2688227 45.4548307,-73.2687588 45.4548486,-73.2686822 45.4548035,-73.2686564 45.4548485,-73.2685922 45.4549473,-73.2685917 45.4550373,-73.2687836 45.4550197,-73.2689117 45.4549659 ),( -73.2699467 45.455121,-73.2699856 45.4549951,-73.2699987 45.4549321,-73.2698837 45.4548689,-73.2696919 45.4548956,-73.2696534 45.4549404,-73.2696528 45.4550934,-73.2696267 45.4551924,-73.2696647 45.4552824,-73.2697924 45.4553187,-73.2698566 45.4552828,-73.2699467 45.455121 ),( -73.2700858 45.4554992,-73.2702398 45.4553646,-73.2703039 45.4553287,-73.2703169 45.4552658,-73.2702414 45.4549686,-73.2701774 45.4549775,-73.2701259 45.4550764,-73.2701128 45.4551664,-73.2700224 45.4553551,-73.2700221 45.4554361,-73.2700858 45.4554992 ),( -73.2692034 45.4555424,-73.2691398 45.4554523,-73.2689741 45.455335,-73.2690382 45.4552902,-73.2690384 45.4552451,-73.2690259 45.4551731,-73.2689112 45.4550829,-73.2687833 45.4551006,-73.268668 45.4551544,-73.2686295 45.4552083,-73.2686289 45.4553253,-73.2685645 45.4554331,-73.2685643 45.4554782,-73.2686281 45.4555233,-73.2689349 45.4555329,-73.2691393 45.4555872,-73.2692034 45.4555424 ))";
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2707256,45.4552025), Type.WATER, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2628552,45.4479167), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2746469,45.4531417), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2686564,45.4548485), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.275224,45.4527199) , Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.273346,45.4542492) , Type.WATER, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2743549,45.4526282), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2606834,45.446053) , Type.WATER, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2757436,45.453299) , Type.WATER, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2716591,45.4547398), Type.WATER, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2749316,45.4522874), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.270805,45.4546998) , Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2665147,45.4559953), Type.WATER, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2683685,45.4533541), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2751817,45.4504702), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2696534,45.4549404), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2660657,45.4506049), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2682737,45.4546497), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2634927,45.4483409), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2618231,45.4471317), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2684482,45.4558798), Type.WATER, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2688724,45.4520773), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2689754,45.4487481), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2701774,45.4549775), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.268668,45.4551544) , Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2721486,45.4544145), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2738328,45.4520873), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.262677,45.4477453) , Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2750416,45.4535654), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2680328,45.4510228), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2767814,45.4512967), Type.WATER, FlowDirection.OUT, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2736371,45.4530947), Type.BANK, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-73.2736575,45.4511961), Type.BANK, FlowDirection.IN, null));	

		
		Polygon polygon = (Polygon)reader.read(waterbody);
		
		SkeletonGenerator g = createGenerator(0.00001,0.00001,0.00001);
		
		SkeletonResult items = g.generateSkeleton(polygon,  riverPoints);
		Assert.assertEquals("Errors existing in skeleton results", 0, items.getErrors().size());
		Assert.assertNotEquals("No skeletons generated", 0, items.getSkeletons().size());
		items.getSkeletons().forEach(ls->System.out.println(ls.toText()));
		items.getErrors().forEach(e->System.out.println(e));
		
	}
	
	
	@Test
	public void testPart() throws Exception{
		String waterbody = "POLYGON ((-1550207.2761397844 300968.31881319545, -1550218.3693028116 300978.6515351534, -1550226.3809086764 300980.41007154796, -1550233.12543379 300981.89048547205, -1550237.9678031441 300980.42398217134, -1550245.2805355957 300977.65423823707, -1550258.9197672934 300978.31292801164, -1550271.4547158827 300981.76872687973, -1550277.972511652 300987.28146882635, -1550284.6515122834 300998.2251400426, -1550288.4310338967 301011.32715901174, -1550289.492450012 301023.2935852194, -1549120.365350724 301138.9662379628, -1547366.7271613816 301312.4700267613, -1547361.9641805796 301287.39668260235, -1547355.5798157004 301253.7858434189, -1549063.5962832572 301103.0169236418, -1549170.616164906 301093.5719312569, -1550167.6878439204 301005.5826610392, -1550207.2761397844 300968.31881319545))";
		
		List<SkeletonPoint> riverPoints = new ArrayList<>();
		
		riverPoints.add(new SkeletonPoint(new Coordinate(-1550226.3809086764, 300980.41007154796), Type.FLOWPATH, FlowDirection.IN, null));
		riverPoints.add(new SkeletonPoint(new Coordinate(-1549120.365350724, 301138.9662379628), Type.FLOWPATH, FlowDirection.OUT, null));
		
		Polygon polygon = (Polygon)reader.read(waterbody);
		SkeletonGenerator g = createGenerator(1.0,1.0,1.0);
		SkeletonResult items = g.generateSkeleton(polygon,  riverPoints);
		
		Assert.assertEquals("Errors existing in skeleton results", 0, items.getErrors().size());
		Assert.assertNotEquals("No skeletons generated", 0, items.getSkeletons().size());
		items.getSkeletons().forEach(ls->System.out.println(ls.toText()));
		items.getErrors().forEach(e->System.out.println(e));
	}
}
