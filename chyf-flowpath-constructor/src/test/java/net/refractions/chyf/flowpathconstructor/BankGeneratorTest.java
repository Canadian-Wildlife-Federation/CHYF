/*
 * Copyright 2019 Government of Canada
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); 
 * you may not use this file except in compliance with the License. 
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an "AS IS" BASIS, 
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 * See the License for the specific language governing permissions and 
 * limitations under the License.
 */
package net.refractions.chyf.flowpathconstructor;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.List;

import org.junit.Assert;
import org.junit.Test;
import org.locationtech.jts.geom.Coordinate;
import org.locationtech.jts.geom.LineString;
import org.locationtech.jts.geom.Polygon;
import org.locationtech.jts.io.WKTReader;

import net.refractions.chyf.datasource.EfType;
import net.refractions.chyf.flowpathconstructor.ChyfProperties.Property;
import net.refractions.chyf.flowpathconstructor.skeletonizer.bank.BankSkeletonizer;
import net.refractions.chyf.flowpathconstructor.skeletonizer.voronoi.SkelLineString;
import net.refractions.chyf.flowpathconstructor.skeletonizer.voronoi.SkeletonResult;

/**
 * Test cases for bank skeletonizer.  This does not test the output to 
 * ensure it is valid, it just runs tests and ensure a result is returned.
 * 
 * @author Emily
 *
 */
public class BankGeneratorTest {

	private WKTReader reader = new WKTReader();

	
	private BankSkeletonizer createSkeletonizer() {
		ChyfProperties prop = new ChyfProperties();
		prop.setProperty(Property.SKEL_DENSIFY_FACTOR, 1.0);
		prop.setProperty(Property.SKEL_MINSIZE, 1.0);
		prop.setProperty(Property.SKEL_SIMPLIFY_FACTOR, 1.0);
		prop.setProperty(Property.SKEL_ACUTE_ANGLE, 30.0);
		prop.setProperty(Property.BANK_NODE_DISTANCE_OFFSET, 0.2);
		prop.setProperty(Property.BANK_NODE_DISTANCE_OFFSET, 0.2);
		prop.setProperty(Property.PNT_VERTEX_DISTANCE, 0.001);
		prop.setProperty(Property.PNT_VERTEX_DISTANCE, 0.001);
		prop.setProperty(Property.BANK_MIN_VERTEX_DISTANCE, 0.001);

		BankSkeletonizer gen = new BankSkeletonizer(prop);
		return gen;
	}
	
	@Test
	public void test1() throws Exception{
		String p = "POLYGON (( -1563756.312989934 315621.93628142495, -1563769.6490233499 315623.5486646453, -1563780.760948113 315619.1477278294, -1563798.110053177 315606.2344174143, -1563812.2107203398 315587.9474779656, -1563821.587974153 315579.72710022517, -1563826.2703747153 315578.21996342577, -1563843.2297908484 315572.5648804549, -1563852.6075115774 315564.3436073512, -1563859.9604344296 315558.41989124473, -1563863.4994318362 315557.6778675467, -1563870.1771403963 315553.69640257955, -1563885.14038642 315550.51519162394, -1563901.383569118 315555.361822268, -1563904.2187592094 315556.3835070776, -1563913.563303224 315562.94635452237, -1563917.8564286954 315568.69659369066, -1563919.9601180651 315574.8357795393, -1563919.364691949 315585.21299311705, -1563919.7064523567 315587.3537520757, -1563921.4402452235 315591.1727394024, -1563928.00630649 315593.53999930713, -1563934.1176347644 315600.113413712, -1563936.6756201757 315602.04509780835, -1563941.32527522 315615.32118094526, -1563939.6090553438 315638.07322262786, -1563939.0094636385 315663.41213824786, -1563935.578851362 315672.7676293077, -1563933.5822062448 315675.2423767084, -1563926.87175966 315694.00696569216, -1563918.440967499 315714.3380666543, -1563912.0631037713 315729.0191804003, -1563908.2201391484 315734.02317202, -1563904.4486683742 315741.2383395666, -1563903.8384666133 315746.23042294197, -1563904.6778925224 315749.72730029747, -1563904.360104858 315759.1957903225, -1563893.5207902046 315777.6492093671, -1563881.140030806 315794.37033724226, -1563865.0279729164 315809.7467716206, -1563860.6951763425 315812.5555123398, -1563845.4783833188 315828.25447381753, -1563841.912180416 315832.34934222046, -1563824.6853272778 315845.13754889555, -1563818.5053381133 315850.47506620083, -1563814.9672552454 315851.21752316505, -1563796.298167242 315864.66270493716, -1563785.5718862845 315876.7691949876, -1563783.4073848398 315888.76550644916, -1563785.0857933986 315895.76009745896, -1563788.4827625602 315901.18726387527, -1563789.3221938028 315904.68411347456, -1563790.3908700596 315916.6698517613, -1563793.6674325813 315922.2228469476, -1563797.739606999 315925.7077914616, -1563800.5747722078 315926.72946925927, -1563806.7981304263 315926.955528914, -1563812.3037856093 315923.5607085731, -1563816.5728887992 315917.7017295398, -1563823.681281904 315897.90287838597, -1563829.5753214054 315887.2503321972, -1563838.192895148 315883.9680895079, -1563842.3494804727 315884.45727288537, -1563845.8594047746 315883.5376202017, -1563848.9713156482 315883.65020597354, -1563867.1584283172 315874.23440306634, -1563881.2023369714 315859.12158173043, -1563883.0486535062 315856.59234654065, -1563886.08996194 315854.4942217395, -1563892.092413637 315852.4550617216, -1563897.4214279377 315852.3590381704, -1563904.8818078076 315855.0483819265, -1563909.8501189658 315858.8563431846, -1563913.246623859 315864.28442297596, -1563914.9254691086 315871.2781477729, -1563914.8687564791 315874.452012009, -1563913.5192145493 315878.336916537, -1563904.7613908106 315887.78924217634, -1563899.6247246503 315893.5037780069, -1563896.9260647756 315897.7430847734, -1563880.4177993538 315914.1525759399, -1563866.097165891 315930.1744457381, -1563865.8204229565 315931.0835391758, -1563850.8817545515 315945.8728710227, -1563845.7459930114 315951.58784427866, -1563844.6455007673 315954.38555161096, -1563824.5277148047 315969.32628704514, -1563803.0797830098 315978.57450317685, -1563791.2294939312 315981.86862542294, -1563782.1700948423 315980.6204316262, -1563777.20268032 315976.8129536472, -1563764.9709119971 315957.4399754433, -1563751.3743554896 315936.56776647083, -1563737.7925886048 315921.0805574963, -1563737.1745377213 315919.8480359372, -1563732.8823190364 315914.09834084194, -1563731.0392180344 315901.66558600124, -1563737.528173966 315880.634645571, -1563745.9574919709 315860.304163306, -1563759.0124845384 315841.6404146729, -1563761.5625909069 315837.34749609884, -1563764.852042065 315834.1617250042, -1563775.7747914114 315812.7121360302, -1563788.553072671 315794.95743955765, -1563803.2071584174 315774.8524806872, -1563815.090215821 315756.7752083186, -1563825.3109876288 315737.09013401065, -1563837.1940669108 315719.0128262928, -1563846.909334839 315691.7469566325, -1563847.1145828776 315688.6266737096, -1563853.6054093482 315667.59641855955, -1563854.5569136208 315664.74596141465, -1563854.6413238905 315661.7501636641, -1563852.2041786464 315659.69399909023, -1563835.6945031525 315676.1041436633, -1563823.1643152544 315692.77130103204, -1563812.7226081938 315710.1911837952, -1563806.4854423634 315718.70351214707, -1563793.4862023513 315734.1930477731, -1563791.048604582 315732.1377808498, -1563788.6031418468 315723.857903135, -1563785.9732063944 315719.71594966576, -1563782.5195193803 315717.4626311315, -1563770.584757488 315723.75262352545, -1563766.8534404526 315722.4079530556, -1563761.6664091074 315716.33478994295, -1563758.8312298215 315715.31311457977, -1563738.5390436493 315718.5903454609, -1563732.86868534 315716.54699795414, -1563724.8455821357 315709.45171211753, -1563712.1450681235 315688.9023564989, -1563704.1813900855 315663.67195961345, -1563705.0017730542 315640.5983636817, -1563707.7571221984 315633.18511908874, -1563712.0262354647 315627.3260537237, -1563732.153793215 315618.60830389336, -1563739.8918440284 315620.38896910194, -1563747.28210659 315620.86666857544, -1563754.1240170174 315622.3243420776, -1563756.312989934 315621.93628142495 ), ( -1563925.189153668 315619.08846587315, -1563915.9530072843 315621.1391182728, -1563913.06110906 315623.2913295459, -1563911.0653515207 315625.76653811336, -1563911.9038913103 315629.2629768802, -1563914.1855846406 315632.1028745761, -1563917.0207695924 315633.12456018105, -1563927.429799947 315630.4878021339, -1563928.5303063728 315627.6900510341, -1563925.189153668 315619.08846587315 ), ( -1563863.4900893033 315713.69600610435, -1563846.9278502634 315718.31831650157, -1563846.8720308966 315721.4926523194, -1563853.0967646 315721.71826578863, -1563856.6058146588 315720.79814453423, -1563862.9513872368 315720.8992704842, -1563865.8423869968 315718.7466160599, -1563866.0485245092 315715.62679061014, -1563863.4900893033 315713.69600610435 ), ( -1563832.008530041 315759.6795875821, -1563826.3377440593 315757.6348834792, -1563823.4467498877 315759.7875336781, -1563820.2223076862 315766.0231577037, -1563820.1656021737 315769.1970313685, -1563821.0050338549 315772.6939002387, -1563823.4140380784 315774.57062248513, -1563826.249213432 315775.59230205324, -1563829.5101050108 315775.7598286662, -1563833.2972357387 315773.9301765319, -1563834.2483031794 315771.0783892963, -1563834.4535499976 315767.9581172131, -1563832.008530041 315759.6795875821 ), ( -1563829.0281156062 315779.78919887356, -1563826.193395609 315778.76662949007, -1563823.3015147187 315780.9188222112, -1563815.7844167117 315781.40336431284, -1563810.0015453643 315785.70820403006, -1563808.005803026 315788.183391531, -1563804.0697022276 315789.9580966234, -1563802.223388834 315792.4873401793, -1563804.9603806748 315805.24313795473, -1563814.1969281586 315803.19162080344, -1563829.4132592287 315787.4935259931, -1563829.8666582573 315783.28561219946, -1563829.0281156062 315779.78919887356 ))";
		
		String[] ls = new String[] {
				"LINESTRING (-1563796.0351940405 315831.2799176099 1852, -1563737.7925886048 315921.0805574963 1852)",
				"LINESTRING (-1563846.6981333394 315798.265619481 1852, -1563796.0351940405 315831.2799176099 1852)",
				"LINESTRING (-1563858.0684677293 315768.9912597826 1852, -1563852.1627843915 315784.03981374763 1852, -1563846.6981333394 315798.265619481 1852)",
				"LINESTRING (-1563871.0083267847 315736.01977413706 1852, -1563858.0684677293 315768.9912597826 1852)",
				"LINESTRING (-1563900.8312337426 315660.0259500956 1852, -1563871.0083267847 315736.01977413706 1852)",
				"LINESTRING (-1563864.1295826284 315626.9045759011 1852, -1563900.8312337426 315660.0259500956 1852)",
				"LINESTRING (-1563826.2703747153 315578.21996342577 1852, -1563842.8232354426 315614.92102665734 1852, -1563843.643928141 315616.74118186254 1852, -1563844.1015897968 315622.8380051842 1852)",
				"LINESTRING (-1563901.383569118 315555.361822268 1852, -1563893.8938848095 315575.7090171864 1852, -1563864.5790539586 315626.13106010295 1852, -1563864.1295826284 315626.9045759011 1852)",
				"LINESTRING (-1563797.8751965615 315655.5860335175 1852, -1563815.5845813344 315640.3054393297 1852)",
				"LINESTRING (-1563815.5845813344 315640.3054393297 1852, -1563833.0639675716 315625.2225283226 1852, -1563844.1015897968 315622.8380051842 1852)",
				"LINESTRING (-1563748.0325824593 315656.37075790484 1852, -1563781.387957431 315669.8117577974 1852, -1563797.8751965615 315655.5860335175 1852)",
				"LINESTRING (-1563756.312989934 315621.93628142495 1852, -1563756.2339728032 315633.8105080528 1852, -1563748.0325824593 315656.37075790484 1852)",
				"LINESTRING (-1563739.8918440284 315620.38896910194 1852, -1563737.005845374 315642.426315506 1852)",
				"LINESTRING (-1563844.1015897968 315622.8380051842 1852, -1563854.1155862561 315624.871289433 1852)",
				"LINESTRING (-1563854.1155862561 315624.871289433 1852, -1563864.1295826284 315626.9045759011 1852)",
				"LINESTRING (-1563737.005845374 315642.426315506 1852, -1563735.8336231986 315651.3742494909 1852, -1563748.0325824593 315656.37075790484 1852)"
		};
		
		Polygon wb = (Polygon) reader.read(p);
		
		List<SkelLineString> items = new ArrayList<>();
		for (String s : ls) {
			items.add(new SkelLineString((LineString)reader.read(s), EfType.SKELETON));
		}
		
		SkeletonResult r = createSkeletonizer().skeletonize(wb, items, null, Collections.emptyList());
		r.getSkeletons().forEach(e->System.out.println(e.getLineString().toText()));
	}
	
	@Test
	public void test4() throws Exception{
		String p = "POLYGON((-73.14261220000000208 45.33983099999999666, -73.14259970000000521 45.33982739999999723, -73.14253619999999501 45.33980019999999911, -73.14249809999999741 45.33977310000000216, -73.14247269999999901 45.33974599999999811, -73.14240949999999941 45.3396468999999982, -73.14238360000000228 45.33959589999999906, -73.14237869999999475 45.33958640000000173, -73.14235909999999308 45.33954769999999712, -73.14232140000000015 45.33945760000000291, -73.14232149999999422 45.33943060000000003, -73.14232169999999655 45.33940359999999714, -73.14232189999999889 45.33937660000000136, -73.14230929999999375 45.33934959999999847, -73.14230940000000203 45.33933160000000129, -73.14232230000000357 45.33929570000000098, -73.1423225000000059 45.33927769999999668, -73.14231019999999717 45.33920559999999966, -73.14228520000000344 45.33911559999999952, -73.14224769999999864 45.33900750000000102, -73.14222279999999898 45.33889039999999682, -73.14221030000000212 45.33886340000000104, -73.14214719999999659 45.33874620000000277, -73.14207129999999779 45.33864690000000053, -73.14199539999999899 45.33855669999999805, -73.14193210000000533 45.33845749999999697, -73.14188179999999306 45.33834029999999871, -73.14181870000000174 45.3382411999999988, -73.14175539999999387 45.33815100000000342, -73.14167930000000695 45.33806979999999953, -73.14166670000000181 45.33805170000000118, -73.14165409999999667 45.33802469999999829, -73.14160370000000455 45.33792559999999838, -73.14154059999999902 45.33782639999999731, -73.14150259999999548 45.33778130000000317, -73.14146449999999788 45.33775409999999795, -73.14143900000000542 45.33774509999999935, -73.14141340000000469 45.33775399999999678, -73.14137499999999648 45.3377718999999999, -73.14132390000000328 45.33778970000000186, -73.14128560000000334 45.3377806000000021, -73.14126020000000494 45.33777150000000233, -73.14124750000000574 45.33775349999999804, -73.14124769999999387 45.33773550000000085, -73.14123499999999467 45.33771749999999656, -73.14124800000000448 45.33769050000000078, -73.14128630000000442 45.33767259999999766, -73.14132469999999842 45.33766370000000023, -73.14145249999999976 45.33763720000000319, -73.14158020000000704 45.3376104999999967, -73.14165690000000097 45.33758379999999732, -73.14169540000000325 45.33756590000000131, -73.14170819999999651 45.33753889999999842, -73.14170830000000478 45.3375210000000024, -73.14169569999999965 45.33750289999999694, -73.14169590000000198 45.33747590000000116, -73.14169610000000432 45.33744889999999828, -73.14168359999999325 45.3374128999999968, -73.14168379999999559 45.33738590000000102, -73.14167109999999639 45.33734989999999954, -73.141671400000007 45.33731389999999806, -73.14165889999999592 45.33727780000000251, -73.1416339000000022 45.33717870000000261, -73.14160900000000254 45.33708870000000246, -73.14157140000000368 45.33697159999999826, -73.14154659999999808 45.33687259999999952, -73.14152160000000436 45.33677349999999961, -73.14149679999999876 45.33667439999999971, -73.1414718999999991 45.3365752999999998, -73.14143430000000023 45.33646730000000247, -73.14138400000000217 45.33636810000000139, -73.14130860000000212 45.33616990000000158, -73.14119549999999492 45.33590860000000333, -73.14113249999999766 45.33577340000000078, -73.14106970000000274 45.33560219999999674, -73.14104450000000668 45.33555719999999667, -73.14102169999999603 45.33553280000000285, -73.14101920000000234 45.33553009999999972, -73.14103219999999794 45.33549409999999824, -73.14106370000000368 45.33548040000000157, -73.14106759999999952 45.33547870000000302, -73.14113460000000089 45.33544940000000167, -73.14118580000000236 45.335404699999998, -73.14118609999999876 45.33536860000000246, -73.14119909999999436 45.33531469999999786, -73.14135210000000598 45.33533309999999972, -73.14140290000000277 45.33537830000000213, -73.14144079999999803 45.33545039999999915, -73.1414656999999977 45.33553150000000187, -73.14157919999999535 45.33575679999999863, -73.14161719999999889 45.33579290000000128, -73.14168069999999489 45.33583809999999659, -73.14179500000000189 45.33591940000000164, -73.14187110000000303 45.335991700000001, -73.14192149999999515 45.33609990000000067, -73.14194639999999481 45.33618990000000082, -73.14195899999999995 45.33620799999999917, -73.14200970000000268 45.33626209999999901, -73.14207310000000462 45.33635230000000149, -73.14209830000000068 45.33639740000000273, -73.14213619999999594 45.3364514000000014, -73.14216150000000027 45.33647849999999835, -73.14219959999999787 45.3365056000000024, -73.14221229999999707 45.33652370000000076, -73.14225000000000421 45.33661380000000207, -73.14224980000000187 45.33664079999999785, -73.14226200000000233 45.336730799999998, -73.14227470000000153 45.33674890000000346, -73.14227449999999919 45.33676679999999948, -73.14228710000000433 45.33679390000000353, -73.14229949999999292 45.33683899999999767, -73.14229939999999885 45.33687489999999798, -73.14228649999999732 45.33689290000000227, -73.14227359999999578 45.33691079999999829, -73.14224799999999505 45.33691970000000282, -73.14220980000000338 45.33691960000000165, -73.14218420000000265 45.33692849999999908, -73.14217130000000111 45.33694650000000337, -73.14217109999999877 45.33697349999999915, -73.14222200000000385 45.3370006000000032, -73.14233640000000491 45.33707299999999663, -73.14234910000000411 45.33709110000000209, -73.14234890000000178 45.3371179999999967, -73.14233600000000024 45.33713600000000099, -73.1423103999999995 45.33716290000000271, -73.14231019999999717 45.33718989999999849, -73.14232259999999997 45.33723489999999856, -73.14232239999999763 45.33726190000000145, -73.14233509999999683 45.3372799999999998, -73.14239820000000236 45.33737920000000088, -73.1424235000000067 45.33740619999999666, -73.14244899999999916 45.33742430000000212, -73.14247439999999756 45.33743340000000188, -73.14249999999999829 45.33743350000000305, -73.14252550000000497 45.33744250000000164, -73.14255099999999743 45.33744260000000281, -73.1426019000000025 45.33745179999999664, -73.14262739999999496 45.33746090000000351, -73.14269099999999924 45.33749710000000022, -73.14271639999999763 45.33750619999999998, -73.14276739999999677 45.33751519999999857, -73.14279299999999751 45.33751529999999974, -73.14283120000000338 45.33750650000000348, -73.14295889999999645 45.33748889999999676, -73.14298440000000312 45.33749790000000246, -73.14300980000000152 45.33751600000000082, -73.14303519999999992 45.33754309999999776, -73.14304780000000505 45.33756120000000323, -73.14303490000000352 45.33757909999999924, -73.14304760000000272 45.33759710000000354, -73.14307300000000112 45.33761520000000189, -73.14309849999999358 45.33762430000000165, -73.14313679999999351 45.33762440000000282, -73.14316220000000612 45.33763350000000258, -73.14318769999999859 45.33764260000000235, -73.14322579999999618 45.3376696999999993, -73.14334010000000319 45.33775099999999725, -73.14336550000000159 45.33776009999999701, -73.14345459999999832 45.33780540000000059, -73.14353079999999352 45.33785960000000159, -73.14356890000000533 45.3378957999999983, -73.14358149999999625 45.33791370000000143, -73.14358129999999392 45.33794079999999838, -73.14356840000000659 45.3379587000000015, -73.14355550000000505 45.33798569999999728, -73.14350389999999891 45.33808450000000079, -73.14345230000000697 45.3381742999999986, -73.14340070000000082 45.33826419999999757, -73.14340049999999849 45.33829109999999929, -73.14341269999999895 45.33838109999999944, -73.14342489999999941 45.33847120000000075, -73.14342419999999834 45.33857009999999832, -73.14341079999999806 45.33867810000000276, -73.1433980000000048 45.33869609999999994, -73.14335909999999785 45.33878599999999892, -73.14332020000000512 45.33887579999999673, -73.14325589999999977 45.33898359999999883, -73.14324290000000417 45.33901060000000172, -73.14322970000000623 45.33906449999999921, -73.14322930000000156 45.33913650000000217, -73.14322880000000282 45.33923550000000091, -73.14321590000000128 45.3392534999999981, -73.14318989999999587 45.33930730000000153, -73.14317699999999434 45.33934330000000301, -73.14317680000000621 45.33937029999999879, -73.14316370000000234 45.3394151999999977, -73.1431381000000016 45.33944220000000058, -73.14311250000000086 45.33945109999999801, -73.14307399999999859 45.33948699999999832, -73.14300969999999325 45.33957670000000206, -73.14300959999999918 45.33959469999999925, -73.14299619999999891 45.3396846999999994, -73.14299560000000611 45.33978359999999697, -73.1429949999999991 45.33988260000000281, -73.14300719999999956 45.33996359999999726, -73.14295610000000636 45.33998150000000038, -73.14293069999999375 45.33996350000000319, -73.14289250000000209 45.33994529999999656, -73.14279080000000022 45.3398820000000029, -73.14276529999999354 45.33987299999999721, -73.14272719999999595 45.33986380000000338, -73.14261220000000208 45.33983099999999666))";
		String[] ls = new String[] {
					"LineString (-73.14186499999999569 45.33688389999999657, -73.14187130000000536 45.33695790000000159, -73.14190809999999487 45.33707499999999868, -73.14196950000000186 45.33716340000000145, -73.14198629999999923 45.33724039999999889, -73.14199870000000203 45.3372989000000004, -73.14202120000000207 45.33737039999999752, -73.14205029999999397 45.33742970000000128, -73.1420755999999983 45.33750419999999792, -73.14209160000000054 45.33754160000000155, -73.14212539999999763 45.33763230000000277, -73.14219009999999344 45.33780730000000148, -73.14226209999999639 45.33786560000000065, -73.14232699999999454 45.33789790000000153, -73.14238799999999685 45.33794129999999711, -73.14242919999999515 45.33797189999999944, -73.14255020000000229 45.33804539999999861, -73.1425889000000069 45.33806890000000323, -73.14263540000000319 45.33824359999999842, -73.14264719999999897 45.33829029999999705, -73.14266499999999382 45.33833709999999684, -73.1426902000000041 45.33838409999999897, -73.14272189999999796 45.33846350000000314, -73.14274690000000589 45.33851820000000288, -73.14276010000000383 45.33856569999999664, -73.14276359999999499 45.33860849999999942, -73.14276089999999897 45.33864909999999782, -73.14276889999999298 45.33870819999999924, -73.14276800000000378 45.33874910000000114, -73.14275220000000388 45.33886609999999706, -73.14274550000000374 45.33897790000000327, -73.14275790000000654 45.33909390000000172, -73.14276949999999999 45.33916899999999828, -73.14275910000000636 45.33924960000000226, -73.14275179999999921 45.33928660000000121, -73.1427257999999938 45.33933729999999684, -73.14270980000000577 45.33939149999999785, -73.14269600000000082 45.33943239999999975, -73.14268810000000087 45.339520499999999, -73.1427031999999997 45.33958460000000201, -73.14271800000000212 45.33964569999999839, -73.14275159999999687 45.33969210000000061, -73.14280689999999652 45.33974270000000217, -73.14284519999999645 45.33978309999999823, -73.14288569999999368 45.33984230000000082, -73.1429154000000068 45.33989090000000033, -73.14294850000000281 45.33992709999999704, -73.14295900000000472 45.33997039999999856, -73.14295610000000636 45.33998150000000038)",
					"LineString (-73.14119909999999436 45.33531469999999786, -73.14123449999999593 45.33534920000000312, -73.1412693000000047 45.33538279999999787, -73.14130719999999997 45.33544440000000009, -73.14129289999999628 45.33548420000000334, -73.14126539999999466 45.33556029999999737, -73.14128289999999311 45.33560899999999805, -73.14131430000000478 45.33567810000000264, -73.14135469999999373 45.33574959999999976, -73.14135810000000504 45.33579600000000198, -73.14141689999999585 45.33586989999999872, -73.14144770000000051 45.33592569999999711, -73.14154019999999434 45.33601689999999707, -73.14159089999999708 45.33608240000000222, -73.14161980000000085 45.33615559999999789, -73.1416251999999929 45.33621629999999669, -73.14167559999999924 45.33629539999999736, -73.14170260000000212 45.3363435999999993, -73.14175299999999424 45.33640789999999754, -73.14176899999999648 45.33645200000000131, -73.14181069999999352 45.3365312999999972, -73.14182959999999412 45.33658160000000237, -73.14187169999999583 45.33664819999999906, -73.14188699999999699 45.33671079999999876, -73.14189229999999498 45.3367564999999999, -73.14187780000000316 45.33683039999999664, -73.14186499999999569 45.33688389999999657)"
		};
		Polygon wb = (Polygon) reader.read(p);
		
		List<SkelLineString> items = new ArrayList<>();
		for (String s : ls) {
			items.add(new SkelLineString((LineString)reader.read(s), EfType.SKELETON));
		}
		
		SkeletonResult r = createSkeletonizer().skeletonize(wb, items, null, Collections.emptyList());
		r.getSkeletons().forEach(e->System.out.println(e.getLineString().toText()));
	}
	
	@Test
	public void test2() throws Exception{
		String p = "POLYGON (( -1553791.978779562 356312.30965743866, -1553792.36729478 356311.2748530805, -1553798.510196712 356306.10549099743, -1553811.690827999 356296.09043305647, -1553818.7601381773 356288.0651119957, -1553822.04336019 356281.69383441005, -1553824.4630202653 356275.1784886597, -1553826.0770504824 356270.55451278016, -1553827.5724041378 356263.5367976334, -1553829.755363764 356254.75329065416, -1553832.443310323 356247.3264618069, -1553833.4021839492 356241.2913229335, -1553835.5856002609 356232.5069191661, -1553836.9620437631 356225.6143213827, -1553837.863007845 356217.54150422104, -1553837.6916983766 356208.9140934013, -1553837.668786692 356200.34024619777, -1553840.3576251715 356192.91385319736, -1553841.7340705215 356186.0212435294, -1553844.541369249 356178.4706037706, -1553846.155405154 356173.84660731256, -1553853.3120733954 356168.875748517, -1553861.0290866832 356170.658479074, -1553872.8658001935 356164.35677886475, -1553879.601483664 356163.5999208819, -1553884.2195694994 356165.26957351156, -1553892.0849822238 356167.105875805, -1553890.021351029 356175.7656336343, -1553886.97691016 356181.0467705233, -1553885.2444107353 356185.79500868823, -1553889.9788519815 356190.6987578133, -1553895.8789579556 356191.65547616035, -1553903.1529635189 356189.07880740333, -1553909.2959016056 356183.9094141731, -1553912.3403456241 356178.6282775784, -1553914.3420221552 356172.96901274566, -1553915.4497617215 356166.9865284879, -1553913.3097190282 356160.838280119, -1553911.7360782651 356153.8874815181, -1553910.7877431551 356147.3296657717, -1553911.896370035 356141.3476295909, -1553914.9399299384 356136.06602794956, -1553920.4290612089 356129.4850211935, -1553925.260954411 356124.84896469396, -1553930.5108540556 356119.3567897193, -1553932.5134230927 356113.69796347525, -1553940.3897729886 356103.7807473447, -1553944.5964531628 356097.91132679954, -1553950.3218380515 356093.59936944954, -1553958.672023816 356088.2198354844, -1553961.5671958958 356082.8846526565, -1553966.311256374 356076.03308840096, -1553969.550887676 356069.60914918035, -1553969.8936122658 356068.9307540059, -1553972.164910267 356062.36177221406, -1553975.5974611712 356056.0444441121, -1553976.7060995938 356050.0623807749, -1553970.151722593 356047.6927129207, -1553961.272544531 356045.6578593068, -1553949.057728993 356041.2417479567, -1553940.9517140659 356040.4947137162, -1553935.291275834 356038.44826967735, -1553927.1557763673 356037.5225404622, -1553919.7953036337 356037.0451612277, -1553912.9722048978 356035.5856439164, -1553906.922790954 356034.5749095939, -1553898.7881794272 356033.6496396037, -1553904.0380852218 356028.15743758064, -1553911.7326814097 356021.36536652315, -1553916.1764969344 356017.76544377673, -1553906.5556483585 356012.10349792335, -1553899.1073246563 356009.4106232831, -1553892.1653082562 356008.0762408748, -1553884.2985242666 356006.24037839286, -1553874.2562255564 356004.793356712, -1553868.327063698 356003.65706423204, -1553862.0089277406 356003.556479631, -1553855.0036146333 356005.2230478944, -1553847.7300170287 356007.80110117886, -1553838.1311886644 356010.7126319818, -1553835.504748514 356015.13768826984, -1553834.1274125038 356022.0298929773, -1553831.3196522563 356029.581472883, -1553829.3184365872 356035.23988228943, -1553827.2539265715 356043.89922939334, -1553825.7576793924 356050.91655566543, -1553823.7560110155 356056.57584736217, -1553817.0198820625 356057.3313828865, -1553812.435138699 356052.48299126513, -1553813.0374434013 356045.1424506502, -1553813.1318624918 356038.9627435105, -1553816.8660261284 356028.55517985485, -1553811.9252282723 356021.5623980444, -1553799.710405899 356017.14632957894, -1553800.5814258393 356008.89563771617, -1553804.2510888218 356004.8478168659, -1553809.9444525777 356003.7141490001, -1553822.2541535636 356001.9496155223, -1553829.229524408 356000.1052338155, -1553836.2339484766 355998.4382076999, -1553841.3354489328 355992.8924277304, -1553846.167345149 355988.2563350657, -1553860.2968897352 355984.79806058016, -1553869.090089466 355983.7779233325, -1553875.4073413853 355983.87805277575, -1553877.645700978 355980.48915186897, -1553879.3457350933 355978.9200836653, -1553885.2753551009 355980.0554886488, -1553892.9599307368 355985.01743018907, -1553899.5143174368 355987.3870861763, -1553916.2594063338 355991.25733689684, -1553923.7402083622 355990.7710012896, -1553930.4768101955 355990.01458159834, -1553939.9263709998 355987.04903692193, -1553947.5560286425 355986.6153828753, -1553953.0026661528 355994.96757883206, -1553953.561589927 356002.5598022286, -1553955.2845169068 356009.5646654945, -1553959.451680504 356015.2705483213, -1553965.7044087232 356021.73045695946, -1553974.0457834927 356024.74610809144, -1553981.9121117897 356026.5828745188, -1553985.8509721125 356021.62402847037, -1553991.576373085 356017.31205376796, -1553999.6565178242 356012.84307474457, -1554004.252194664 356005.937919382, -1554012.1294721966 355996.0211036615, -1554016.5724152012 355992.42072449904, -1554021.4052250087 355987.78509006836, -1554025.3436402045 355982.827122245, -1554031.3057462866 355980.7833263548, -1554034.7936712333 355979.86070036236, -1554040.722840416 355980.99701274093, -1554045.489344986 355982.7202501884, -1554043.6948501014 355990.46905693226, -1554038.829553542 355998.2839080114, -1554027.4652332838 356009.1238005413, -1554024.7763477298 356016.55026484, -1554023.011342445 356024.47775658406, -1554022.291674855 356029.4241222814, -1554018.9780278422 356035.61632899847, -1554016.3515663592 356040.04138262104, -1554013.0374667107 356046.2344739754, -1554009.0990589054 356051.1924258759, -1554003.6099002687 356057.7734583728, -1553993.4226837878 356085.83498300426, -1553989.4193003809 356097.1535618799, -1553979.2321028046 356125.2150342446, -1553976.7474496248 356138.0888264524, -1553977.5759744102 356144.7713273, -1553981.085425068 356152.4230300123, -1553985.0462695586 356156.0376443481, -1553989.7798194988 356160.9409585651, -1553991.0842730368 356168.80279034283, -1553994.0896458498 356175.09602400474, -1553998.434670959 356181.03414923046, -1554004.8081476921 356186.5294469176, -1554010.1993904528 356189.4869244797, -1554017.4114436004 356189.91076246556, -1554023.5214639641 356187.92145519424, -1554026.5268313831 356194.21468960773, -1554023.718155344 356201.765767741, -1554020.4045204527 356207.9579243036, -1554016.1328723973 356220.1856914507, -1554016.155293755 356228.7604416162, -1554016.5658041346 356236.2990371669, -1554021.1184617958 356244.3279651152, -1554026.3283827682 356250.40971884876, -1554027.1568972913 356257.09219686966, -1554024.7380885636 356263.60801189113, -1554019.0122601883 356267.92081113346, -1554010.7254048712 356270.2993615782, -1554003.7205747832 356271.9649822777, -1553994.9283080348 356272.9855064517, -1553985.9842157234 356277.30899894517, -1553977.0110744662 356281.4551373059, -1553970.0057950874 356283.1216475954, -1553963.6876951929 356283.021027104, -1553957.9948112036 356284.1537584169, -1553951.4079927865 356284.9632714316, -1553948.095263695 356291.15585612226, -1553951.099745108 356297.4486041134, -1553958.126565314 356304.356357445, -1553976.0025939413 356310.8193740295, -1553977.6946771445 356317.64590048324, -1553967.202396622 356320.23545915633, -1553960.8527110824 356323.3144635726, -1553958.8514882736 356328.97280472517, -1553966.0626278792 356329.39619322773, -1553973.0674449364 356327.7305780435, -1553980.4603503407 356325.02881600335, -1553986.6911248544 356322.074942057, -1553998.4658629578 356318.77380094025, -1554006.7821916086 356316.5739550926, -1554012.92512995 356311.4046030715, -1554017.1023192473 356305.3565466432, -1554022.351759132 356299.8653138066, -1554026.5593225916 356293.99640417006, -1554029.603343938 356288.7139508566, -1554034.1985444801 356281.8097760845, -1554041.955094445 356272.01731960103, -1554049.1671352843 356272.4411690524, -1554054.1698432365 356276.4334574174, -1554056.5175012627 356284.67250667326, -1554057.5852481727 356290.26615048014, -1554056.4779443236 356296.2477249885, -1554053.1313706788 356305.61992259324, -1554050.5049203744 356310.04491952807, -1554056.7905350185 356313.32473153993, -1554063.1635326175 356318.82091179304, -1554067.4474521508 356327.7599595599, -1554072.0325787384 356332.6096976744, -1554079.2107816928 356336.213167171, -1554085.3774781597 356339.6181113068, -1554092.5556796053 356343.2215829715, -1554092.1451841171 356335.68300989177, -1554094.1793695367 356326.8445982011, -1554107.5014130832 356325.2791820653, -1554116.0253901985 356325.1701571718, -1554121.7182806311 356324.03744501807, -1554129.0782598527 356324.5157653978, -1554140.6677829411 356327.6985736191, -1554146.597793404 356328.8353672251, -1554147.9022135264 356336.6971712932, -1554147.1825345533 356341.6434800159, -1554142.1043033253 356355.7643307373, -1554146.6889883545 356360.612734559, -1554155.1800137707 356363.6837850921, -1554161.4651635296 356366.9644998042, -1554166.3194570676 356370.9032290308, -1554170.6674545798 356373.4834767366, -1554176.3278479509 356375.5299519645, -1554175.6385367587 356380.6554045398, -1554170.529928251 356394.59708367474, -1554173.5647455307 356401.06899261475, -1554179.9047714055 356409.7452447871, -1554185.9203022486 356413.9356362922, -1554191.4322930332 356415.928545787, -1554195.810655931 356418.6879446311, -1554201.2896949174 356423.8609148031, -1554205.9937146665 356428.5855333973, -1554211.2664621905 356431.6672695996, -1554215.164378296 356438.2841387987, -1554223.6220023406 356444.5339185642, -1554228.8648097652 356447.4378487542, -1554234.7939183072 356448.5742037948, -1554244.4141954982 356454.2370840693, -1554248.494344488 356457.72791953105, -1554252.810263261 356463.4886843404, -1554258.7068690043 356467.80421154853, -1554265.2936824886 356466.99475515634, -1554271.1898326746 356471.31117205415, -1554274.8814515532 356475.8368099164, -1554277.617586201 356483.041036278, -1554279.016466205 356484.72317522764, -1554283.5137334878 356487.3574538762, -1554289.50829913 356482.1345944479, -1554292.8219609128 356475.94251049496, -1554294.8232274903 356470.2841918068, -1554301.7651796 356471.61865442805, -1554307.392600642 356476.8452045256, -1554307.1462349186 356486.33003054, -1554305.7697168656 356493.22258642316, -1554307.49211398 356500.2282601632, -1554312.3134248646 356507.34705289174, -1554310.3117027811 356513.00625090115, -1554301.995829205 356515.20513169374, -1554293.7089855077 356517.5835962882, -1554287.9844916002 356521.8958862657, -1554284.9400142115 356527.1769436402, -1554281.0020407157 356532.1361162467, -1554279.8393852343 356532.72301566135, -1554275.6326874334 356538.59231157973, -1554273.9001520386 356543.34048779495, -1554272.5236411986 356550.2330246726, -1554270.7616236845 356554.8025032757, -1554268.997020264 356562.7311751144, -1554265.9525484156 356568.01222187, -1554260.2596793703 356569.1448906427, -1554252.7798402417 356569.6315641096, -1554225.2744549457 356569.2576033771, -1554205.4311249459 356565.27318686806, -1554167.0001969656 356551.3742021555, -1554161.758288442 356548.4707389483, -1554153.0306165908 356543.1315445639, -1554145.194750766 356541.4738777587, -1554140.1595869581 356540.660752872, -1554132.5300349656 356541.09208158776, -1554124.0069869275 356541.20153118856, -1554117.1839643694 356539.74196425267, -1554110.8342918628 356542.8209112892, -1554101.505151383 356544.82260351814, -1554095.1255650872 356547.7215139009, -1554084.5692334792 356556.66975040734, -1554080.6312925264 356561.62891602423, -1554073.5940152614 356566.47362916823, -1554066.2020265365 356569.175785386, -1554059.110289581 356568.62634758744, -1554053.7177550332 356565.66931193136, -1554047.7886671931 356564.5329749603, -1554036.6721356977 356565.8873428786, -1554036.1895953608 356573.1030764049, -1554040.3870642981 356578.9880269468, -1554041.5716029895 356587.8147739852, -1554037.2156677025 356593.6300309766, -1554031.7599415332 356597.03219277225, -1554022.9681929427 356598.05177133996, -1554017.242862689 356602.36359875184, -1554018.9652977164 356609.36920720246, -1554018.547727705 356610.22664774116, -1554018.2465250979 356614.31590691395, -1554014.3085991037 356619.2750581857, -1554008.8528790122 356622.67721575033, -1554000.7732997802 356627.14512876235, -1553993.1112704508 356630.7578316266, -1553984.5566570316 356634.0468813712, -1553978.2390626757 356633.9453412406, -1553970.9984898632 356633.34323139396, -1553963.3685126586 356633.7754590977, -1553947.184816279 356637.4971950762, -1553939.9412519783 356640.25291549414, -1553927.9303718342 356641.2849571565, -1553922.0891414678 356642.3640799094, -1553914.608453221 356642.85033411905, -1553908.6793795004 356641.7140115369, -1553901.3190119509 356641.23658324126, -1553893.1849709959 356640.31037844624, -1553884.6619607308 356640.41985278577, -1553878.0752024127 356641.22932920326, -1553870.9519665374 356643.0213714186, -1553856.0559959733 356637.6347487774, -1553847.7397475266 356639.83454728127, -1553841.658838335 356642.0033757733, -1553835.1045534008 356639.6337290341, -1553828.0777779212 356632.72606157046, -1553820.8658093768 356632.3022119636, -1553811.5367248878 356634.30392684136, -1553806.920032175 356632.63384868205, -1553801.0550069807 356625.1388301309, -1553779.0444586095 356609.7910036845, -1553771.596240539 356607.0981517257, -1553767.7298644674 356597.3018063735, -1553762.0790418265 356583.5025466746, -1553760.3556799814 356576.49651108216, -1553756.039270608 356570.73673222866, -1553754.7897262375 356568.2705188934, -1553747.6197718044 356552.9124709638, -1553748.7594875859 356543.751845032, -1553750.28430478 356536.91291040275, -1553752.2859422164 356531.25374272745, -1553752.9751984787 356526.12834747136, -1553756.2878769592 356519.9358364362, -1553758.7066263107 356513.4201089125, -1553762.019306693 356507.22759402543, -1553765.9572047656 356502.26841405034, -1553771.4462613745 356495.68752969615, -1553779.3216089571 356485.7700506365, -1553784.4212693053 356480.2235030448, -1553794.084485594 356470.9524468789, -1553799.0647197687 356466.37003965676, -1553804.1652730643 356460.8239410138, -1553809.415112207 356455.3318615556, -1553814.9032959586 356448.75050740875, -1553824.6275943555 356436.47852420155, -1553832.289632592 356432.86575743, -1553839.501635425 356433.2895915741, -1553857.4091930513 356436.57294958923, -1553865.6959971609 356434.194416075, -1553874.0114000465 356431.99412338156, -1553883.4608559574 356429.0286821816, -1553887.6674960563 356423.1593566537, -1553890.4752445053 356415.6079065185, -1553892.4764535003 356409.94959012885, -1553893.8529022571 356403.05703991745, -1553894.6914623145 356397.9856300056, -1553894.786348922 356391.8051144304, -1553890.5888457801 356385.9201549925, -1553884.5403696513 356384.90986168943, -1553878.8150324356 356389.22174876183, -1553874.8771076037 356394.18095690943, -1553876.9876575135 356400.15045607183, -1553877.668247718 356406.7784254253, -1553876.5605186739 356412.76084691007, -1553868.4554654683 356412.014246786, -1553867.6260439162 356405.33137092926, -1553869.3910051342 356397.40402021725, -1553857.9728109958 356402.84863011446, -1553851.2046960576 356406.78461864125, -1553845.2755908926 356405.64831326157, -1553846.382860987 356399.666779886, -1553849.3079358826 356394.5094848117, -1553858.2840181068 356387.0055103954, -1553870.538240897 356379.84645091, -1553871.914686637 356372.95389351714, -1553865.985121829 356371.81847475655, -1553859.012793597 356370.30493131466, -1553851.3507403624 356373.9177113911, -1553840.7944402471 356382.8660516506, -1553833.4015623252 356385.56781511195, -1553831.4099188 356379.47318998165, -1553833.055528231 356371.6696196627, -1553833.4826540141 356359.059215582, -1553831.8251176896 356345.6952397851, -1553830.1026424372 356338.68958945945, -1553826.2042154681 356332.0736514069, -1553820.931444964 356328.9919647211, -1553813.956560938 356330.8376330063, -1553806.9517600911 356332.5032644151, -1553799.0209925878 356337.0261875689, -1553789.6364609702 356333.6333350856, -1553786.8711928518 356326.25179361086, -1553787.5908281363 356321.3055022368, -1553791.978779562 356312.30965743866 ), ( -1554002.4872512175 356216.4275880577, -1553995.9004190809 356217.2371046832, -1553992.0488945204 356225.2504136823, -1553998.4219104892 356230.74659242854, -1554004.801098499 356227.8462675698, -1554007.2207929068 356221.3308973843, -1554002.4872512175 356216.4275880577 ), ( -1553982.5879561862 356207.0495225778, -1553975.5826641885 356208.71604456194, -1553967.9210195087 356212.3279668717, -1553962.1956474043 356216.6398936203, -1553959.5687490199 356221.0657959711, -1553954.2863784067 356229.7371257525, -1553951.3912166308 356235.07227149326, -1553949.2411393675 356240.6779554114, -1553959.700503756 356241.2684456082, -1553966.7057889076 356239.6019273205, -1553973.055487377 356236.52290562354, -1553978.156984346 356230.97719704174, -1553980.3066119398 356225.3723974237, -1553982.3082966849 356219.71314138826, -1553982.522996244 356213.40789950173, -1553982.5879561862 356207.0495225778 ), ( -1554164.3389390295 356456.0169061683, -1554158.6790108941 356453.9695446892, -1554151.703679479 356455.8138148282, -1554143.805367088 356457.15750956815, -1554138.1124925762 356458.29020306934, -1554136.3504880404 356462.8596961852, -1554137.4160986186 356471.81162342615, -1554136.3078992355 356477.7927030958, -1554137.1372788616 356484.47559027094, -1554141.4852652345 356487.0558300242, -1554147.80334414 356487.15648890473, -1554157.0131350257 356485.28080653585, -1554161.8450249557 356480.644844939, -1554165.7825307064 356475.68654701486, -1554167.78423275 356470.0273459023, -1554168.8915496774 356464.0458079418, -1554164.3389390295 356456.0169061683 ))";
		
		String[] ls = new String[] {
				"LINESTRING (-1554281.0020407157 356532.1361162467 1892, -1554279.7819293793 356530.68669698574 1892, -1554260.6099768705 356496.8528462462 1892)",
				"LINESTRING (-1553877.645700978 355980.48915186897 1892, -1553888.1584868724 355991.1168811256 1892, -1553934.8098089176 356010.2247443786 1892, -1553955.7492292419 356023.58997358754 1892, -1553987.6878721458 356043.9761810284 1892)",
				"LINESTRING (-1553966.0260427461 356383.3799535902 1892, -1553935.257255109 356355.91472955607 1892, -1553901.3363516098 356340.8637982588 1892)",
				"LINESTRING (-1553884.1297294055 356333.2285571825 1892, -1553867.403400969 356326.228057852 1892)",
				"LINESTRING (-1553828.2020148525 356310.18473549373 1892, -1553826.3918720216 356309.4439792326 1892, -1553805.3313426771 356321.43635457195 1892, -1553791.978779562 356312.30965743866 1892)",
				"LINESTRING (-1553901.3363516098 356340.8637982588 1892, -1553892.5967514918 356336.98536274116 1892)",
				"LINESTRING (-1554279.016466205 356484.72317522764 1892, -1554269.8138907603 356490.78779468685 1892)",
				"LINESTRING (-1554011.1549552265 356423.66347611137 1892, -1553966.0260427461 356383.3799535902 1892)",
				"LINESTRING (-1554269.8138907603 356490.78779468685 1892, -1554260.6099768705 356496.8528462462 1892)",
				"LINESTRING (-1553987.6878721458 356043.9761810284 1892, -1553947.7254667853 356130.14487146866 1892, -1553924.0295117102 356181.237874452 1892, -1553867.403400969 356326.228057852 1892)",
				"LINESTRING (-1554260.6099768705 356496.8528462462 1892, -1554222.4296170943 356519.7733429214 1892, -1554098.7099183109 356501.8204350844 1892, -1554059.3586167118 356466.693397264 1892)",
				"LINESTRING (-1553867.403400969 356326.228057852 1892, -1553828.2020148525 356310.18473549373 1892)",
				"LINESTRING (-1554059.3586167118 356466.693397264 1892, -1554011.1549552265 356423.66347611137 1892)",
				"LINESTRING (-1553892.5967514918 356336.98536274116 1892, -1553884.1297294055 356333.2285571825 1892)",
				"LINESTRING (-1554031.3057462866 355980.7833263548 1892, -1554032.2501824189 355990.69865851756 1892, -1554019.8125395377 356002.6620278107 1892, -1554008.8562672855 356023.559453466 1892, -1553892.7481739274 356311.8315632837 1892, -1553890.096901537 356318.4143348085 1892, -1553885.9514405387 356328.706436106 1892, -1553884.1297294055 356333.2285571825 1892)"
		};
		Polygon wb = (Polygon) reader.read(p);
		
		List<SkelLineString> items = new ArrayList<>();
		for (String s : ls) {
			items.add(new SkelLineString((LineString)reader.read(s), EfType.SKELETON));
		}
		
		SkeletonResult r = createSkeletonizer().skeletonize(wb, items, null, Collections.emptyList());
		r.getSkeletons().forEach(e->System.out.println(e.getLineString().toText()));
	}
	
	@Test
	public void test3() throws Exception {
		String p = "POLYGON (( -73.36098959718268 45.44845560018007, -73.36092302037976 45.44864201522826, -73.36063895935395 45.448735222752354, -73.36023062162934 45.44873522275235, -73.36006196039527 45.44858875378592, -73.36002201431351 45.448331323481284, -73.36002201431351 45.44795849338491, -73.35983116081181 45.447696624626744, -73.3598134069977 45.44751908648562, -73.3602217447223 45.44738593287977, -73.36062120553983 45.44740812514741, -73.36098515872915 45.44760341710265, -73.36104729707854 45.44825143131777, -73.36104285862501 45.448397900284206, -73.36098959718268 45.44845560018007 ))";
		String[] ls = new String[] {
				"LINESTRING ( -73.3602217447223 45.44738593287977, -73.36063895935395 45.448735222752354 )",
		};
		String wedge = "LINESTRING ( -73.36098515872915 45.44760341710265, -73.36062120553983 45.44740812514741, -73.3602217447223 45.44738593287977, -73.3598134069977 45.44751908648562 )";
		WKTReader reader = new WKTReader();
		Polygon wb = (Polygon) reader.read(p);
		
		List<SkelLineString> items = new ArrayList<>();
		for (String s : ls) {
			items.add(new SkelLineString((LineString)reader.read(s), EfType.SKELETON));
		}
		
		SkeletonResult r = createSkeletonizer().skeletonize(wb, items, null, Collections.singletonList((LineString)reader.read(wedge)));
		r.getSkeletons().forEach(e->System.out.println(e.getLineString().toText()));

	}
	

	@Test
	public void test5() throws Exception {
		String p = "POLYGON ((-73.4729501 45.1232769, -73.4728231 45.1232768, -73.4727595 45.1232858, -73.4724163 45.1232858, -73.4722511 45.1232858, -73.4722002 45.1232677, -73.4721748 45.1232317, -73.4720858 45.1231777, -73.4720224 45.1231777, -73.4719715 45.1231686, -73.4719334 45.1231417, -73.4718571 45.1230787, -73.4717808 45.1230066, -73.4717554 45.1229617, -73.4717428 45.1229167, -73.4717301 45.1228716, -73.4717174 45.1228266, -73.471692 45.1227817, -73.471692 45.1227367, -73.4716793 45.1227007, -73.4716794 45.1226017, -73.4716921 45.1225567, -73.4717304 45.1223497, -73.4717559 45.1222327, -73.4717432 45.1221788, -73.4717686 45.1220167, -73.4717687 45.1219628, -73.4716924 45.1218457, -73.4716797 45.1217918, -73.4716798 45.1216928, -73.4716925 45.1216568, -73.4717307 45.1216118, -73.4718706 45.1216118, -73.4720104 45.1216118, -73.4720485 45.1215848, -73.472074 45.1215129, -73.4720486 45.1214769, -73.4719342 45.1213599, -73.4718961 45.1213329, -73.4718708 45.1211529, -73.4718708 45.1211349, -73.4718708 45.1210359, -73.471909 45.1210089, -73.4719726 45.1209999, -73.4720615 45.1209999, -73.4720996 45.1210089, -73.4721378 45.121036, -73.472214 45.121072, -73.472341 45.121126, -73.47243 45.121144, -73.4725063 45.121171, -73.4725572 45.12118, -73.472786 45.1211891, -73.4730783 45.1211622, -73.4731291 45.1213512, -73.473129 45.1214951, -73.4731417 45.1215312, -73.4731417 45.1215762, -73.4731544 45.1216121, -73.4731543 45.1216571, -73.4731416 45.1216931, -73.4731415 45.1218551, -73.4731288 45.1219001, -73.4731288 45.1220261, -73.4731414 45.122233, -73.4731413 45.122422, -73.4731412 45.1225481, -73.4731285 45.1225841, -73.4731284 45.122728, -73.4731156 45.122773, -73.4731029 45.122791, -73.4731029 45.122899, -73.4731155 45.122944, -73.4731156 45.122989, -73.4731029 45.1230249, -73.4731028 45.12316, -73.4730901 45.123196, -73.4730519 45.1232409, -73.4730137 45.1232679, -73.4729501 45.1232769))";
		String[] ls = new String[] {
				"LINESTRING (-73.4719726 45.1209999, -73.4719837 45.1210796, -73.4720226 45.1211102, -73.4720475 45.121144)",
				"LINESTRING (-73.4720475 45.121144, -73.472076 45.1211839, -73.4721246 45.121231, -73.4722139 45.1213094, -73.4723004 45.1213455, -73.4723631 45.1213882, -73.4724394 45.1214366, -73.4725145 45.1214912, -73.4726032 45.1215557, -73.4725972 45.1216345, -73.4725684 45.1217739, -73.4724847 45.1219209, -73.472463 45.1219632, -73.472447 45.1221449, -73.4724487 45.1221986, -73.4724486 45.1223273, -73.4724378 45.1223671, -73.4724267 45.122475, -73.4724123 45.1225182, -73.4724075 45.1226437, -73.4724037 45.1226828, -73.4724064 45.1227366, -73.4724885 45.1228448, -73.47265 45.122962, -73.4727157 45.1230132, -73.4727972 45.1230586, -73.4728861 45.1231262, -73.4729302 45.1231584, -73.4729501 45.1232769)"
		};
		Coordinate terminal = new Coordinate(-73.4729501, 45.1232769);
		
		WKTReader reader = new WKTReader();
		Polygon wb = (Polygon) reader.read(p);
		
		List<SkelLineString> items = new ArrayList<>();
		for (String s : ls) {
			items.add(new SkelLineString((LineString)reader.read(s), EfType.SKELETON));
		}
		
		ChyfProperties prop = new ChyfProperties();
		prop.setProperty(Property.SKEL_DENSIFY_FACTOR, 0.0001);
		prop.setProperty(Property.SKEL_MINSIZE, 0.0001);
		prop.setProperty(Property.SKEL_SIMPLIFY_FACTOR, 0.000001);
		prop.setProperty(Property.SKEL_ACUTE_ANGLE, 30.0);
		prop.setProperty(Property.BANK_NODE_DISTANCE_OFFSET, 0.2);
		prop.setProperty(Property.BANK_NODE_DISTANCE_OFFSET, 0.2);
		prop.setProperty(Property.PNT_VERTEX_DISTANCE, 0.001);
		prop.setProperty(Property.BANK_MIN_VERTEX_DISTANCE, 0.001);
		
		BankSkeletonizer gen = new BankSkeletonizer(prop);
		SkeletonResult r = gen.skeletonize(wb, items, terminal, Collections.emptyList());
		r.getSkeletons().forEach(e->System.out.println(e.getLineString().toText()));
	}
	
	@Test
	public void test6() throws Exception {
		String p = "POLYGON (( -73.5213807 45.0894422, -73.5213932 45.0893607, -73.5213932 45.0893157, -73.5214059 45.0892707, -73.5214059 45.0892256, -73.521444 45.0891177, -73.5214567 45.0890727, -73.521482 45.0889917, -73.5215202 45.0889646, -73.521571 45.0889466, -73.5216345 45.0889376, -73.5217869 45.0889376, -73.5218377 45.0889197, -73.5218886 45.0889106, -73.5219902 45.0889465, -73.5220284 45.0889825, -73.522003 45.0890186, -73.5219649 45.0890456, -73.521914 45.0890546, -73.521787 45.0890546, -73.5217361 45.0890636, -73.5216854 45.0890906, -73.5216854 45.0891357, -73.5217107 45.0891716, -73.5217616 45.0891806, -73.5218124 45.0892076, -73.5218506 45.0892436, -73.5219014 45.0892346, -73.5219649 45.0892435, -73.5219522 45.0892796, -73.5219141 45.0893066, -73.5218633 45.0893246, -73.5217616 45.0893426, -73.5216982 45.0893426, -73.5216728 45.0893786, -73.5216474 45.0894506, -73.5216093 45.0894776, -73.5215585 45.0894956, -73.5214652 45.0894956, -73.5214314 45.0894956, -73.5213807 45.0894866, -73.5213807 45.0894422 ))";
		String[] ls = new String[] {
				"LINESTRING ( -73.5218804 45.088964, -73.5218187 45.0889961, -73.5217488 45.0889961, -73.5216726 45.0890058, -73.5216248 45.08902, -73.5215762 45.089049, -73.5215664 45.0891116, -73.5215588 45.0891667, -73.5215679 45.0892257, -73.5215738 45.0892623, -73.5215492 45.0893124, -73.5215351 45.0893536, -73.5215302 45.0893916, -73.5215585 45.0894956 )",
				"LINESTRING ( -73.5218886 45.0889106, -73.5218804 45.088964 )"
		};
		Coordinate terminal = new Coordinate( -73.5215585, 45.0894956);
		
		WKTReader reader = new WKTReader();
		Polygon wb = (Polygon) reader.read(p);
		
		List<SkelLineString> items = new ArrayList<>();
		for (String s : ls) {
			items.add(new SkelLineString((LineString)reader.read(s), EfType.SKELETON));
		}
		ChyfProperties prop = new ChyfProperties();
		prop.setProperty(Property.SKEL_DENSIFY_FACTOR, 0.0001);
		prop.setProperty(Property.SKEL_MINSIZE, 0.0001);
		prop.setProperty(Property.SKEL_SIMPLIFY_FACTOR, 0.000001);
		prop.setProperty(Property.SKEL_ACUTE_ANGLE, 30.0);
		prop.setProperty(Property.BANK_NODE_DISTANCE_OFFSET, 0.2);
		prop.setProperty(Property.BANK_NODE_DISTANCE_OFFSET, 0.2);
		prop.setProperty(Property.PNT_VERTEX_DISTANCE, 0.001);
		prop.setProperty(Property.BANK_MIN_VERTEX_DISTANCE, 0.001);
		BankSkeletonizer gen = new BankSkeletonizer(prop);
		SkeletonResult r = gen.skeletonize(wb, items, terminal, Collections.emptyList());
		r.getSkeletons().forEach(e->System.out.println(e.getLineString().toText()));
	}
	
	
	@Test
	public void test7() throws Exception {
		String p = "Polygon ((-1554914.98742554266937077 356509.34514713007956743, -1554921.84256847179494798 356507.62652476225048304, -1554930.54706432134844363 356504.39291389659047127, -1554937.52246784698218107 356502.54873163811862469, -1554944.79609423712827265 356499.97311573289334774, -1554951.29470795555971563 356496.94913320895284414, -1554957.88200187706388533 356496.14109863247722387, -1554982.1791725370567292 356484.77517398819327354, -1554988.1734051366802305 356479.55322695709764957, -1554996.64172987663187087 356474.05054931063205004, -1555003.05444825999438763 356467.97160342708230019, -1555010.92334189708344638 356466.45155110768973827, -1555017.033854138571769 356464.46371532138437033, -1555029.9379440734628588 356463.75687808822840452, -1555036.49134807684458792 356466.12848489731550217, -1555042.83938906318508089 356466.40928748622536659, -1555052.88027604669332504 356467.85925205517560244, -1555058.30401912797242403 356467.63766247127205133, -1555066.2023983804974705 356466.29631498083472252, -1555074.45587861025705934 356467.09891191218048334, -1555098.7341403195168823 356475.88354039471596479, -1555104.63067994476296008 356480.20144015178084373, -1555110.29060497717000544 356482.24892756994813681, -1555115.76911323936656117 356487.42293686047196388, -1555126.40216356376186013 356493.28638676274567842, -1555132.29781201179139316 356497.60383537970483303, -1555140.78835605876520276 356500.67597057204693556, -1555149.75345766195096076 356504.92789243068546057, -1555150.79667226457968354 356505.30516168661415577, -1555155.38124413951300085 356510.15593116637319326, -1555156.20869631716050208 356516.83801369555294514, -1555155.72550783306360245 356524.05475405603647232, -1555157.68615639978088439 356529.97124714870005846, -1555162.2377018656115979 356538.00210237130522728, -1555163.65819948771968484 356549.09809503238648176, -1555164.33679829281754792 356555.72748542204499245, -1555165.78986364090815187 356563.64427462313324213, -1555166.61820020573213696 356570.32679916638880968, -1555165.74557202169671655 356578.57787295617163181, -1555164.63765415432862937 356584.56033426988869905, -1555162.48697852669283748 356590.1646365700289607, -1555160.87279612920247018 356594.78859483730047941, -1555159.49613327695988119 356601.68118098843842745, -1555156.68770844163373113 356609.23129650205373764, -1555154.68586445273831487 356614.8905055820941925, -1555149.58554930565878749 356620.4356510266661644, -1555143.44202405214309692 356625.60352584905922413, -1555141.67636082088574767 356633.53178929258137941, -1555145.80986769078299403 356642.41871735081076622, -1555147.02675497136078775 356648.0664208922535181, -1555149.87778241420164704 356657.66490054689347744, -1555150.7061189548112452 356664.34739966224879026, -1555154.21578145329840481 356672.00051671639084816, -1555156.9799122647382319 356679.38395959325134754, -1555158.67223999951966107 356686.21188899409025908, -1555155.3879228092264384 356692.58263186924159527, -1555152.73187660495750606 356696.82886598631739616, -1555149.41942362324334681 356703.02047520037740469, -1555145.48090337309986353 356707.97825960535556078, -1555143.47906516189686954 356713.63744335900992155, -1555140.85250100819393992 356718.06236966419965029, -1555137.2708523056935519 356725.16498440504074097, -1555135.11973266140557826 356730.77013812027871609, -1555133.1183513980358839 356736.42842781357467175, -1555132.24661934934556484 356744.67989644967019558, -1555129.9760401074308902 356751.2491934560239315, -1555128.21392552880570292 356755.8186586108058691, -1555127.28697940497659147 356758.67547372169792652, -1555124.66041986527852714 356763.10039026476442814, -1555118.51737319235689938 356768.26733668800443411, -1555111.98575893486849964 356774.4713048180565238, -1555101.84987793467007577 356779.20182783994823694, -1555091.86382711282931268 356783.14735421910881996, -1555087.62444832781329751 356792.19574662670493126, -1555085.62262226175516844 356797.85490668192505836, -1555083.47196805919520557 356803.45915218256413937, -1555080.54673956916667521 356808.61637100018560886, -1555073.92869622958824039 356812.6044230442494154, -1555064.7818134743720293 356811.47766675986349583, -1555057.42143708607181907 356810.99782951362431049, -1555053.63222311483696103 356816.00961203221231699, -1555045.34933187975548208 356815.02829297911375761, -1555039.45018916949629784 356814.06962988991290331, -1555031.82061821222305298 356814.50080366060137749, -1555026.96732936380431056 356810.56021139957010746, -1555026.64390256488695741 356805.23668263107538223, -1555014.43112374469637871 356800.81671438552439213, -1554997.76368226017802954 356811.75119956769049168, -1554989.20852103619836271 356815.03875045292079449, -1554983.48307435144670308 356819.35048068407922983, -1554977.82364906650036573 356817.30212242342531681, -1554972.19589131465181708 356812.07415402680635452, -1554965.13716058083809912 356808.34452720638364553, -1554953.84644508105702698 356804.42694535385817289, -1554947.43467224133200943 356810.50623585097491741, -1554945.28403925173915923 356816.11047264002263546, -1554937.17991637950763106 356815.3618916142731905, -1554932.8016152186319232 356812.60242257174104452, -1554927.55932426871731877 356809.69752227608114481, -1554914.72136195003986359 356804.04422440752387047, -1554904.71311154239811003 356799.41510435938835144, -1554899.44133804156444967 356796.33151202090084553, -1554887.16255041351541877 356798.27166630048304796, -1554877.59674388519488275 356798.00281613040715456, -1554870.41865989496000111 356794.39698894415050745, -1554866.55385960079729557 356784.60004128236323595, -1554864.83155912277288735 356777.59436587430536747, -1554862.48452584352344275 356769.35444310866296291, -1554859.36336948443204165 356760.6666095033288002, -1554857.285526740597561 356751.51567396707832813, -1554853.35735128074884415 356744.7196129709482193, -1554846.86601677071303129 356739.34756997413933277, -1554842.10050628683529794 356737.62246720213443041, -1554834.52519553946331143 356744.28821279481053352, -1554828.65136681916192174 356748.54639766085892916, -1554822.53739555296488106 356753.89294335804879665, -1554813.32758054579608142 356755.76847573090344667, -1554803.91150779160670936 356755.55278047546744347, -1554798.75700539886020124 356754.86336184199899435, -1554794.3542593726888299 356746.88754516933113337, -1554790.9640032087918371 356738.27036429569125175, -1554786.80772796226665378 356720.80974870175123215, -1554792.15489819692447782 356705.77893648203462362, -1554786.29091574740596116 356698.28194668609648943, -1554780.81284392788074911 356693.10936358571052551, -1554776.49700120417401195 356687.34855182003229856, -1554771.01849433616735041 356682.17462686821818352, -1554764.52931536920368671 356673.44427765533328056, -1554761.79460655641742051 356666.23959016054868698, -1554764.6020615657325834 356658.6890614852309227, -1554772.85594337899237871 356659.49073777068406343, -1554781.16417600377462804 356665.68883170280605555, -1554789.02995042502880096 356667.52664889767765999, -1554797.13543550437316298 356668.27476006932556629, -1554806.73292015003971756 356665.36395757086575031, -1554808.69097486883401871 356674.63958484586328268, -1554807.07818016945384443 356679.2630795082077384, -1554807.10043924837373197 356687.83777110371738672, -1554807.51035096007399261 356695.37721128296107054, -1554803.23849238082766533 356707.60478854365646839, -1554802.13063127035275102 356713.58719400875270367, -1554811.54671313380822539 356713.80288370326161385, -1554825.10491659305989742 356714.50899501144886017, -1554833.39133525895886123 356712.13152298517525196, -1554840.46083308360539377 356704.10639186017215252, -1554843.50538176414556801 356698.82536846678704023, -1554848.01344676478765905 356688.86682617757469416, -1554850.78925926913507283 356684.49592228885740042, -1554860.23746481793932617 356681.53110672160983086, -1554863.92945377575233579 356686.05813807807862759, -1554870.48282315069809556 356688.42971917893737555, -1554879.84412327851168811 356683.24988662824034691, -1554889.71169801475480199 356679.42854154296219349, -1554891.71304528857581317 356673.77024809923022985, -1554885.42841282417066395 356670.48853943962603807, -1554880.81083638407289982 356668.81789034605026245, -1554873.18125151051208377 356669.24910359736531973, -1554867.03866823669523001 356674.41742948908358812, -1554867.25261288625188172 356668.11177209764719009, -1554870.14833879144862294 356662.7758268341422081, -1554875.43088634172454476 356654.10465391911566257, -1554879.63722280040383339 356648.23627597372978926, -1554882.68178104143589735 356642.95523778442293406, -1554885.99464661884121597 356636.76273039635270834, -1554887.72725563705898821 356632.01455224584788084, -1554891.0410101842135191 356625.82249584421515465, -1554894.56147612258791924 356621.72079207003116608, -1554901.39128944743424654 356614.78533539455384016, -1554908.63541222782805562 356612.03104232996702194, -1554918.89066462893970311 356607.17442675307393074, -1554922.81750361807644367 356613.9709615483880043, -1554925.43327660416252911 356621.30081273335963488, -1554927.78030827199108899 356629.5407887464389205, -1554933.40720691066235304 356634.76831798441708088, -1554940.88751873513683677 356634.28308381419628859, -1554947.38699924107640982 356631.25958371069282293, -1554952.21853711153380573 356626.62456495873630047, -1554952.70168994436971843 356619.40787352435290813, -1554961.39614715171046555 356595.00617903564125299, -1554961.87884726841002703 356587.79036541655659676, -1554958.43559751263819635 356573.77845539897680283, -1554948.12554476363584399 356573.23951773811131716, -1554940.73212660429999232 356575.93979061115533113, -1554934.31989052053540945 356582.01781487185508013, -1554924.93632144760340452 356578.62293618824332952, -1554927.11996777332387865 356569.83856756705790758, -1554928.10804684599861503 356563.98079024720937014, -1554927.01093374076299369 356558.20841946359723806, -1554927.22577455756254494 356551.90318200923502445, -1554923.60022171423770487 356541.01731518656015396, -1554919.70285606803372502 356534.39946194086223841, -1554916.66859705979004502 356527.92658325470983982, -1554915.98950624256394804 356521.29810014087706804, -1554918.67808425473049283 356513.87264100834727287, -1554914.98742554266937077 356509.34514713007956743),(-1555018.26314614899456501 356520.00449012499302626, -1555011.76364011107943952 356523.02800831012427807, -1555009.49307128693908453 356529.59736367594450712, -1555005.7916298673953861 356536.82470870856195688, -1554999.05594183132052422 356537.57916237320750952, -1554994.20216444204561412 356533.63943879958242178, -1554989.26159259956330061 356526.64430703222751617, -1554981.09492264245636761 356528.89712718781083822, -1554986.5730014278087765 356534.06976588722318411, -1554985.46510940603911877 356540.05222684610635042, -1554985.21724995621480048 356549.53755072224885225, -1554990.60885615972802043 356552.49649425223469734, -1554995.46263152128085494 356556.43621567636728287, -1555000.85334928799420595 356559.39470606204122305, -1555002.19742901995778084 356555.68130965065211058, -1555004.58779931906610727 356548.98728982266038656, -1555009.68898482085205615 356543.44257571361958981, -1555013.23895219527184963 356539.51955270487815142, -1555016.67165184370242059 356533.20233914256095886, -1555019.36024898057803512 356525.77687831595540047, -1555018.26314614899456501 356520.00449012499302626),(-1555056.49333217390812933 356619.67286641243845224, -1555052.38067628839053214 356619.3611280033364892, -1555046.68820943753235042 356620.49283274542540312, -1555041.61958620022051036 356622.85834040679037571, -1555040.27595892292447388 356626.57083892356604338, -1555045.30341166467405856 356635.78099013492465019, -1555053.88809639122337103 356632.67209739796817303, -1555057.59042711253277957 356625.44523738231509924, -1555056.49333217390812933 356619.67286641243845224),(-1555122.61244942713528872 356689.12098327744752169, -1555116.95300660422071815 356687.07260642480105162, -1555113.43251778837293386 356691.17429491225630045, -1555109.49488918972201645 356696.13253668416291475, -1555105.63745227293111384 356701.51170810498297215, -1555105.28763008583337069 356702.00044772401452065, -1555114.01385745941661298 356707.34251694940030575, -1555119.25615690974518657 356710.24744701944291592, -1555121.25799164129421115 356704.58826346695423126, -1555123.67696775309741497 356698.07252431660890579, -1555122.61244942713528872 356689.12098327744752169))";
		String[] ls = new String[] {
				"LineString (-1555128.21392552880570292 356755.8186586108058691 2014, -1555081.00645048497244716 356739.12149450276046991 2014)",
				"LineString (-1555081.00645048497244716 356739.12149450276046991 2014, -1555051.79905746108852327 356693.90138763654977083 2014)",
				"LineString (-1555051.79905746108852327 356693.90138763654977083 2014, -1555026.55907848291099072 356654.8251504460349679 2014)",
				"LineString (-1555026.55907848291099072 356654.8251504460349679 2014, -1555016.73875366011634469 356639.62221912108361721 2014)",
				"LineString (-1555016.73875366011634469 356639.62221912108361721 2014, -1554968.70142304920591414 356565.25177846569567919 2014)",
				"LineString (-1554968.70142304920591414 356565.25177846569567919 2014, -1554941.61064902134239674 356523.31061446573585272 2014, -1554914.98742554266937077 356509.34514713007956743 2014)",
		};
		Coordinate terminal = null;
		
		WKTReader reader = new WKTReader();
		Polygon wb = (Polygon) reader.read(p);
		
		List<SkelLineString> items = new ArrayList<>();
		for (String s : ls) {
			items.add(new SkelLineString((LineString)reader.read(s), EfType.SKELETON));
		}
		
		ChyfProperties prop = new ChyfProperties();
		prop.setProperty(Property.SKEL_DENSIFY_FACTOR, 1.0);
		prop.setProperty(Property.SKEL_MINSIZE, 1.0);
		prop.setProperty(Property.SKEL_SIMPLIFY_FACTOR, 0.25);
		prop.setProperty(Property.SKEL_ACUTE_ANGLE, 30.0);
		prop.setProperty(Property.BANK_NODE_DISTANCE_OFFSET, 0.2);
		prop.setProperty(Property.BANK_MIN_VERTEX_DISTANCE, 0.001);
		prop.setProperty(Property.PNT_VERTEX_DISTANCE, 0.001);
		BankSkeletonizer gen = new BankSkeletonizer(prop);
		
		
		SkeletonResult r = gen.skeletonize(wb, items, terminal, Collections.emptyList());
		r.getSkeletons().forEach(e->System.out.println(e.getLineString().toText()));
	}
	
	
	
	@Test
	public void testLoop() throws Exception{
		String p = "Polygon((-63.80503889999999956 44.63044510000000287 0, -63.80504109999999685 44.63038590000000028 0, -63.80527039999999772 44.63002290000000016 0, -63.80548939999999902 44.62993629999999712 0, -63.80537170000000202 44.62968120000000027 0, -63.80540830000000341 44.62944490000000286 0, -63.80498430000000099 44.62939339999999788 0, -63.80478080000000318 44.62921570000000315 0, -63.80461590000000172 44.62889260000000036 0, -63.80437969999999837 44.62870240000000166 0, -63.80427759999999893 44.62803290000000089 0, -63.80418399999999934 44.62772700000000015 0, -63.80456290000000052 44.62765129999999658 0, -63.80531009999999981 44.6271956000000003 0, -63.80596769999999651 44.62706599999999924 0, -63.80625940000000185 44.62680689999999828 0, -63.80643979999999971 44.6268657000000033 0, -63.80669369999999674 44.62673230000000046 0, -63.80702229999999986 44.62681760000000253 0, -63.80734019999999873 44.6267485999999991 0, -63.80773520000000332 44.6265388999999999 0, -63.80793460000000294 44.62623459999999653 0, -63.80791289999999805 44.62607619999999997 0, -63.80807000000000073 44.62601599999999991 0, -63.80835689999999971 44.6254447999999968 0, -63.80872579999999772 44.62504510000000124 0, -63.80888970000000171 44.62465720000000147 0, -63.80932829999999711 44.6244640999999973 0, -63.80941688333341233 44.624314349999878, -63.809434600000003 44.62428440000000052 0, -63.80926379999999654 44.62411920000000265 0, -63.80918539999999695 44.62384920000000221 0, -63.81015219999999744 44.6232869999999977 0, -63.81075429999999926 44.62330639999999704 0, -63.81140450000000186 44.6230739000000014 0, -63.8114656999999994 44.62291710000000222 0, -63.81162570000000045 44.62277790000000266 0, -63.81178640000000257 44.62276920000000047 0, -63.81208660000000066 44.6230236999999974 0, -63.81221390000000326 44.62302220000000119 0, -63.81262780000000134 44.62274959999999879 0, -63.81272669999999891 44.62276729999999958 0, -63.81280960000000135 44.62276889999999696 0, -63.81281820000000238 44.62298239999999794 0, -63.8126806000000002 44.62326019999999716 0, -63.81206530000000043 44.62344590000000011 0, -63.81212029999999658 44.62404730000000086 0, -63.81205330000000231 44.62421189999999882 0, -63.81175369999999702 44.62423780000000306 0, -63.81172010000000228 44.62439520000000215 0, -63.81147440000000159 44.62431149999999747 0, -63.81121759999999909 44.62437380000000076 0, -63.81085989999999697 44.62432739999999853 0, -63.81059079999999994 44.62442500000000223 0, -63.8107200999999975 44.62466440000000034 0, -63.81042399999999759 44.62489180000000033 0, -63.81054679999999735 44.62500870000000219 0, -63.81060200000000293 44.62515989999999988 0, -63.81049720000000036 44.62530009999999692 0, -63.81052867555994368 44.62544156515552629, -63.81058720000000051 44.62570459999999883 0, -63.81074259999999754 44.6259840999999966 0, -63.81091430000000031 44.62597949999999969 0, -63.8109548999999987 44.62607500000000016 0, -63.81081230000000204 44.62619080000000338 0, -63.81107620000000225 44.62638150000000081 0, -63.81130379999999747 44.62635819999999853 0, -63.81138010000000094 44.62653739999999658 0, -63.81115249999999861 44.62656069999999886 0, -63.81104479999999768 44.62662970000000229 0, -63.81092340000000007 44.62662350000000089 0, -63.81059390000000064 44.62670800000000071 0, -63.81032760000000081 44.62687669999999684 0, -63.81046349999999734 44.62708870000000161 0, -63.81044889999999725 44.6271831999999975 0, -63.81027360000000215 44.62728649999999675 0, -63.81032789999999721 44.62760740000000226 0, -63.81058749999999691 44.62776639999999873 0, -63.81095229999999674 44.62821579999999955 0, -63.8109289000000004 44.62839699999999965 0, -63.81067139999999682 44.62847899999999868 0, -63.81040889999999877 44.62839900000000171 0, -63.81038869999999719 44.62820109999999829 0, -63.81020910000000157 44.62812259999999753 0, -63.80986800000000159 44.62822270000000202 0, -63.80984529999999921 44.62838430000000045 0, -63.80988820000000317 44.62842059999999833 0, -63.8099710999999985 44.62842220000000282 0, -63.81022430000000156 44.62830850000000282 0, -63.81031730000000124 44.62848410000000143 0, -63.81076300000000145 44.62869400000000297 0, -63.81089440000000224 44.62902439999999871 0, -63.81103910000000212 44.62914959999999809 0, -63.81104049999999717 44.62926019999999738 0, -63.81130660000000177 44.62939169999999933 0, -63.81118730000000028 44.62947630000000032 0, -63.81095599999999735 44.62944819999999879 0, -63.81081410000000176 44.629544199999998 0, -63.81114420000000109 44.62974009999999936 0, -63.8111608999999973 44.62988659999999896 0, -63.81017570000000205 44.6306420000000017 0, -63.8100475999999972 44.6308132999999998 0, -63.80957539999999995 44.63116370000000188 0, -63.80901819999999702 44.63127159999999805 0, -63.80829059999999942 44.63046380000000113 0, -63.80813710000000327 44.6305753999999979 0, -63.80762510000000276 44.63051029999999741 0, -63.80765519999999924 44.63118240000000014 0, -63.80752999999999986 44.63142489999999896 0, -63.80766729999999853 44.63174740000000185 0, -63.80762119999999982 44.63209020000000038 0, -63.80686610000000059 44.63231280000000112 0, -63.80658179999999646 44.63222439999999835 0, -63.80640489999999687 44.63236710000000329 0, -63.80622240000000289 44.63236760000000203 0, -63.80610810000000299 44.63246420000000114 0, -63.8059154000000035 44.63244069999999653 0, -63.80560510000000107 44.63201219999999836 0, -63.80557679999999721 44.63188130000000342 0, -63.80522500000000008 44.63167700000000337 0, -63.80518310000000071 44.63117069999999842 0, -63.80487420000000043 44.63085269999999838 0, -63.8050264000000027 44.63063050000000231 0, -63.80503889999999956 44.63044510000000287 0),(-63.81025199999999842 44.62933999999999912 0, -63.81021619999999928 44.62970659999999867 0, -63.81014700000000062 44.62993039999999922 0, -63.81039280000000247 44.6300140999999968 0, -63.81086479999999739 44.62996389999999991 0, -63.81107360000000028 44.62985330000000062 0, -63.81104309999999913 44.62978160000000116 0, -63.81041270000000054 44.62948130000000191 0, -63.81025199999999842 44.62933999999999912 0))";
		
		String[] ls = new String[] {
				"LineString(-63.80503889999999956 44.63044510000000287, -63.80527016597212508 44.63045719059457639, -63.80576332175006371 44.63061769796420464, -63.80585639021067124 44.63068256589964733, -63.80638427717764216 44.6308135540541997, -63.80642557197496956 44.63069772010598513, -63.80645929036925423 44.6305872699053694, -63.80675851283338318 44.62947445499433741, -63.8071330895341049 44.6286950654409651, -63.80743426801770113 44.62864592708233857, -63.80753204648859622 44.62863167609621229, -63.80766986306706201 44.6286159943393983, -63.80782623702452128 44.62860342773791444, -63.80793358878270283 44.62857596566023943)",
				"LineString(-63.80793358878270283 44.62857596566023943, -63.80893881894839126 44.62932750753981992)",
				"LineString(-63.80893881894839126 44.62932750753981992, -63.8090651716970072 44.62927911560004191, -63.8098917858675776 44.62895094994294709, -63.80994745012279878 44.6289314165522768, -63.8100651437588624 44.62889530299970886, -63.81017866664089411 44.62890566552243143, -63.81021917280461508 44.62891215872314632, -63.8102686452896819 44.62892273882511773, -63.81031682864188781 44.62893605626161531, -63.81036372286123282 44.62895211103264614, -63.81040932794747533 44.62897090313809656, -63.81044844462488896 44.62898974697173315, -63.81049031111695058 44.62904160939514497, -63.81057320300393343 44.62915882395611789, -63.81060128873264148 44.62919531463084866, -63.81063864705398458 44.62922733771363681, -63.81067533388316093 44.62925449966057556, -63.81068567009965165 44.62938377146024038, -63.8106972522292466 44.62945223826903884, -63.81070981776341711 44.62949544557869075, -63.81072004189908853 44.62952037292956931, -63.81073174372502876 44.62954219826256264, -63.81074492324125202 44.62956092157772048, -63.81076746318488091 44.62958319026701304, -63.8107843369268295 44.62959415853757861, -63.81105832726483129 44.62974015835725794, -63.81107504974023215 44.62975055117462375, -63.81109547019872252 44.62977163124173785, -63.81111296829590884 44.62983764920221574, -63.81111480868931807 44.62984733298900153, -63.8111150184082021 44.62986708781189549, -63.8111084307708083 44.62987529772970419, -63.81109332458263594 44.62988824101089591, -63.81088330436132594 44.63002239208044841, -63.81041420585662394 44.63021038976068411, -63.81038475128593745 44.63022094220127656, -63.81035382157501346 44.63022957074969099, -63.81032141672365299 44.63023627540596294, -63.81002133273840116 44.63028560936000844, -63.80997586643412234 44.63029160160213138, -63.80991671389063669 44.63029606657720194, -63.80968450843995754 44.63030503327421172, -63.80955251051837962 44.63030344909290648, -63.80953898814936309 44.63030284951216942, -63.80952388291760968 44.63029986771580582, -63.80941952579208731 44.6302763063793364, -63.80930407467094767 44.63024476458738832, -63.80926733640380633 44.63018138206484053, -63.80923367048900019 44.63011774100083073, -63.80920209055344117 44.63005222105834946, -63.80917668230627271 44.62999456567345646, -63.80914897633195437 44.62992555638500392, -63.80912688862265014 44.62986491013124635, -63.80909982231985822 44.62978190117008381, -63.80903596784713727 44.62956132234558027, -63.809004567673 44.62946270701532114, -63.80893881894839126 44.62932750753981992)",
				"LineString(-63.80793358878270283 44.62857596566023943, -63.80817577566573107 44.6282059583936288, -63.80836160083882191 44.62794135486696234, -63.80842785351538993 44.62785420925429491, -63.80890555905205019 44.62724977012551619, -63.80893344796152178 44.62716537896695712, -63.80896473956196502 44.6270800820523732, -63.80899861721872668 44.62699647971619754, -63.80903473276938342 44.62691479465482303, -63.80906924768582655 44.62678616329670689, -63.80916413730439274 44.62653761728860502, -63.80920268077132818 44.62644521065625014, -63.80923618555662813 44.62637262643338687, -63.80926744912760284 44.62631009311085251, -63.80930540393312356 44.62623974402507798, -63.80934056127149034 44.62617916644810379, -63.80936360884127367 44.6261415358405884, -63.80943199463958138 44.62606354034078038, -63.80945265403341438 44.6259783693733354, -63.80951504600367485 44.62574605018719609, -63.80953547400282133 44.6256606431685654, -63.80955589940536044 44.62555502126489415, -63.80958770035740457 44.6253448369056116, -63.80965679950366365 44.62524005530573845, -63.80984302677186548 44.62476280649067206, -63.80987497082716686 44.62468929096867498, -63.80991651464168513 44.62460990263245009, -63.80999790735419452 44.62447634478722591, -63.81004486149379318 44.62409022546853521, -63.81010688163353706 44.6240334275328081, -63.81016988479363761 44.62398285952099286, -63.81023555180340878 44.62393687245877061, -63.81030557172608297 44.6238945271241505, -63.81038509675867232 44.62387861246170928, -63.81070290311316739 44.62382825000761244, -63.81118502314416929 44.62377674420757501, -63.81135010707122746 44.62372746732521023, -63.81140766903705241 44.62371265796026165, -63.81146274841040622 44.6237012641930022, -63.81147626813856277 44.6236953170721975, -63.81159135344181266 44.62351409765100385, -63.81174860092814072 44.6232355624373298, -63.81181654610661269 44.62322813320022874, -63.81187012664369718 44.62322579194955097, -63.81201610059505214 44.62323154902320965, -63.81205705931721184 44.62323037337112908, -63.81208703317157926 44.62322702252188833, -63.8122349514358902 44.62320380379238571, -63.81226376310081605 44.62319660213442063, -63.81230108824457403 44.6231833869527037, -63.81252662191756997 44.62307818625529166, -63.8126441230910828 44.6229453238375342, -63.81266120093791017 44.62291203865498801, -63.81271739971739976 44.62286170692976839, -63.81272669999999891 44.62276729999999958)"
		};
		
		Polygon wb = (Polygon) reader.read(p);
		
		List<SkelLineString> items = new ArrayList<>();
		for (String s : ls) {
			items.add(new SkelLineString((LineString)reader.read(s), EfType.SKELETON));
		}
		
		SkeletonResult r = createSkeletonizer().skeletonize(wb, items, null, Collections.emptyList());
		//r.getSkeletons().forEach(e->System.out.println(e.toText()));
		
		String[] expected = new String[] {
				"LINESTRING (-63.8104972 44.6253001, -63.809656799503664 44.62524005530574)",
				"LINESTRING (-63.80941688333341 44.62431434999988, -63.809916514641685 44.62460990263245)",
				"LINESTRING (-63.8110736 44.6298533, -63.811093324582636 44.629888241010896)",
				"LINESTRING (-63.8050389 44.6304451, -63.805270165972125 44.630457190594576, -63.805763321750064 44.630617697964205, -63.80585639021067 44.63068256589965, -63.80638427717764 44.6308135540542, -63.80642557197497 44.630697720105985, -63.806459290369254 44.63058726990537, -63.80675851283338 44.62947445499434, -63.807133089534105 44.628695065440965, -63.8074342680177 44.62864592708234, -63.807532046488596 44.62863167609621, -63.80766986306706 44.6286159943394, -63.80782623702452 44.628603427737914, -63.8079335887827 44.62857596566024)",
				"LINESTRING (-63.8079335887827 44.62857596566024, -63.80893881894839 44.62932750753982)",
				"LINESTRING (-63.8079335887827 44.62857596566024, -63.80817577566573 44.62820595839363, -63.80836160083882 44.62794135486696, -63.80842785351539 44.627854209254295, -63.80890555905205 44.627249770125516, -63.80893344796152 44.62716537896696, -63.808964739561965 44.62708008205237, -63.80899861721873 44.6269964797162, -63.80903473276938 44.62691479465482, -63.80906924768583 44.62678616329671, -63.80916413730439 44.626537617288605, -63.80920268077133 44.62644521065625, -63.80923618555663 44.62637262643339, -63.8092674491276 44.62631009311085, -63.809305403933124 44.62623974402508, -63.80934056127149 44.626179166448104, -63.809363608841274 44.62614153584059, -63.80943199463958 44.62606354034078, -63.809452654033414 44.625978369373335, -63.809515046003675 44.625746050187196, -63.80953547400282 44.625660643168565, -63.80955589940536 44.625555021264894, -63.809587700357405 44.62534483690561, -63.809656799503664 44.62524005530574)",
				"LINESTRING (-63.809656799503664 44.62524005530574, -63.809843026771865 44.62476280649067, -63.80987497082717 44.624689290968675, -63.809916514641685 44.62460990263245)",
				"LINESTRING (-63.809916514641685 44.62460990263245, -63.809997907354195 44.624476344787226, -63.81004486149379 44.624090225468535, -63.81010688163354 44.62403342753281, -63.81016988479364 44.62398285952099, -63.81023555180341 44.62393687245877, -63.81030557172608 44.62389452712415, -63.81038509675867 44.62387861246171, -63.81070290311317 44.62382825000761, -63.81118502314417 44.623776744207575, -63.81135010707123 44.62372746732521, -63.81140766903705 44.62371265796026, -63.811462748410406 44.623701264193, -63.81147626813856 44.6236953170722, -63.81159135344181 44.623514097651004, -63.81174860092814 44.62323556243733, -63.81181654610661 44.62322813320023, -63.8118701266437 44.62322579194955, -63.81201610059505 44.62323154902321, -63.81205705931721 44.62323037337113, -63.81208703317158 44.62322702252189, -63.81223495143589 44.623203803792386, -63.812263763100816 44.62319660213442, -63.812301088244574 44.623183386952704, -63.81252662191757 44.62307818625529, -63.81264412309108 44.622945323837534, -63.81266120093791 44.62291203865499, -63.8127173997174 44.62286170692977, -63.8127267 44.6227673)",
				"LINESTRING (-63.80893881894839 44.62932750753982, -63.80906517169701 44.62927911560004, -63.80989178586758 44.62895094994295, -63.8099474501228 44.62893141655228, -63.81006514375886 44.62889530299971, -63.810178666640894 44.62890566552243, -63.810219172804615 44.628912158723146, -63.81026864528968 44.62892273882512, -63.81031682864189 44.628936056261615, -63.81036372286123 44.628952111032646, -63.810409327947475 44.6289709031381, -63.81044844462489 44.62898974697173, -63.81049031111695 44.629041609395145, -63.81057320300393 44.62915882395612, -63.81060128873264 44.62919531463085, -63.810638647053985 44.62922733771364, -63.81067533388316 44.629254499660576, -63.81068567009965 44.62938377146024, -63.81069725222925 44.62945223826904, -63.81070981776342 44.62949544557869, -63.81072004189909 44.62952037292957, -63.81073174372503 44.62954219826256, -63.81074492324125 44.62956092157772, -63.81076746318488 44.62958319026701, -63.81078433692683 44.62959415853758, -63.81105832726483 44.62974015835726, -63.81107504974023 44.629750551174624, -63.81109547019872 44.62977163124174, -63.81111296829591 44.629837649202216, -63.81111480868932 44.629847332989, -63.8111150184082 44.629867087811895, -63.81110843077081 44.629875297729704, -63.811093324582636 44.629888241010896)",
				"LINESTRING (-63.811093324582636 44.629888241010896, -63.810883304361326 44.63002239208045, -63.810414205856624 44.630210389760684, -63.81038475128594 44.63022094220128, -63.81035382157501 44.63022957074969, -63.81032141672365 44.63023627540596, -63.8100213327384 44.63028560936001, -63.80997586643412 44.63029160160213, -63.80991671389064 44.6302960665772, -63.80968450843996 44.63030503327421, -63.80955251051838 44.63030344909291, -63.80953898814936 44.63030284951217, -63.80952388291761 44.630299867715806, -63.80941952579209 44.630276306379336, -63.80930407467095 44.63024476458739, -63.809267336403806 44.63018138206484, -63.809233670489 44.63011774100083, -63.80920209055344 44.63005222105835, -63.80917668230627 44.62999456567346, -63.809148976331954 44.629925556385004, -63.80912688862265 44.629864910131246, -63.80909982231986 44.629781901170084, -63.80903596784714 44.62956132234558, -63.809004567673 44.62946270701532, -63.80893881894839 44.62932750753982)"
		};
		List<LineString> expectedls = new ArrayList<>();
		for (String s : expected) expectedls.add((LineString)reader.read(s));
		
		Assert.assertEquals("invalid number of nodes", expectedls.size(), r.getSkeletons().size());
		setEquals(expectedls, r.getSkeletons());

	}
	
	
	private void setEquals(Collection<LineString> expected, Collection<SkelLineString> actual) {
		for (LineString p : expected) {
			boolean found = false;
			for (SkelLineString b : actual) {
				if (p.equalsExact(b.getLineString())) {
					found = true;
					break;
				}
			}
			if (!found) {
				Assert.fail("Expected skeleton line not found: " + p.toText());
			}
		}
	}
}
